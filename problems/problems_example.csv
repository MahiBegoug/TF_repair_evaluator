project_name,latest_commit,working_directory,oid,severity,summary,detail,filename,line_start,col_start,line_end,col_end,block_type,impacted_block_type,impacted_block_content,impacted_block_start_line,impacted_block_end_line,block_identifiers,metrics_nloc,metrics_complexity,metrics_entropy,metrics_tokens,metrics_depth,metrics_loc,metrics_template_expressions,metrics_references,metrics_attributes,provider_name,provider_version,resource_schema,block_documentation_identifiers,matched_type,file_content
aneoconsulting__ArmoniK,a19ed3ce4816a69b09bf148a323ed85bed458965,clones/aneoconsulting__ArmoniK/infrastructure/modules/k8s/chaos_mesh,6b0ad6fc76bbc3a189e0a798402889b0a5f1132a,warning,Deprecated Resource,Deprecated; use kubernetes_namespace_v1.,clones/aneoconsulting__ArmoniK/infrastructure/modules/k8s/chaos_mesh/main.tf,2,45,2,46,resource,kubernetes_namespace chaosmesh,"resource ""kubernetes_namespace"" ""chaosmesh"" {
  metadata {
    name = var.namespace
  }
}",2,6,resource kubernetes_namespace chaosmesh,0,1,4.01,13,5,5,0,1,1,kubernetes,3.0.1,"{""attributes"": {""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""wait_for_default_service_account"": {""type"": ""bool"", ""description"": ""Terraform will wait for the default service account to be created."", ""description_kind"": ""plain"", ""optional"": true}}, ""block_types"": {""metadata"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""annotations"": {""type"": [""map"", ""string""], ""description"": ""An unstructured key value map stored with the namespace that may be used to store arbitrary metadata. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/"", ""description_kind"": ""plain"", ""optional"": true}, ""generate_name"": {""type"": ""string"", ""description"": ""Prefix, used by the server, to generate a unique name ONLY IF the `name` field has not been provided. This value will also be combined with a unique suffix. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#idempotency"", ""description_kind"": ""plain"", ""optional"": true}, ""generation"": {""type"": ""number"", ""description"": ""A sequence number representing a specific generation of the desired state."", ""description_kind"": ""plain"", ""computed"": true}, ""labels"": {""type"": [""map"", ""string""], ""description"": ""Map of string keys and values that can be used to organize and categorize (scope and select) the namespace. May match selectors of replication controllers and services. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/"", ""description_kind"": ""plain"", ""optional"": true}, ""name"": {""type"": ""string"", ""description"": ""Name of the namespace, must be unique. Cannot be updated. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""resource_version"": {""type"": ""string"", ""description"": ""An opaque value that represents the internal version of this namespace that can be used by clients to determine when namespace has changed. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency"", ""description_kind"": ""plain"", ""computed"": true}, ""uid"": {""type"": ""string"", ""description"": ""The unique in time and space value for this namespace. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids"", ""description_kind"": ""plain"", ""computed"": true}}, ""description"": ""Standard namespace's metadata. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata"", ""description_kind"": ""plain""}, ""min_items"": 1, ""max_items"": 1}, ""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}}, ""matched_block_name"": ""kubernetes_namespace"", ""matched_block_type"": ""resource""}",kubernetes_namespace,resource,"
resource ""kubernetes_namespace"" ""chaosmesh"" {
  metadata {
    name = var.namespace
  }
}

resource ""helm_release"" ""chaosmesh"" {
  name       = ""chaosmesh""
  namespace  = kubernetes_namespace.chaosmesh.metadata[0].name
  chart      = ""chaos-mesh""
  repository = var.helm_chart_repository
  version    = var.helm_chart_version

  values = var.node_selector != null ? [yamlencode({
    controllerManager = {
      nodeSelector = var.node_selector
    }
    chaosDaemon = {
      nodeSelector = var.node_selector
    }
    dashboard = {
      nodeSelector = var.node_selector
    }
    dnsServer = {
      nodeSelector = var.node_selector
    }
    prometheus = {
      nodeSelector = var.node_selector
    }
  })] : []

  set {
    name  = ""image.chaosmesh.repository""
    value = var.docker_image.chaosmesh.image
  }
  set {
    name  = ""image.chaosdaemon.tag""
    value = var.docker_image.chaosdaemon.tag
  }
  set {
    name  = ""image.chaosdashboard.tag""
    value = var.docker_image.chaosdashboard.tag
  }

  set {
    name  = ""dashboard.service.type""
    value = var.service_type
  }
}

data ""kubernetes_service"" ""chaos_dashboard"" {
  metadata {
    name      = ""chaos-dashboard""
    namespace = var.namespace
  }
  depends_on = [resource.helm_release.chaosmesh]
}
"
