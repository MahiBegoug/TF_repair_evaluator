project_name,latest_commit,working_directory,oid,severity,summary,detail,filename,line_start,col_start,line_end,col_end,block_type,impacted_block_type,impacted_block_content,impacted_block_start_line,impacted_block_end_line,block_identifiers,metrics_nloc,metrics_complexity,metrics_entropy,metrics_tokens,metrics_depth,metrics_loc,metrics_template_expressions,metrics_references,metrics_attributes,provider_name,provider_version,resource_schema,block_documentation_identifiers,matched_type,file_content
aneoconsulting__ArmoniK,a19ed3ce4816a69b09bf148a323ed85bed458965,clones/aneoconsulting__ArmoniK/infrastructure/modules/k8s/chaos_mesh,c89d33c1604a1e3f603c8aa97ef7170c89c54454,error,Unsupported block type,"Blocks of type ""set"" are not expected here. Did you mean to define argument ""set""? If so, use the equals sign to assign it a value.",clones/aneoconsulting__ArmoniK/infrastructure/modules/k8s/chaos_mesh/main.tf,33,3,33,6,resource,helm_release chaosmesh,"resource ""helm_release"" ""chaosmesh"" {
  name       = ""chaosmesh""
  namespace  = kubernetes_namespace.chaosmesh.metadata[0].name
  chart      = ""chaos-mesh""
  repository = var.helm_chart_repository
  version    = var.helm_chart_version

  values = var.node_selector != null ? [yamlencode({
    controllerManager = {
      nodeSelector = var.node_selector
    }
    chaosDaemon = {
      nodeSelector = var.node_selector
    }
    dashboard = {
      nodeSelector = var.node_selector
    }
    dnsServer = {
      nodeSelector = var.node_selector
    }
    prometheus = {
      nodeSelector = var.node_selector
    }
  })] : []

  set {
    name  = ""image.chaosmesh.repository""
    value = var.docker_image.chaosmesh.image
  }
  set {
    name  = ""image.chaosdaemon.tag""
    value = var.docker_image.chaosdaemon.tag
  }
  set {
    name  = ""image.chaosdashboard.tag""
    value = var.docker_image.chaosdashboard.tag
  }

  set {
    name  = ""dashboard.service.type""
    value = var.service_type
  }
}",8,50,resource helm_release chaosmesh,3,2,4.46,152,43,40,0,21,14,helm,3.1.1,"{""attributes"": {""atomic"": {""type"": ""bool"", ""description"": ""If set, installation process purges chart on fail. The wait flag will be set automatically if atomic is used"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""chart"": {""type"": ""string"", ""description"": ""Chart name to be installed. A path may be used"", ""description_kind"": ""plain"", ""required"": true}, ""cleanup_on_fail"": {""type"": ""bool"", ""description"": ""Allow deletion of new resources created in this upgrade when upgrade fails"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""create_namespace"": {""type"": ""bool"", ""description"": ""Create the namespace if it does not exist"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""dependency_update"": {""type"": ""bool"", ""description"": ""Run helm dependency update before installing the chart"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""description"": {""type"": ""string"", ""description"": ""Add a custom description"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""devel"": {""type"": ""bool"", ""description"": ""Use chart development versions, too. Equivalent to version '>0.0.0-0'. If 'version' is set, this is ignored"", ""description_kind"": ""plain"", ""optional"": true}, ""disable_crd_hooks"": {""type"": ""bool"", ""description"": ""Prevent CRD hooks from running, but run other hooks. See helm install --no-crd-hook"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""disable_openapi_validation"": {""type"": ""bool"", ""description"": ""If set, the installation process will not validate rendered templates against the Kubernetes OpenAPI Schema"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""disable_webhooks"": {""type"": ""bool"", ""description"": ""Prevent hooks from running"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""force_update"": {""type"": ""bool"", ""description"": ""Force resource update through delete/recreate if needed."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""keyring"": {""type"": ""string"", ""description"": ""Location of public keys used for verification, Used only if 'verify is true'"", ""description_kind"": ""plain"", ""optional"": true}, ""lint"": {""type"": ""bool"", ""description"": ""Run helm lint when planning"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""manifest"": {""type"": ""string"", ""description"": ""The rendered manifest as JSON."", ""description_kind"": ""plain"", ""computed"": true}, ""max_history"": {""type"": ""number"", ""description"": ""Limit the maximum number of revisions saved per release. Use 0 for no limit"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""metadata"": {""nested_type"": {""attributes"": {""app_version"": {""type"": ""string"", ""description"": ""The version number of the application being deployed"", ""description_kind"": ""plain"", ""computed"": true}, ""chart"": {""type"": ""string"", ""description"": ""The name of the chart"", ""description_kind"": ""plain"", ""computed"": true}, ""first_deployed"": {""type"": ""number"", ""description"": ""FirstDeployed is an int64 which represents timestamp when the release was first deployed."", ""description_kind"": ""plain"", ""computed"": true}, ""last_deployed"": {""type"": ""number"", ""description"": ""LastDeployed is an int64 which represents timestamp when the release was last deployed."", ""description_kind"": ""plain"", ""computed"": true}, ""name"": {""type"": ""string"", ""description"": ""Name is the name of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""namespace"": {""type"": ""string"", ""description"": ""Namespace is the kubernetes namespace of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""notes"": {""type"": ""string"", ""description"": ""Notes is the description of the deployed release, rendered from templates."", ""description_kind"": ""plain"", ""computed"": true}, ""revision"": {""type"": ""number"", ""description"": ""Version is an int32 which represents the version of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""values"": {""type"": ""string"", ""description"": ""Set of extra values. added to the chart. The sensitive data is cloaked. JSON encoded."", ""description_kind"": ""plain"", ""computed"": true}, ""version"": {""type"": ""string"", ""description"": ""A SemVer 2 conformant version string of the chart"", ""description_kind"": ""plain"", ""computed"": true}}, ""nesting_mode"": ""single""}, ""description"": ""Status of the deployed release."", ""description_kind"": ""plain"", ""computed"": true}, ""name"": {""type"": ""string"", ""description"": ""Release name. The length must not be longer than 53 characters"", ""description_kind"": ""plain"", ""required"": true}, ""namespace"": {""type"": ""string"", ""description"": ""Namespace to install the release into"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""pass_credentials"": {""type"": ""bool"", ""description"": ""Pass credentials to all domains"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""postrender"": {""nested_type"": {""attributes"": {""args"": {""type"": [""list"", ""string""], ""description"": ""An argument to the post-renderer (can specify multiple)"", ""description_kind"": ""plain"", ""optional"": true}, ""binary_path"": {""type"": ""string"", ""description"": ""The common binary path"", ""description_kind"": ""plain"", ""required"": true}}, ""nesting_mode"": ""single""}, ""description"": ""Postrender command config"", ""description_kind"": ""plain"", ""optional"": true}, ""recreate_pods"": {""type"": ""bool"", ""description"": ""Perform pods restart during upgrade/rollback"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""render_subchart_notes"": {""type"": ""bool"", ""description"": ""If set, render subchart notes along with the parent"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""replace"": {""type"": ""bool"", ""description"": ""Re-use the given name, even if that name is already used. This is unsafe in production"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""repository"": {""type"": ""string"", ""description"": ""Repository where to locate the requested chart. If it is a URL, the chart is installed without installing the repository"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_ca_file"": {""type"": ""string"", ""description"": ""The Repositories CA file"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_cert_file"": {""type"": ""string"", ""description"": ""The repositories cert file"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_key_file"": {""type"": ""string"", ""description"": ""The repositories cert key file"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_password"": {""type"": ""string"", ""description"": ""Password for HTTP basic authentication"", ""description_kind"": ""plain"", ""optional"": true, ""sensitive"": true}, ""repository_username"": {""type"": ""string"", ""description"": ""Username for HTTP basic authentication"", ""description_kind"": ""plain"", ""optional"": true}, ""reset_values"": {""type"": ""bool"", ""description"": ""When upgrading, reset the values to the ones built into the chart"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""resources"": {""type"": [""map"", ""string""], ""description"": ""The kubernetes resources created by this release."", ""description_kind"": ""plain"", ""computed"": true}, ""reuse_values"": {""type"": ""bool"", ""description"": ""When upgrading, reuse the last release's values and merge in any overrides. If 'reset_values' is specified, this is ignored"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""set"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""value"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_list"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""value"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""required"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom sensitive values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_sensitive"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""value"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true, ""sensitive"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom sensitive values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_wo"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""value"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_wo_revision"": {""type"": ""number"", ""description"": ""The current revision of the write-only \""set_wo\"" attribute. Incrementing this integer value will cause Terraform to update the write-only value."", ""description_kind"": ""plain"", ""optional"": true}, ""skip_crds"": {""type"": ""bool"", ""description"": ""If set, no CRDs will be installed. By default, CRDs are installed if not already present"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""status"": {""type"": ""string"", ""description"": ""Status of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""take_ownership"": {""type"": ""bool"", ""description"": ""If set, Helm will take ownership of resources not already annotated by this release. Useful for migrations or recovery."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeout"": {""type"": ""number"", ""description"": ""Time in seconds to wait for any individual kubernetes operation"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeouts"": {""nested_type"": {""attributes"": {""create"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours)."", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours). Setting a timeout for a Delete operation is only applicable if changes are saved into state before the destroy operation occurs."", ""description_kind"": ""plain"", ""optional"": true}, ""read"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours). Read operations occur during any refresh or planning operation when refresh is enabled."", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours)."", ""description_kind"": ""plain"", ""optional"": true}}, ""nesting_mode"": ""single""}, ""description_kind"": ""plain"", ""optional"": true}, ""upgrade_install"": {""type"": ""bool"", ""description"": ""If true, the provider will install the release at the specified version even if a release not controlled by the provider is present. This is equivalent to running 'helm upgrade --install'. WARNING: this may not be suitable for production use -- see the 'Upgrade Mode' note in the provider documentation. Defaults to `false`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""values"": {""type"": [""list"", ""string""], ""description"": ""List of values in raw YAML format to pass to helm"", ""description_kind"": ""plain"", ""optional"": true}, ""verify"": {""type"": ""bool"", ""description"": ""Verify the package before installing it."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""version"": {""type"": ""string"", ""description"": ""Specify the exact chart version to install. If this is not specified, the latest version is installed"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""wait"": {""type"": ""bool"", ""description"": ""Will wait until all resources are in a ready state before marking the release as successful."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""wait_for_jobs"": {""type"": ""bool"", ""description"": ""If wait is enabled, will wait until all Jobs have been completed before marking the release as successful."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {}, ""matched_block_name"": ""helm_release"", ""matched_block_type"": ""resource""}",helm_release,resource,"
resource ""kubernetes_namespace"" ""chaosmesh"" {
  metadata {
    name = var.namespace
  }
}

resource ""helm_release"" ""chaosmesh"" {
  name       = ""chaosmesh""
  namespace  = kubernetes_namespace.chaosmesh.metadata[0].name
  chart      = ""chaos-mesh""
  repository = var.helm_chart_repository
  version    = var.helm_chart_version

  values = var.node_selector != null ? [yamlencode({
    controllerManager = {
      nodeSelector = var.node_selector
    }
    chaosDaemon = {
      nodeSelector = var.node_selector
    }
    dashboard = {
      nodeSelector = var.node_selector
    }
    dnsServer = {
      nodeSelector = var.node_selector
    }
    prometheus = {
      nodeSelector = var.node_selector
    }
  })] : []

  set {
    name  = ""image.chaosmesh.repository""
    value = var.docker_image.chaosmesh.image
  }
  set {
    name  = ""image.chaosdaemon.tag""
    value = var.docker_image.chaosdaemon.tag
  }
  set {
    name  = ""image.chaosdashboard.tag""
    value = var.docker_image.chaosdashboard.tag
  }

  set {
    name  = ""dashboard.service.type""
    value = var.service_type
  }
}

data ""kubernetes_service"" ""chaos_dashboard"" {
  metadata {
    name      = ""chaos-dashboard""
    namespace = var.namespace
  }
  depends_on = [resource.helm_release.chaosmesh]
}
"
aneoconsulting__ArmoniK,a19ed3ce4816a69b09bf148a323ed85bed458965,clones/aneoconsulting__ArmoniK/infrastructure/modules/k8s/chaos_mesh,6b0ad6fc76bbc3a189e0a798402889b0a5f1132a,warning,Deprecated Resource,Deprecated; use kubernetes_namespace_v1.,clones/aneoconsulting__ArmoniK/infrastructure/modules/k8s/chaos_mesh/main.tf,2,45,2,46,resource,kubernetes_namespace chaosmesh,"resource ""kubernetes_namespace"" ""chaosmesh"" {
  metadata {
    name = var.namespace
  }
}",2,6,resource kubernetes_namespace chaosmesh,0,1,4.01,13,5,5,0,1,1,kubernetes,3.0.1,"{""attributes"": {""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""wait_for_default_service_account"": {""type"": ""bool"", ""description"": ""Terraform will wait for the default service account to be created."", ""description_kind"": ""plain"", ""optional"": true}}, ""block_types"": {""metadata"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""annotations"": {""type"": [""map"", ""string""], ""description"": ""An unstructured key value map stored with the namespace that may be used to store arbitrary metadata. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/"", ""description_kind"": ""plain"", ""optional"": true}, ""generate_name"": {""type"": ""string"", ""description"": ""Prefix, used by the server, to generate a unique name ONLY IF the `name` field has not been provided. This value will also be combined with a unique suffix. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#idempotency"", ""description_kind"": ""plain"", ""optional"": true}, ""generation"": {""type"": ""number"", ""description"": ""A sequence number representing a specific generation of the desired state."", ""description_kind"": ""plain"", ""computed"": true}, ""labels"": {""type"": [""map"", ""string""], ""description"": ""Map of string keys and values that can be used to organize and categorize (scope and select) the namespace. May match selectors of replication controllers and services. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/"", ""description_kind"": ""plain"", ""optional"": true}, ""name"": {""type"": ""string"", ""description"": ""Name of the namespace, must be unique. Cannot be updated. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""resource_version"": {""type"": ""string"", ""description"": ""An opaque value that represents the internal version of this namespace that can be used by clients to determine when namespace has changed. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency"", ""description_kind"": ""plain"", ""computed"": true}, ""uid"": {""type"": ""string"", ""description"": ""The unique in time and space value for this namespace. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids"", ""description_kind"": ""plain"", ""computed"": true}}, ""description"": ""Standard namespace's metadata. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata"", ""description_kind"": ""plain""}, ""min_items"": 1, ""max_items"": 1}, ""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}}, ""matched_block_name"": ""kubernetes_namespace"", ""matched_block_type"": ""resource""}",kubernetes_namespace,resource,"
resource ""kubernetes_namespace"" ""chaosmesh"" {
  metadata {
    name = var.namespace
  }
}

resource ""helm_release"" ""chaosmesh"" {
  name       = ""chaosmesh""
  namespace  = kubernetes_namespace.chaosmesh.metadata[0].name
  chart      = ""chaos-mesh""
  repository = var.helm_chart_repository
  version    = var.helm_chart_version

  values = var.node_selector != null ? [yamlencode({
    controllerManager = {
      nodeSelector = var.node_selector
    }
    chaosDaemon = {
      nodeSelector = var.node_selector
    }
    dashboard = {
      nodeSelector = var.node_selector
    }
    dnsServer = {
      nodeSelector = var.node_selector
    }
    prometheus = {
      nodeSelector = var.node_selector
    }
  })] : []

  set {
    name  = ""image.chaosmesh.repository""
    value = var.docker_image.chaosmesh.image
  }
  set {
    name  = ""image.chaosdaemon.tag""
    value = var.docker_image.chaosdaemon.tag
  }
  set {
    name  = ""image.chaosdashboard.tag""
    value = var.docker_image.chaosdashboard.tag
  }

  set {
    name  = ""dashboard.service.type""
    value = var.service_type
  }
}

data ""kubernetes_service"" ""chaos_dashboard"" {
  metadata {
    name      = ""chaos-dashboard""
    namespace = var.namespace
  }
  depends_on = [resource.helm_release.chaosmesh]
}
"
api3dao__airnode,d74857c705a8d655f476e5f81649020b1a5a43ff,clones/api3dao__airnode/packages/airnode-deployer/terraform/gcp/modules/function,6eaa5bbb70fe01aaa02909024e82fcd8dd9dda85,warning,Attribute Deprecated,"**NOTE**: This is deprecated, use `numeric` instead.",clones/api3dao__airnode/packages/airnode-deployer/terraform/gcp/modules/function/main.tf,6,13,6,18,resource,random_string function_service_account_id,"resource ""random_string"" ""function_service_account_id"" {
  length  = 20
  lower   = true
  upper   = false
  special = false
  number  = false
}",1,7,resource random_string function_service_account_id,0,1,4.39,20,7,7,0,0,5,random,3.7.2,"{""attributes"": {""id"": {""type"": ""string"", ""description"": ""The generated random string."", ""description_kind"": ""plain"", ""computed"": true}, ""keepers"": {""type"": [""map"", ""string""], ""description"": ""Arbitrary map of values that, when changed, will trigger recreation of resource. See [the main provider documentation](../index.html) for more information."", ""description_kind"": ""plain"", ""optional"": true}, ""length"": {""type"": ""number"", ""description"": ""The length of the string desired. The minimum value for length is 1 and, length must also be >= (`min_upper` + `min_lower` + `min_numeric` + `min_special`)."", ""description_kind"": ""plain"", ""required"": true}, ""lower"": {""type"": ""bool"", ""description"": ""Include lowercase alphabet characters in the result. Default value is `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_lower"": {""type"": ""number"", ""description"": ""Minimum number of lowercase alphabet characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_numeric"": {""type"": ""number"", ""description"": ""Minimum number of numeric characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_special"": {""type"": ""number"", ""description"": ""Minimum number of special characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_upper"": {""type"": ""number"", ""description"": ""Minimum number of uppercase alphabet characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""number"": {""type"": ""bool"", ""description"": ""Include numeric characters in the result. Default value is `true`. If `number`, `upper`, `lower`, and `special` are all configured, at least one of them must be set to `true`. **NOTE**: This is deprecated, use `numeric` instead."", ""description_kind"": ""plain"", ""deprecated"": true, ""optional"": true, ""computed"": true}, ""numeric"": {""type"": ""bool"", ""description"": ""Include numeric characters in the result. Default value is `true`. If `numeric`, `upper`, `lower`, and `special` are all configured, at least one of them must be set to `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""override_special"": {""type"": ""string"", ""description"": ""Supply your own list of special characters to use for string generation.  This overrides the default character list in the special argument.  The `special` argument must still be set to true for any overwritten characters to be used in generation."", ""description_kind"": ""plain"", ""optional"": true}, ""result"": {""type"": ""string"", ""description"": ""The generated random string."", ""description_kind"": ""plain"", ""computed"": true}, ""special"": {""type"": ""bool"", ""description"": ""Include special characters in the result. These are `!@#$%&*()-_=+[]{}<>:?`. Default value is `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""upper"": {""type"": ""bool"", ""description"": ""Include uppercase alphabet characters in the result. Default value is `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {}, ""matched_block_name"": ""random_string"", ""matched_block_type"": ""resource""}",random_string,resource,"resource ""random_string"" ""function_service_account_id"" {
  length  = 20
  lower   = true
  upper   = false
  special = false
  number  = false
}

resource ""local_file"" ""index_js"" {
  source   = ""${var.source_dir}/index.js""
  filename = ""${local.tmp_dir}/index.js""
}

resource ""local_file"" ""gcp_index_js"" {
  source   = ""${var.source_dir}/handlers/gcp/index.js""
  filename = ""${local.tmp_dir}/handlers/gcp/index.js""
}

resource ""local_file"" ""config_json"" {
  source   = var.configuration_file
  filename = ""${local.tmp_dir}/config-data/config.json""
}

resource ""google_service_account"" ""function_service_account"" {
  account_id   = random_string.function_service_account_id.result
  display_name = ""${var.name}-function""
}

resource ""google_project_iam_member"" ""function_monitoring_writer_role"" {
  role    = ""roles/monitoring.metricWriter""
  member  = ""serviceAccount:${google_service_account.function_service_account.email}""
  project = var.project
}

resource ""google_project_iam_member"" ""function_logging_writer_role"" {
  role    = ""roles/logging.logWriter""
  member  = ""serviceAccount:${google_service_account.function_service_account.email}""
  project = var.project
}

resource ""google_cloudfunctions_function_iam_member"" ""invoker"" {
  for_each = var.invoke_targets

  cloud_function = each.value
  role           = ""roles/cloudfunctions.invoker""
  member         = ""serviceAccount:${google_service_account.function_service_account.email}""
  project        = var.project
}

resource ""google_storage_bucket_object"" ""function_zip"" {
  # Append file SHA1 to force bucket to be recreated
  name   = ""${var.deployment_bucket_dir}/${var.name}-source#${data.archive_file.function_zip.output_sha}.zip""
  bucket = var.airnode_bucket
  source = data.archive_file.function_zip.output_path
}

resource ""google_cloudfunctions_function"" ""function"" {
  name    = var.name
  runtime = ""nodejs22""

  available_memory_mb   = var.memory_size
  source_archive_bucket = google_storage_bucket_object.function_zip.bucket
  source_archive_object = google_storage_bucket_object.function_zip.name
  trigger_http          = true
  entry_point           = var.entry_point
  timeout               = var.timeout
  max_instances         = var.max_instances
  environment_variables = merge(
    var.environment_variables,
    local.secrets,
    { AIRNODE_CLOUD_PROVIDER = ""gcp"" }
  )
  service_account_email = google_service_account.function_service_account.email
}

resource ""random_string"" ""scheduler_service_account_id"" {
  count = var.schedule_interval == 0 ? 0 : 1

  length  = 20
  lower   = true
  upper   = false
  special = false
  number  = false
}

resource ""google_app_engine_application"" ""app"" {
  count = var.schedule_interval == 0 ? 0 : 1

  project     = data.google_project.project.project_id
  location_id = local.app_engine_location_id
}

resource ""google_service_account"" ""scheduler_service_account"" {
  count = var.schedule_interval == 0 ? 0 : 1

  account_id   = random_string.scheduler_service_account_id[0].result
  display_name = ""${var.name}-scheduler""
}

resource ""google_cloudfunctions_function_iam_member"" ""scheduler_invoker"" {
  count          = var.schedule_interval == 0 ? 0 : 1
  cloud_function = google_cloudfunctions_function.function.name

  role    = ""roles/cloudfunctions.invoker""
  member  = ""serviceAccount:${google_service_account.scheduler_service_account[0].email}""
  project = var.project
}

resource ""google_cloud_scheduler_job"" ""scheduler_job"" {
  count = var.schedule_interval == 0 ? 0 : 1

  name             = var.name
  schedule         = ""*/${var.schedule_interval} * * * *""
  attempt_deadline = ""${var.timeout}s""

  http_target {
    http_method = ""GET""
    uri         = google_cloudfunctions_function.function.https_trigger_url

    oidc_token {
      service_account_email = google_service_account.scheduler_service_account[0].email
    }
  }

  depends_on = [
    google_app_engine_application.app
  ]
}
"
api3dao__airnode,d74857c705a8d655f476e5f81649020b1a5a43ff,clones/api3dao__airnode/packages/airnode-deployer/terraform/gcp/modules/function,d79b47c38c6320cfbe41ae17851bcd0cd7b5e8bd,warning,Attribute Deprecated,"**NOTE**: This is deprecated, use `numeric` instead.",clones/api3dao__airnode/packages/airnode-deployer/terraform/gcp/modules/function/main.tf,83,13,83,18,resource,random_string scheduler_service_account_id,"resource ""random_string"" ""scheduler_service_account_id"" {
  count = var.schedule_interval == 0 ? 0 : 1

  length  = 20
  lower   = true
  upper   = false
  special = false
  number  = false
}",76,84,resource random_string scheduler_service_account_id,1,2,4.5,31,9,8,0,1,6,random,3.7.2,"{""attributes"": {""id"": {""type"": ""string"", ""description"": ""The generated random string."", ""description_kind"": ""plain"", ""computed"": true}, ""keepers"": {""type"": [""map"", ""string""], ""description"": ""Arbitrary map of values that, when changed, will trigger recreation of resource. See [the main provider documentation](../index.html) for more information."", ""description_kind"": ""plain"", ""optional"": true}, ""length"": {""type"": ""number"", ""description"": ""The length of the string desired. The minimum value for length is 1 and, length must also be >= (`min_upper` + `min_lower` + `min_numeric` + `min_special`)."", ""description_kind"": ""plain"", ""required"": true}, ""lower"": {""type"": ""bool"", ""description"": ""Include lowercase alphabet characters in the result. Default value is `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_lower"": {""type"": ""number"", ""description"": ""Minimum number of lowercase alphabet characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_numeric"": {""type"": ""number"", ""description"": ""Minimum number of numeric characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_special"": {""type"": ""number"", ""description"": ""Minimum number of special characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_upper"": {""type"": ""number"", ""description"": ""Minimum number of uppercase alphabet characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""number"": {""type"": ""bool"", ""description"": ""Include numeric characters in the result. Default value is `true`. If `number`, `upper`, `lower`, and `special` are all configured, at least one of them must be set to `true`. **NOTE**: This is deprecated, use `numeric` instead."", ""description_kind"": ""plain"", ""deprecated"": true, ""optional"": true, ""computed"": true}, ""numeric"": {""type"": ""bool"", ""description"": ""Include numeric characters in the result. Default value is `true`. If `numeric`, `upper`, `lower`, and `special` are all configured, at least one of them must be set to `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""override_special"": {""type"": ""string"", ""description"": ""Supply your own list of special characters to use for string generation.  This overrides the default character list in the special argument.  The `special` argument must still be set to true for any overwritten characters to be used in generation."", ""description_kind"": ""plain"", ""optional"": true}, ""result"": {""type"": ""string"", ""description"": ""The generated random string."", ""description_kind"": ""plain"", ""computed"": true}, ""special"": {""type"": ""bool"", ""description"": ""Include special characters in the result. These are `!@#$%&*()-_=+[]{}<>:?`. Default value is `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""upper"": {""type"": ""bool"", ""description"": ""Include uppercase alphabet characters in the result. Default value is `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {}, ""matched_block_name"": ""random_string"", ""matched_block_type"": ""resource""}",random_string,resource,"resource ""random_string"" ""function_service_account_id"" {
  length  = 20
  lower   = true
  upper   = false
  special = false
  number  = false
}

resource ""local_file"" ""index_js"" {
  source   = ""${var.source_dir}/index.js""
  filename = ""${local.tmp_dir}/index.js""
}

resource ""local_file"" ""gcp_index_js"" {
  source   = ""${var.source_dir}/handlers/gcp/index.js""
  filename = ""${local.tmp_dir}/handlers/gcp/index.js""
}

resource ""local_file"" ""config_json"" {
  source   = var.configuration_file
  filename = ""${local.tmp_dir}/config-data/config.json""
}

resource ""google_service_account"" ""function_service_account"" {
  account_id   = random_string.function_service_account_id.result
  display_name = ""${var.name}-function""
}

resource ""google_project_iam_member"" ""function_monitoring_writer_role"" {
  role    = ""roles/monitoring.metricWriter""
  member  = ""serviceAccount:${google_service_account.function_service_account.email}""
  project = var.project
}

resource ""google_project_iam_member"" ""function_logging_writer_role"" {
  role    = ""roles/logging.logWriter""
  member  = ""serviceAccount:${google_service_account.function_service_account.email}""
  project = var.project
}

resource ""google_cloudfunctions_function_iam_member"" ""invoker"" {
  for_each = var.invoke_targets

  cloud_function = each.value
  role           = ""roles/cloudfunctions.invoker""
  member         = ""serviceAccount:${google_service_account.function_service_account.email}""
  project        = var.project
}

resource ""google_storage_bucket_object"" ""function_zip"" {
  # Append file SHA1 to force bucket to be recreated
  name   = ""${var.deployment_bucket_dir}/${var.name}-source#${data.archive_file.function_zip.output_sha}.zip""
  bucket = var.airnode_bucket
  source = data.archive_file.function_zip.output_path
}

resource ""google_cloudfunctions_function"" ""function"" {
  name    = var.name
  runtime = ""nodejs22""

  available_memory_mb   = var.memory_size
  source_archive_bucket = google_storage_bucket_object.function_zip.bucket
  source_archive_object = google_storage_bucket_object.function_zip.name
  trigger_http          = true
  entry_point           = var.entry_point
  timeout               = var.timeout
  max_instances         = var.max_instances
  environment_variables = merge(
    var.environment_variables,
    local.secrets,
    { AIRNODE_CLOUD_PROVIDER = ""gcp"" }
  )
  service_account_email = google_service_account.function_service_account.email
}

resource ""random_string"" ""scheduler_service_account_id"" {
  count = var.schedule_interval == 0 ? 0 : 1

  length  = 20
  lower   = true
  upper   = false
  special = false
  number  = false
}

resource ""google_app_engine_application"" ""app"" {
  count = var.schedule_interval == 0 ? 0 : 1

  project     = data.google_project.project.project_id
  location_id = local.app_engine_location_id
}

resource ""google_service_account"" ""scheduler_service_account"" {
  count = var.schedule_interval == 0 ? 0 : 1

  account_id   = random_string.scheduler_service_account_id[0].result
  display_name = ""${var.name}-scheduler""
}

resource ""google_cloudfunctions_function_iam_member"" ""scheduler_invoker"" {
  count          = var.schedule_interval == 0 ? 0 : 1
  cloud_function = google_cloudfunctions_function.function.name

  role    = ""roles/cloudfunctions.invoker""
  member  = ""serviceAccount:${google_service_account.scheduler_service_account[0].email}""
  project = var.project
}

resource ""google_cloud_scheduler_job"" ""scheduler_job"" {
  count = var.schedule_interval == 0 ? 0 : 1

  name             = var.name
  schedule         = ""*/${var.schedule_interval} * * * *""
  attempt_deadline = ""${var.timeout}s""

  http_target {
    http_method = ""GET""
    uri         = google_cloudfunctions_function.function.https_trigger_url

    oidc_token {
      service_account_email = google_service_account.scheduler_service_account[0].email
    }
  }

  depends_on = [
    google_app_engine_application.app
  ]
}
"
api3dao__airnode,d74857c705a8d655f476e5f81649020b1a5a43ff,clones/api3dao__airnode/packages/airnode-deployer/terraform/gcp/modules/apigateway,df44deb05e6be22b8b7eb86864af87975a125ea6,warning,Attribute Deprecated,"**NOTE**: This is deprecated, use `numeric` instead.",clones/api3dao__airnode/packages/airnode-deployer/terraform/gcp/modules/apigateway/main.tf,6,13,6,18,resource,random_string api_gateway_service_account_id,"resource ""random_string"" ""api_gateway_service_account_id"" {
  length  = 20
  lower   = true
  upper   = false
  special = false
  number  = false
}",1,7,resource random_string api_gateway_service_account_id,0,1,4.43,20,7,7,0,0,5,random,3.7.2,"{""attributes"": {""id"": {""type"": ""string"", ""description"": ""The generated random string."", ""description_kind"": ""plain"", ""computed"": true}, ""keepers"": {""type"": [""map"", ""string""], ""description"": ""Arbitrary map of values that, when changed, will trigger recreation of resource. See [the main provider documentation](../index.html) for more information."", ""description_kind"": ""plain"", ""optional"": true}, ""length"": {""type"": ""number"", ""description"": ""The length of the string desired. The minimum value for length is 1 and, length must also be >= (`min_upper` + `min_lower` + `min_numeric` + `min_special`)."", ""description_kind"": ""plain"", ""required"": true}, ""lower"": {""type"": ""bool"", ""description"": ""Include lowercase alphabet characters in the result. Default value is `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_lower"": {""type"": ""number"", ""description"": ""Minimum number of lowercase alphabet characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_numeric"": {""type"": ""number"", ""description"": ""Minimum number of numeric characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_special"": {""type"": ""number"", ""description"": ""Minimum number of special characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""min_upper"": {""type"": ""number"", ""description"": ""Minimum number of uppercase alphabet characters in the result. Default value is `0`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""number"": {""type"": ""bool"", ""description"": ""Include numeric characters in the result. Default value is `true`. If `number`, `upper`, `lower`, and `special` are all configured, at least one of them must be set to `true`. **NOTE**: This is deprecated, use `numeric` instead."", ""description_kind"": ""plain"", ""deprecated"": true, ""optional"": true, ""computed"": true}, ""numeric"": {""type"": ""bool"", ""description"": ""Include numeric characters in the result. Default value is `true`. If `numeric`, `upper`, `lower`, and `special` are all configured, at least one of them must be set to `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""override_special"": {""type"": ""string"", ""description"": ""Supply your own list of special characters to use for string generation.  This overrides the default character list in the special argument.  The `special` argument must still be set to true for any overwritten characters to be used in generation."", ""description_kind"": ""plain"", ""optional"": true}, ""result"": {""type"": ""string"", ""description"": ""The generated random string."", ""description_kind"": ""plain"", ""computed"": true}, ""special"": {""type"": ""bool"", ""description"": ""Include special characters in the result. These are `!@#$%&*()-_=+[]{}<>:?`. Default value is `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""upper"": {""type"": ""bool"", ""description"": ""Include uppercase alphabet characters in the result. Default value is `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {}, ""matched_block_name"": ""random_string"", ""matched_block_type"": ""resource""}",random_string,resource,"resource ""random_string"" ""api_gateway_service_account_id"" {
  length  = 20
  lower   = true
  upper   = false
  special = false
  number  = false
}

resource ""google_service_account"" ""api_gateway_service_account"" {
  account_id   = random_string.api_gateway_service_account_id.result
  display_name = var.name
}

resource ""google_project_iam_member"" ""api_gateway_monitoring_writer_role"" {
  role    = ""roles/monitoring.metricWriter""
  member  = ""serviceAccount:${google_service_account.api_gateway_service_account.email}""
  project = var.project
}

resource ""google_project_iam_member"" ""api_gateway_logging_writer_role"" {
  role    = ""roles/logging.logWriter""
  member  = ""serviceAccount:${google_service_account.api_gateway_service_account.email}""
  project = var.project
}

resource ""google_cloudfunctions_function_iam_member"" ""invoker"" {
  for_each = var.invoke_targets

  cloud_function = each.value
  role           = ""roles/cloudfunctions.invoker""
  member         = ""serviceAccount:${google_service_account.api_gateway_service_account.email}""
  project        = var.project
}

resource ""google_api_gateway_api"" ""api_gateway_api"" {
  provider = google-beta

  api_id       = lower(var.name)
  display_name = var.name
}

resource ""google_api_gateway_api_config"" ""api_gateway_api_config"" {
  provider = google-beta

  api = google_api_gateway_api.api_gateway_api.api_id
  # Generating a suffix manually because the one generated with `api_config_id_prefix` is far too long
  api_config_id = lower(""${var.name}-${substr(uuid(), 0, 8)}"")
  display_name  = var.name

  openapi_documents {
    document {
      path     = ""spec.yaml""
      contents = base64encode(templatefile(var.template_file, var.template_variables))
    }
  }

  gateway_config {
    backend_config {
      google_service_account = google_service_account.api_gateway_service_account.email
    }
  }

  lifecycle {
    create_before_destroy = true
  }
}

resource ""google_api_gateway_gateway"" ""api_gateway_api_gateway"" {
  provider = google-beta

  api_config   = google_api_gateway_api_config.api_gateway_api_config.id
  gateway_id   = lower(var.name)
  display_name = var.name
}
"
Capgemini__Apollo,21f949d8cec5a07a97202cfcb67a0dbf8c90090b,clones/Capgemini__Apollo/terraform/aws/private-cloud/vpc,ff4353fa22fc985d5bf8991b3d1adb49795b2056,error,Unsupported block type,"Blocks of type ""tags"" are not expected here. Did you mean to define argument ""tags""? If so, use the equals sign to assign it a value.",clones/Capgemini__Apollo/terraform/aws/private-cloud/vpc/main.tf,21,3,21,7,resource,aws_vpc mod,"resource ""aws_vpc"" ""mod"" {
  cidr_block           = ""${var.cidr}""
  enable_dns_hostnames = ""${var.enable_dns_hostnames}""
  enable_dns_support   = ""${var.enable_dns_support}""
  tags {
    Name = ""${var.name}""
  }
}",17,24,resource aws_vpc mod,0,1,4.5,44,8,8,4,4,4,aws,6.26.0,"{""attributes"": {""arn"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""assign_generated_ipv6_cidr_block"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""cidr_block"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""default_network_acl_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""default_route_table_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""default_security_group_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""dhcp_options_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""enable_dns_hostnames"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""enable_dns_support"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""enable_network_address_usage_metrics"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""instance_tenancy"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""ipv4_ipam_pool_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""ipv4_netmask_length"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""ipv6_association_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""ipv6_cidr_block"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""ipv6_cidr_block_network_border_group"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""ipv6_ipam_pool_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""ipv6_netmask_length"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""main_route_table_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""owner_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""region"": {""type"": ""string"", ""description"": ""Region where this resource will be [managed](https://docs.aws.amazon.com/general/latest/gr/rande.html#regional-endpoints). Defaults to the Region set in the [provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#aws-configuration-reference)."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""tags"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""tags_all"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {}, ""matched_block_name"": ""aws_vpc"", ""matched_block_type"": ""resource""}",aws_vpc,resource,"variable ""name"" { }
variable ""cidr"" { }
variable ""public_subnets"" { default = """" }
variable ""private_subnets"" { default = """" }
variable ""bastion_instance_id"" { }
variable ""azs"" { }
variable ""enable_dns_hostnames"" {
  description = ""should be true if you want to use private DNS within the VPC""
  default = false
}
variable ""enable_dns_support"" {
  description = ""should be true if you want to use private DNS within the VPC""
  default = false
}

# resources
resource ""aws_vpc"" ""mod"" {
  cidr_block           = ""${var.cidr}""
  enable_dns_hostnames = ""${var.enable_dns_hostnames}""
  enable_dns_support   = ""${var.enable_dns_support}""
  tags {
    Name = ""${var.name}""
  }
}

resource ""aws_internet_gateway"" ""mod"" {
  vpc_id = ""${aws_vpc.mod.id}""
}

resource ""aws_route_table"" ""public"" {
  vpc_id = ""${aws_vpc.mod.id}""
  route {
      cidr_block = ""0.0.0.0/0""
      gateway_id = ""${aws_internet_gateway.mod.id}""
  }
  tags {
    Name = ""${var.name}-public""
  }
}

resource ""aws_route_table"" ""private"" {
  vpc_id = ""${aws_vpc.mod.id}""
  route {
    cidr_block  = ""0.0.0.0/0""
    instance_id = ""${var.bastion_instance_id}""
  }
  tags {
    Name = ""${var.name}-private""
  }
}

resource ""aws_subnet"" ""private"" {
  vpc_id            = ""${aws_vpc.mod.id}""
  cidr_block        = ""${element(split("","", var.private_subnets), count.index)}""
  availability_zone = ""${element(split("","", var.azs), count.index)}""
  count             = ""${length(compact(split("","", var.private_subnets)))}""
  tags {
    Name = ""${var.name}-private""
  }
}

resource ""aws_subnet"" ""public"" {
  vpc_id            = ""${aws_vpc.mod.id}""
  cidr_block        = ""${element(split("","", var.public_subnets), count.index)}""
  availability_zone = ""${element(split("","", var.azs), count.index)}""
  count             = ""${length(compact(split("","", var.public_subnets)))}""
  tags {
    Name = ""${var.name}-public""
  }

  map_public_ip_on_launch = true
}

resource ""aws_route_table_association"" ""private"" {
  count          = ""${length(compact(split("","", var.private_subnets)))}""
  subnet_id      = ""${element(aws_subnet.private.*.id, count.index)}""
  route_table_id = ""${aws_route_table.private.id}""
}

resource ""aws_route_table_association"" ""public"" {
  count          = ""${length(compact(split("","", var.public_subnets)))}""
  subnet_id      = ""${element(aws_subnet.public.*.id, count.index)}""
  route_table_id = ""${aws_route_table.public.id}""
}

# outputs
output ""private_subnets"" {
  value = ""${join("","", aws_subnet.private.*.id)}""
}
output ""public_subnets"" {
  value = ""${join("","", aws_subnet.public.*.id)}""
}
output ""vpc_id"" {
  value = ""${aws_vpc.mod.id}""
}
output ""vpc_cidr_block"" {
  value = ""${aws_vpc.mod.cidr_block}""
}
"
Capgemini__Apollo,21f949d8cec5a07a97202cfcb67a0dbf8c90090b,clones/Capgemini__Apollo/terraform/aws/sg-all-traffic,00c6342b49aa4d7e7fc8b83a37d53ce671be2527,error,Unsupported block type,"Blocks of type ""tags"" are not expected here. Did you mean to define argument ""tags""? If so, use the equals sign to assign it a value.",clones/Capgemini__Apollo/terraform/aws/sg-all-traffic/main.tf,34,3,34,7,resource,aws_security_group default,"resource ""aws_security_group"" ""default"" {
  name        = ""${var.security_group_name}""
  description = ""Default security group that allows all traffic""
  vpc_id      = ""${var.vpc_id}""

  # Allows inbound and outbound traffic from all instances in the VPC.
  ingress {
    from_port = ""0""
    to_port   = ""0""
    protocol  = ""-1""
    self      = true
  }

  # Allows all inbound traffic
  ingress {
    from_port   = ""0""
    to_port     = ""0""
    protocol    = ""-1""
    cidr_blocks = [""${var.source_cidr_block}""]
  }

  # Allows all outbound traffic.
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = ""-1""
    cidr_blocks = [""${var.source_cidr_block}""]
  }
  tags {
    Name = ""apollo-default-sg""
  }
}",6,37,resource aws_security_group default,6,1,4.78,93,32,26,4,4,16,aws,6.26.0,"{""attributes"": {""arn"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""description"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""egress"": {""type"": [""set"", [""object"", {""cidr_blocks"": [""list"", ""string""], ""description"": ""string"", ""from_port"": ""number"", ""ipv6_cidr_blocks"": [""list"", ""string""], ""prefix_list_ids"": [""list"", ""string""], ""protocol"": ""string"", ""security_groups"": [""set"", ""string""], ""self"": ""bool"", ""to_port"": ""number""}]], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""ingress"": {""type"": [""set"", [""object"", {""cidr_blocks"": [""list"", ""string""], ""description"": ""string"", ""from_port"": ""number"", ""ipv6_cidr_blocks"": [""list"", ""string""], ""prefix_list_ids"": [""list"", ""string""], ""protocol"": ""string"", ""security_groups"": [""set"", ""string""], ""self"": ""bool"", ""to_port"": ""number""}]], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name_prefix"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""owner_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""region"": {""type"": ""string"", ""description"": ""Region where this resource will be [managed](https://docs.aws.amazon.com/general/latest/gr/rande.html#regional-endpoints). Defaults to the Region set in the [provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#aws-configuration-reference)."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""revoke_rules_on_delete"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""tags"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""tags_all"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""vpc_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""create"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}}, ""matched_block_name"": ""aws_security_group"", ""matched_block_type"": ""resource""}",aws_security_group,resource,"variable ""security_group_name"" { default = ""default-apollo-mesos"" }
variable ""vpc_id"" {}
variable ""source_cidr_block"" { default = ""0.0.0.0/0"" }

# Security group that allows all traffic
resource ""aws_security_group"" ""default"" {
  name        = ""${var.security_group_name}""
  description = ""Default security group that allows all traffic""
  vpc_id      = ""${var.vpc_id}""

  # Allows inbound and outbound traffic from all instances in the VPC.
  ingress {
    from_port = ""0""
    to_port   = ""0""
    protocol  = ""-1""
    self      = true
  }

  # Allows all inbound traffic
  ingress {
    from_port   = ""0""
    to_port     = ""0""
    protocol    = ""-1""
    cidr_blocks = [""${var.source_cidr_block}""]
  }

  # Allows all outbound traffic.
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = ""-1""
    cidr_blocks = [""${var.source_cidr_block}""]
  }
  tags {
    Name = ""apollo-default-sg""
  }
}

# output variables
output ""security_group_id"" {
  value = ""${aws_security_group.default.id}""
}
"
Capgemini__kubeform,a49b0dd29b302036be7d7958c31288db591516c3,clones/Capgemini__kubeform/terraform/aws/iam,6f9e05a68cb204e0c73b1bc878e4016c5218aa53,error,Unsupported argument,"An argument named ""roles"" is not expected here. Did you mean ""role""?",clones/Capgemini__kubeform/terraform/aws/iam/main.tf,52,3,52,8,resource,aws_iam_instance_profile edge-router_profile,"resource ""aws_iam_instance_profile"" ""edge-router_profile"" {
  name  = ""edge-router_profile""
  roles = [""${aws_iam_role.edge-router_role.name}""]
}",50,53,resource aws_iam_instance_profile edge-router_profile,0,1,4.32,21,4,4,1,2,2,aws,6.26.0,"{""attributes"": {""arn"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""create_date"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name_prefix"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""path"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""role"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""tags"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""tags_all"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""unique_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}}, ""block_types"": {}, ""matched_block_name"": ""aws_iam_instance_profile"", ""matched_block_type"": ""resource""}",aws_iam_instance_profile,resource,"# master
resource ""aws_iam_role"" ""master_role"" {
  name               = ""master_role""
  path               = ""/""
  assume_role_policy = ""${file(""${path.module}/master-role.json"")}""
}

resource ""aws_iam_role_policy"" ""master_policy"" {
  name   = ""master_policy""
  role   = ""${aws_iam_role.master_role.id}""
  policy = ""${file(""${path.module}/master-policy.json"")}""
}

resource ""aws_iam_instance_profile"" ""master_profile"" {
  name  = ""master_profile""
  roles = [""${aws_iam_role.master_role.name}""]
}

# worker
resource ""aws_iam_role"" ""worker_role"" {
  name               = ""worker_role""
  path               = ""/""
  assume_role_policy = ""${file(""${path.module}/worker-role.json"")}""
}

resource ""aws_iam_role_policy"" ""worker_policy"" {
  name   = ""worker_policy""
  role   = ""${aws_iam_role.worker_role.id}""
  policy = ""${file(""${path.module}/worker-policy.json"")}""
}

resource ""aws_iam_instance_profile"" ""worker_profile"" {
  name  = ""worker_profile""
  roles = [""${aws_iam_role.worker_role.name}""]
}

# edge-router
resource ""aws_iam_role"" ""edge-router_role"" {
  name               = ""edge-router_role""
  path               = ""/""
  assume_role_policy = ""${file(""${path.module}/edge-router-role.json"")}""
}

resource ""aws_iam_role_policy"" ""edge-router_policy"" {
  name   = ""edge-router_policy""
  role   = ""${aws_iam_role.edge-router_role.id}""
  policy = ""${file(""${path.module}/edge-router-policy.json"")}""
}

resource ""aws_iam_instance_profile"" ""edge-router_profile"" {
  name  = ""edge-router_profile""
  roles = [""${aws_iam_role.edge-router_role.name}""]
}

# outputs
output ""master_profile_name"" {
  value = ""${aws_iam_instance_profile.master_profile.name}""
}
output ""worker_profile_name"" {
  value = ""${aws_iam_instance_profile.worker_profile.name}""
}
output ""edge-router_profile_name"" {
  value = ""${aws_iam_instance_profile.edge-router_profile.name}""
}
"
Capgemini__kubeform,a49b0dd29b302036be7d7958c31288db591516c3,clones/Capgemini__kubeform/terraform/aws/iam,5e6aa371dfa732290fec670421ffdcf032c9e940,error,Unsupported argument,"An argument named ""roles"" is not expected here. Did you mean ""role""?",clones/Capgemini__kubeform/terraform/aws/iam/main.tf,34,3,34,8,resource,aws_iam_instance_profile worker_profile,"resource ""aws_iam_instance_profile"" ""worker_profile"" {
  name  = ""worker_profile""
  roles = [""${aws_iam_role.worker_role.name}""]
}",32,35,resource aws_iam_instance_profile worker_profile,0,1,4.22,21,4,4,1,2,2,aws,6.26.0,"{""attributes"": {""arn"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""create_date"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name_prefix"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""path"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""role"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""tags"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""tags_all"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""unique_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}}, ""block_types"": {}, ""matched_block_name"": ""aws_iam_instance_profile"", ""matched_block_type"": ""resource""}",aws_iam_instance_profile,resource,"# master
resource ""aws_iam_role"" ""master_role"" {
  name               = ""master_role""
  path               = ""/""
  assume_role_policy = ""${file(""${path.module}/master-role.json"")}""
}

resource ""aws_iam_role_policy"" ""master_policy"" {
  name   = ""master_policy""
  role   = ""${aws_iam_role.master_role.id}""
  policy = ""${file(""${path.module}/master-policy.json"")}""
}

resource ""aws_iam_instance_profile"" ""master_profile"" {
  name  = ""master_profile""
  roles = [""${aws_iam_role.master_role.name}""]
}

# worker
resource ""aws_iam_role"" ""worker_role"" {
  name               = ""worker_role""
  path               = ""/""
  assume_role_policy = ""${file(""${path.module}/worker-role.json"")}""
}

resource ""aws_iam_role_policy"" ""worker_policy"" {
  name   = ""worker_policy""
  role   = ""${aws_iam_role.worker_role.id}""
  policy = ""${file(""${path.module}/worker-policy.json"")}""
}

resource ""aws_iam_instance_profile"" ""worker_profile"" {
  name  = ""worker_profile""
  roles = [""${aws_iam_role.worker_role.name}""]
}

# edge-router
resource ""aws_iam_role"" ""edge-router_role"" {
  name               = ""edge-router_role""
  path               = ""/""
  assume_role_policy = ""${file(""${path.module}/edge-router-role.json"")}""
}

resource ""aws_iam_role_policy"" ""edge-router_policy"" {
  name   = ""edge-router_policy""
  role   = ""${aws_iam_role.edge-router_role.id}""
  policy = ""${file(""${path.module}/edge-router-policy.json"")}""
}

resource ""aws_iam_instance_profile"" ""edge-router_profile"" {
  name  = ""edge-router_profile""
  roles = [""${aws_iam_role.edge-router_role.name}""]
}

# outputs
output ""master_profile_name"" {
  value = ""${aws_iam_instance_profile.master_profile.name}""
}
output ""worker_profile_name"" {
  value = ""${aws_iam_instance_profile.worker_profile.name}""
}
output ""edge-router_profile_name"" {
  value = ""${aws_iam_instance_profile.edge-router_profile.name}""
}
"
Capgemini__kubeform,a49b0dd29b302036be7d7958c31288db591516c3,clones/Capgemini__kubeform/terraform/aws/iam,c8df37ccb5815fc51d04238d8a5f2b5f8009910e,error,Unsupported argument,"An argument named ""roles"" is not expected here. Did you mean ""role""?",clones/Capgemini__kubeform/terraform/aws/iam/main.tf,16,3,16,8,resource,aws_iam_instance_profile master_profile,"resource ""aws_iam_instance_profile"" ""master_profile"" {
  name  = ""master_profile""
  roles = [""${aws_iam_role.master_role.name}""]
}",14,17,resource aws_iam_instance_profile master_profile,0,1,4.2,21,4,4,1,2,2,aws,6.26.0,"{""attributes"": {""arn"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""create_date"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name_prefix"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""path"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""role"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""tags"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""tags_all"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""unique_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}}, ""block_types"": {}, ""matched_block_name"": ""aws_iam_instance_profile"", ""matched_block_type"": ""resource""}",aws_iam_instance_profile,resource,"# master
resource ""aws_iam_role"" ""master_role"" {
  name               = ""master_role""
  path               = ""/""
  assume_role_policy = ""${file(""${path.module}/master-role.json"")}""
}

resource ""aws_iam_role_policy"" ""master_policy"" {
  name   = ""master_policy""
  role   = ""${aws_iam_role.master_role.id}""
  policy = ""${file(""${path.module}/master-policy.json"")}""
}

resource ""aws_iam_instance_profile"" ""master_profile"" {
  name  = ""master_profile""
  roles = [""${aws_iam_role.master_role.name}""]
}

# worker
resource ""aws_iam_role"" ""worker_role"" {
  name               = ""worker_role""
  path               = ""/""
  assume_role_policy = ""${file(""${path.module}/worker-role.json"")}""
}

resource ""aws_iam_role_policy"" ""worker_policy"" {
  name   = ""worker_policy""
  role   = ""${aws_iam_role.worker_role.id}""
  policy = ""${file(""${path.module}/worker-policy.json"")}""
}

resource ""aws_iam_instance_profile"" ""worker_profile"" {
  name  = ""worker_profile""
  roles = [""${aws_iam_role.worker_role.name}""]
}

# edge-router
resource ""aws_iam_role"" ""edge-router_role"" {
  name               = ""edge-router_role""
  path               = ""/""
  assume_role_policy = ""${file(""${path.module}/edge-router-role.json"")}""
}

resource ""aws_iam_role_policy"" ""edge-router_policy"" {
  name   = ""edge-router_policy""
  role   = ""${aws_iam_role.edge-router_role.id}""
  policy = ""${file(""${path.module}/edge-router-policy.json"")}""
}

resource ""aws_iam_instance_profile"" ""edge-router_profile"" {
  name  = ""edge-router_profile""
  roles = [""${aws_iam_role.edge-router_role.name}""]
}

# outputs
output ""master_profile_name"" {
  value = ""${aws_iam_instance_profile.master_profile.name}""
}
output ""worker_profile_name"" {
  value = ""${aws_iam_instance_profile.worker_profile.name}""
}
output ""edge-router_profile_name"" {
  value = ""${aws_iam_instance_profile.edge-router_profile.name}""
}
"
Capgemini__kubeform,a49b0dd29b302036be7d7958c31288db591516c3,clones/Capgemini__kubeform/terraform/certs/etcd,51d77358057055967efb0e77ab4b1b967b09077e,error,Invalid Configuration for Read-Only Attribute,"Cannot set value for this attribute as the provider has marked it as read-only. Remove the configuration line setting the value.

Refer to the provider documentation or contact the provider developers for additional information about configurable and read-only attributes that are supported.",clones/Capgemini__kubeform/terraform/certs/etcd/main.tf,9,21,9,26,resource,tls_cert_request etcd,"resource ""tls_cert_request"" ""etcd"" {
  key_algorithm   = ""RSA""
  private_key_pem = ""${tls_private_key.etcd.private_key_pem}""

  subject {
    common_name  = ""*""
    organization = ""etcd""
  }
}",8,16,resource tls_cert_request etcd,1,1,4.6,28,9,8,1,2,4,tls,4.1.0,"{""attributes"": {""cert_request_pem"": {""type"": ""string"", ""description"": ""The certificate request data in [PEM (RFC 1421)](https://datatracker.ietf.org/doc/html/rfc1421) format. **NOTE**: the [underlying](https://pkg.go.dev/encoding/pem#Encode) [libraries](https://pkg.go.dev/golang.org/x/crypto/ssh#MarshalAuthorizedKey) that generate this value append a `\\n` at the end of the PEM. In case this disrupts your use case, we recommend using [`trimspace()`](https://www.terraform.io/language/functions/trimspace)."", ""description_kind"": ""plain"", ""computed"": true}, ""dns_names"": {""type"": [""list"", ""string""], ""description"": ""List of DNS names for which a certificate is being requested (i.e. certificate subjects)."", ""description_kind"": ""plain"", ""optional"": true}, ""id"": {""type"": ""string"", ""description"": ""Unique identifier for this resource: hexadecimal representation of the SHA1 checksum of the resource."", ""description_kind"": ""plain"", ""computed"": true}, ""ip_addresses"": {""type"": [""list"", ""string""], ""description"": ""List of IP addresses for which a certificate is being requested (i.e. certificate subjects)."", ""description_kind"": ""plain"", ""optional"": true}, ""key_algorithm"": {""type"": ""string"", ""description"": ""Name of the algorithm used when generating the private key provided in `private_key_pem`. "", ""description_kind"": ""plain"", ""computed"": true}, ""private_key_pem"": {""type"": ""string"", ""description"": ""Private key in [PEM (RFC 1421)](https://datatracker.ietf.org/doc/html/rfc1421) format, that the certificate will belong to. This can be read from a separate file using the [`file`](https://www.terraform.io/language/functions/file) interpolation function."", ""description_kind"": ""plain"", ""required"": true, ""sensitive"": true}, ""uris"": {""type"": [""list"", ""string""], ""description"": ""List of URIs for which a certificate is being requested (i.e. certificate subjects)."", ""description_kind"": ""plain"", ""optional"": true}}, ""block_types"": {""subject"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""common_name"": {""type"": ""string"", ""description"": ""Distinguished name: `CN`"", ""description_kind"": ""plain"", ""optional"": true}, ""country"": {""type"": ""string"", ""description"": ""Distinguished name: `C`"", ""description_kind"": ""plain"", ""optional"": true}, ""email_address"": {""type"": ""string"", ""description"": ""ASN.1 Object Identifier (OID): `1.2.840.113549.1.9.1`"", ""description_kind"": ""plain"", ""optional"": true}, ""locality"": {""type"": ""string"", ""description"": ""Distinguished name: `L`"", ""description_kind"": ""plain"", ""optional"": true}, ""organization"": {""type"": ""string"", ""description"": ""Distinguished name: `O`"", ""description_kind"": ""plain"", ""optional"": true}, ""organizational_unit"": {""type"": ""string"", ""description"": ""Distinguished name: `OU`"", ""description_kind"": ""plain"", ""optional"": true}, ""postal_code"": {""type"": ""string"", ""description"": ""Distinguished name: `PC`"", ""description_kind"": ""plain"", ""optional"": true}, ""province"": {""type"": ""string"", ""description"": ""Distinguished name: `ST`"", ""description_kind"": ""plain"", ""optional"": true}, ""serial_number"": {""type"": ""string"", ""description"": ""Distinguished name: `SERIALNUMBER`"", ""description_kind"": ""plain"", ""optional"": true}, ""street_address"": {""type"": [""list"", ""string""], ""description"": ""Distinguished name: `STREET`"", ""description_kind"": ""plain"", ""optional"": true}}, ""description"": ""The subject for which a certificate is being requested. The acceptable arguments are all optional and their naming is based upon [Issuer Distinguished Names (RFC5280)](https://tools.ietf.org/html/rfc5280#section-4.1.2.4) section."", ""description_kind"": ""markdown""}}}, ""matched_block_name"": ""tls_cert_request"", ""matched_block_type"": ""resource""}",tls_cert_request,resource,"variable ""ca_cert_pem"" {}
variable ""ca_private_key_pem"" {}

resource ""tls_private_key"" ""etcd"" {
  algorithm = ""RSA""
}

resource ""tls_cert_request"" ""etcd"" {
  key_algorithm   = ""RSA""
  private_key_pem = ""${tls_private_key.etcd.private_key_pem}""

  subject {
    common_name  = ""*""
    organization = ""etcd""
  }
}

resource ""tls_locally_signed_cert"" ""etcd"" {
  cert_request_pem   = ""${tls_cert_request.etcd.cert_request_pem}""
  ca_key_algorithm   = ""RSA""
  ca_private_key_pem = ""${var.ca_private_key_pem}""
  ca_cert_pem        = ""${var.ca_cert_pem}""

  # valid for 365 days
  validity_period_hours = 8760
  early_renewal_hours   = 720

  allowed_uses = [
    ""key_encipherment"",
    ""server_auth"",
    ""client_auth""
  ]
}

output ""etcd_cert_pem"" {
  value = ""${tls_locally_signed_cert.etcd.cert_pem}""
}
output ""etcd_private_key"" {
  value = ""${tls_private_key.etcd.private_key_pem}""
}
"
cloud-custodian__cloud-custodian,59b1756ff84507f91b12d63d0b8e5c7cd386a1b0,clones/cloud-custodian__cloud-custodian/tools/c7n_left/scripts/taggable_providers/latest,8ff6b0eabe72404b778ae652ea8687d24bee7466,error,"bucket is not valid, please refer to the official documents: private-bucket-123",,clones/cloud-custodian__cloud-custodian/tools/c7n_left/scripts/taggable_providers/latest/main.tf,36,12,36,32,resource,tencentcloud_cos_bucket private_sbucket,"resource ""tencentcloud_cos_bucket"" ""private_sbucket"" {
  bucket = ""private-bucket-123""
  acl    = ""private""
}",35,38,resource tencentcloud_cos_bucket private_sbucket,0,1,4.28,11,4,4,0,0,2,tencentcloud,1.82.44,"{""attributes"": {""acceleration_enable"": {""type"": ""bool"", ""description"": ""Enable bucket acceleration."", ""description_kind"": ""plain"", ""optional"": true}, ""acl"": {""type"": ""string"", ""description"": ""The canned ACL to apply. Valid values: private, public-read, and public-read-write. Defaults to private."", ""description_kind"": ""plain"", ""optional"": true}, ""acl_body"": {""type"": ""string"", ""description"": ""ACL XML body for multiple grant info. NOTE: this argument will overwrite `acl`. Check https://intl.cloud.tencent.com/document/product/436/7737 for more detail."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""bucket"": {""type"": ""string"", ""description"": ""The name of a bucket to be created. Bucket format should be [custom name]-[appid], for example `mycos-1258798060`."", ""description_kind"": ""plain"", ""required"": true}, ""cdc_id"": {""type"": ""string"", ""description"": ""CDC cluster ID."", ""description_kind"": ""plain"", ""optional"": true}, ""chdfs_ofs"": {""type"": ""bool"", ""description"": ""Indicates whether to create a bucket of metadata acceleration. For more information, please refer to `https://www.tencentcloud.com/document/product/436/43305`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""cos_bucket_url"": {""type"": ""string"", ""description"": ""The URL of this cos bucket."", ""description_kind"": ""plain"", ""computed"": true}, ""enable_intelligent_tiering"": {""type"": ""bool"", ""description"": ""Enable intelligent tiering. NOTE: When intelligent tiering configuration is enabled, it cannot be turned off or modified."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""encryption_algorithm"": {""type"": ""string"", ""description"": ""The server-side encryption algorithm to use. Valid values are `AES256`, `KMS` and `SM4`."", ""description_kind"": ""plain"", ""optional"": true}, ""force_clean"": {""type"": ""bool"", ""description"": ""Force cleanup all objects before delete bucket."", ""description_kind"": ""plain"", ""optional"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""intelligent_tiering_days"": {""type"": ""number"", ""description"": ""Specifies the limit of days for standard-tier data to low-frequency data in an intelligent tiered storage configuration, with optional days of 30, 60, 90. Default value is 30."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""intelligent_tiering_request_frequent"": {""type"": ""number"", ""description"": ""Specify the access limit for converting standard layer data into low-frequency layer data in the configuration. The default value is once, which can be used in combination with the number of days to achieve the conversion effect. For example, if the parameter is set to 1 and the number of access days is 30, it means that objects with less than one visit in 30 consecutive days will be reduced from the standard layer to the low frequency layer."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""kms_id"": {""type"": ""string"", ""description"": ""The KMS Master Key ID. This value is valid only when `encryption_algorithm` is set to KMS. Set kms id to the specified value. If not specified, the default kms id is used."", ""description_kind"": ""plain"", ""optional"": true}, ""log_enable"": {""type"": ""bool"", ""description"": ""Indicate the access log of this bucket to be saved or not. Default is `false`. If set `true`, the access log will be saved with `log_target_bucket`. To enable log, the full access of log service must be granted. [Full Access Role Policy](https://intl.cloud.tencent.com/document/product/436/16920)."", ""description_kind"": ""plain"", ""optional"": true}, ""log_prefix"": {""type"": ""string"", ""description"": ""The prefix log name which saves the access log of this bucket per 5 minutes. Eg. `MyLogPrefix/`. The log access file format is `log_target_bucket`/`log_prefix`{YYYY}/{MM}/{DD}/{time}_{random}_{index}.gz. Only valid when `log_enable` is `true`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""log_target_bucket"": {""type"": ""string"", ""description"": ""The target bucket name which saves the access log of this bucket per 5 minutes. The log access file format is `log_target_bucket`/`log_prefix`{YYYY}/{MM}/{DD}/{time}_{random}_{index}.gz. Only valid when `log_enable` is `true`. User must have full access on this bucket."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""multi_az"": {""type"": ""bool"", ""description"": ""Indicates whether to create a bucket of multi available zone."", ""description_kind"": ""plain"", ""optional"": true}, ""replica_role"": {""type"": ""string"", ""description"": ""Request initiator identifier, format: `qcs::cam::uin/<owneruin>:uin/<subuin>`. NOTE: only `versioning_enable` is true can configure this argument."", ""description_kind"": ""plain"", ""optional"": true}, ""tags"": {""type"": [""map"", ""string""], ""description"": ""The tags of a bucket."", ""description_kind"": ""plain"", ""optional"": true}, ""versioning_enable"": {""type"": ""bool"", ""description"": ""Enable bucket versioning. NOTE: The `multi_az` feature is true for the current bucket, cannot disable version control."", ""description_kind"": ""plain"", ""optional"": true}}, ""block_types"": {""cors_rules"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""allowed_headers"": {""type"": [""list"", ""string""], ""description"": ""Specifies which headers are allowed."", ""description_kind"": ""plain"", ""required"": true}, ""allowed_methods"": {""type"": [""list"", ""string""], ""description"": ""Specifies which methods are allowed. Can be `GET`, `PUT`, `POST`, `DELETE` or `HEAD`."", ""description_kind"": ""plain"", ""required"": true}, ""allowed_origins"": {""type"": [""list"", ""string""], ""description"": ""Specifies which origins are allowed."", ""description_kind"": ""plain"", ""required"": true}, ""expose_headers"": {""type"": [""list"", ""string""], ""description"": ""Specifies expose header in the response."", ""description_kind"": ""plain"", ""optional"": true}, ""max_age_seconds"": {""type"": ""number"", ""description"": ""Specifies time in seconds that browser can cache the response for a preflight request."", ""description_kind"": ""plain"", ""optional"": true}}, ""description"": ""A rule of Cross-Origin Resource Sharing (documented below)."", ""description_kind"": ""plain""}}, ""lifecycle_rules"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""filter_prefix"": {""type"": ""string"", ""description"": ""Object key prefix identifying one or more objects to which the rule applies."", ""description_kind"": ""plain"", ""optional"": true}, ""id"": {""type"": ""string"", ""description"": ""A unique identifier for the rule. It can be up to 255 characters."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""abort_incomplete_multipart_upload"": {""nesting_mode"": ""set"", ""block"": {""attributes"": {""days_after_initiation"": {""type"": ""number"", ""description"": ""Specifies the number of days after the multipart upload starts that the upload must be completed. The maximum value is 3650."", ""description_kind"": ""plain"", ""required"": true}}, ""description"": ""Set the maximum time a multipart upload is allowed to remain running."", ""description_kind"": ""plain""}, ""max_items"": 1}, ""expiration"": {""nesting_mode"": ""set"", ""block"": {""attributes"": {""date"": {""type"": ""string"", ""description"": ""Specifies the date after which you want the corresponding action to take effect."", ""description_kind"": ""plain"", ""optional"": true}, ""days"": {""type"": ""number"", ""description"": ""Specifies the number of days after object creation when the specific rule action takes effect."", ""description_kind"": ""plain"", ""optional"": true}, ""delete_marker"": {""type"": ""bool"", ""description"": ""Indicates whether the delete marker of an expired object will be removed."", ""description_kind"": ""plain"", ""optional"": true}}, ""description"": ""Specifies a period in the object's expire (documented below)."", ""description_kind"": ""plain""}, ""max_items"": 1}, ""non_current_expiration"": {""nesting_mode"": ""set"", ""block"": {""attributes"": {""non_current_days"": {""type"": ""number"", ""description"": ""Number of days after non current object creation when the specific rule action takes effect. The maximum value is 3650."", ""description_kind"": ""plain"", ""optional"": true}}, ""description"": ""Specifies when non current object versions shall expire."", ""description_kind"": ""plain""}, ""max_items"": 1}, ""non_current_transition"": {""nesting_mode"": ""set"", ""block"": {""attributes"": {""non_current_days"": {""type"": ""number"", ""description"": ""Number of days after non current object creation when the specific rule action takes effect."", ""description_kind"": ""plain"", ""optional"": true}, ""storage_class"": {""type"": ""string"", ""description"": ""Specifies the storage class to which you want the non current object to transition. Available values include `STANDARD_IA`, `MAZ_STANDARD_IA`, `INTELLIGENT_TIERING`, `MAZ_INTELLIGENT_TIERING`, `ARCHIVE`, `DEEP_ARCHIVE`. For more information, please refer to: https://cloud.tencent.com/document/product/436/33417."", ""description_kind"": ""plain"", ""required"": true}}, ""description"": ""Specifies a period in the non current object's transitions."", ""description_kind"": ""plain""}}, ""transition"": {""nesting_mode"": ""set"", ""block"": {""attributes"": {""date"": {""type"": ""string"", ""description"": ""Specifies the date after which you want the corresponding action to take effect."", ""description_kind"": ""plain"", ""optional"": true}, ""days"": {""type"": ""number"", ""description"": ""Specifies the number of days after object creation when the specific rule action takes effect."", ""description_kind"": ""plain"", ""optional"": true}, ""storage_class"": {""type"": ""string"", ""description"": ""Specifies the storage class to which you want the object to transition. Available values include `STANDARD_IA`, `MAZ_STANDARD_IA`, `INTELLIGENT_TIERING`, `MAZ_INTELLIGENT_TIERING`, `ARCHIVE`, `DEEP_ARCHIVE`. For more information, please refer to: https://cloud.tencent.com/document/product/436/33417."", ""description_kind"": ""plain"", ""required"": true}}, ""description"": ""Specifies a period in the object's transitions (documented below)."", ""description_kind"": ""plain""}}}, ""description"": ""A configuration of object lifecycle management (documented below)."", ""description_kind"": ""plain""}}, ""origin_domain_rules"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""domain"": {""type"": ""string"", ""description"": ""Specify domain host."", ""description_kind"": ""plain"", ""required"": true}, ""status"": {""type"": ""string"", ""description"": ""Domain status, default: `ENABLED`."", ""description_kind"": ""plain"", ""optional"": true}, ""type"": {""type"": ""string"", ""description"": ""Specify origin domain type, available values: `REST`, `WEBSITE`, `ACCELERATE`, default: `REST`."", ""description_kind"": ""plain"", ""optional"": true}}, ""description"": ""Bucket Origin Domain settings."", ""description_kind"": ""plain""}}, ""origin_pull_rules"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""back_to_source_mode"": {""type"": ""string"", ""description"": ""Back to source mode. Allow value: Proxy, Mirror, Redirect."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""custom_http_headers"": {""type"": [""map"", ""string""], ""description"": ""Specifies the custom headers that you can add for COS to access your origin server."", ""description_kind"": ""plain"", ""optional"": true}, ""follow_http_headers"": {""type"": [""set"", ""string""], ""description"": ""Specifies the pass through headers when accessing the origin server."", ""description_kind"": ""plain"", ""optional"": true}, ""follow_query_string"": {""type"": ""bool"", ""description"": ""Specifies whether to pass through COS request query string when accessing the origin server."", ""description_kind"": ""plain"", ""optional"": true}, ""follow_redirection"": {""type"": ""bool"", ""description"": ""Specifies whether to follow 3XX redirect to another origin server to pull data from."", ""description_kind"": ""plain"", ""optional"": true}, ""host"": {""type"": ""string"", ""description"": ""Allows only a domain name or IP address. You can optionally append a port number to the address."", ""description_kind"": ""plain"", ""required"": true}, ""http_redirect_code"": {""type"": ""string"", ""description"": ""Redirect code. Effective when `back_to_source_mode` is `Redirect`. ex: 301, 302, 307. Default is 302."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""prefix"": {""type"": ""string"", ""description"": ""Triggers the origin-pull rule when the requested file name matches this prefix."", ""description_kind"": ""plain"", ""optional"": true}, ""priority"": {""type"": ""number"", ""description"": ""Priority of origin-pull rules, do not set the same value for multiple rules."", ""description_kind"": ""plain"", ""required"": true}, ""protocol"": {""type"": ""string"", ""description"": ""the protocol used for COS to access the specified origin server. The available value include `HTTP`, `HTTPS` and `FOLLOW`."", ""description_kind"": ""plain"", ""optional"": true}, ""sync_back_to_source"": {""type"": ""bool"", ""description"": ""If `true`, COS will not return 3XX status code when pulling data from an origin server. Current available zone: ap-beijing, ap-shanghai, ap-singapore, ap-mumbai."", ""description_kind"": ""plain"", ""deprecated"": true, ""optional"": true, ""computed"": true}}, ""description"": ""Bucket Origin-Pull settings."", ""description_kind"": ""plain""}}, ""replica_rules"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""destination_bucket"": {""type"": ""string"", ""description"": ""Destination bucket identifier, format: `qcs::cos:<region>::<bucketname-appid>`. NOTE: destination bucket must enable versioning."", ""description_kind"": ""plain"", ""required"": true}, ""destination_storage_class"": {""type"": ""string"", ""description"": ""Storage class of destination, available values: `STANDARD`, `INTELLIGENT_TIERING`, `STANDARD_IA`. default is following current class of destination."", ""description_kind"": ""plain"", ""optional"": true}, ""id"": {""type"": ""string"", ""description"": ""Name of a specific rule."", ""description_kind"": ""plain"", ""optional"": true}, ""prefix"": {""type"": ""string"", ""description"": ""Prefix matching policy. Policies cannot overlap; otherwise, an error will be returned. To match the root directory, leave this parameter empty."", ""description_kind"": ""plain"", ""optional"": true}, ""status"": {""type"": ""string"", ""description"": ""Status identifier, available values: `Enabled`, `Disabled`."", ""description_kind"": ""plain"", ""required"": true}}, ""description"": ""List of replica rule. NOTE: only `versioning_enable` is true and `replica_role` set can configure this argument."", ""description_kind"": ""plain""}}, ""website"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""endpoint"": {""type"": ""string"", ""description"": ""`Endpoint` of the static website."", ""description_kind"": ""plain"", ""computed"": true}, ""error_document"": {""type"": ""string"", ""description"": ""An absolute path to the document to return in case of a 4XX error."", ""description_kind"": ""plain"", ""optional"": true}, ""index_document"": {""type"": ""string"", ""description"": ""COS returns this index document when requests are made to the root domain or any of the subfolders."", ""description_kind"": ""plain"", ""optional"": true}, ""redirect_all_requests_to"": {""type"": ""string"", ""description"": ""Redirects all request configurations. Valid values: http, https. Default is `http`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""routing_rules"": {""nesting_mode"": ""list"", ""block"": {""block_types"": {""rules"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""condition_error_code"": {""type"": ""string"", ""description"": ""Specifies the error code as the match condition for the routing rule. Valid values: only 4xx return codes, such as 403 or 404."", ""description_kind"": ""plain"", ""optional"": true}, ""condition_prefix"": {""type"": ""string"", ""description"": ""Specifies the object key prefix as the match condition for the routing rule."", ""description_kind"": ""plain"", ""optional"": true}, ""redirect_protocol"": {""type"": ""string"", ""description"": ""Specifies the target protocol for the routing rule. Only HTTPS is supported."", ""description_kind"": ""plain"", ""optional"": true}, ""redirect_replace_key"": {""type"": ""string"", ""description"": ""Specifies the target object key to replace the original object key in the request."", ""description_kind"": ""plain"", ""optional"": true}, ""redirect_replace_key_prefix"": {""type"": ""string"", ""description"": ""Specifies the object key prefix to replace the original prefix in the request. You can set this parameter only if the condition is KeyPrefixEquals."", ""description_kind"": ""plain"", ""optional"": true}}, ""description"": ""Routing rule list."", ""description_kind"": ""plain""}, ""min_items"": 1}}, ""description"": ""Routing rule configuration. A RoutingRules container can contain up to 100 RoutingRule elements."", ""description_kind"": ""plain""}, ""max_items"": 1}}, ""description"": ""A website object(documented below)."", ""description_kind"": ""plain""}, ""max_items"": 1}}, ""matched_block_name"": ""tencentcloud_cos_bucket"", ""matched_block_type"": ""resource""}",tencentcloud_cos_bucket,resource,"terraform {
  required_providers {
    tencentcloud = {
      source = ""tencentcloudstack/tencentcloud""
    }
    oci = {
      source = ""oracle/oci""
    }
  }
}

resource ""azurerm_resource_group"" ""example"" {
  name     = ""example-resources""
  location = ""West Europe""
}


resource ""aws_cloudwatch_log_group"" ""yada"" {
  name = ""Yada""
}


resource ""google_storage_bucket"" ""static-site"" {
  name     = ""image-store.com""
  location = ""EU""
}


resource ""oci_logging_log_group"" ""test_log_group"" {
  compartment_id = ""abc""
  display_name   = ""name""
}


resource ""tencentcloud_cos_bucket"" ""private_sbucket"" {
  bucket = ""private-bucket-123""
  acl    = ""private""
}
"
cloud-custodian__cloud-custodian,59b1756ff84507f91b12d63d0b8e5c7cd386a1b0,clones/cloud-custodian__cloud-custodian/tools/c7n_terraform/tests_terraform/data/aws-s3-bucket,5826212100095b6e698d49ca62107231638e793b,error,Invalid function argument,"Invalid value for ""path"" parameter: no file exists at ""policy.json""; this function works only with files that are distributed as part of the configuration source code, so if this file will be created by a resource in this configuration you must instead obtain this result from an attribute of that resource.",clones/cloud-custodian__cloud-custodian/tools/c7n_terraform/tests_terraform/data/aws-s3-bucket/s3.tf,4,18,4,29,resource,aws_s3_bucket b,"resource ""aws_s3_bucket"" ""b"" {
  bucket = var.mybucket
  acl    = ""public-read""
  policy = file(""policy.json"")

  tags = local.common_tags

  website {
    index_document = ""index.html""
    error_document = ""error.html""

    routing_rules = <<EOF
    [{
        ""Condition"": {
	        ""KeyPrefixEquals"": ""docs/""
		    },
		        ""Redirect"": {
			        ""ReplaceKeyPrefixWith"": ""documents/""
				    }
				    }]
				    
    EOF
  }
}",1,24,resource aws_s3_bucket b,4,1,5.0,36,24,20,0,2,7,aws,6.26.0,"{""attributes"": {""acceleration_status"": {""type"": ""string"", ""description_kind"": ""plain"", ""deprecated"": true, ""optional"": true, ""computed"": true}, ""acl"": {""type"": ""string"", ""description_kind"": ""plain"", ""deprecated"": true, ""optional"": true, ""computed"": true}, ""arn"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""bucket"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""bucket_domain_name"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""bucket_prefix"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""bucket_region"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""bucket_regional_domain_name"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""force_destroy"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""hosted_zone_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""object_lock_enabled"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""policy"": {""type"": ""string"", ""description_kind"": ""plain"", ""deprecated"": true, ""optional"": true, ""computed"": true}, ""region"": {""type"": ""string"", ""description"": ""Region where this resource will be [managed](https://docs.aws.amazon.com/general/latest/gr/rande.html#regional-endpoints). Defaults to the Region set in the [provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#aws-configuration-reference)."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""request_payer"": {""type"": ""string"", ""description_kind"": ""plain"", ""deprecated"": true, ""optional"": true, ""computed"": true}, ""tags"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""tags_all"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""website_domain"": {""type"": ""string"", ""description_kind"": ""plain"", ""deprecated"": true, ""computed"": true}, ""website_endpoint"": {""type"": ""string"", ""description_kind"": ""plain"", ""deprecated"": true, ""computed"": true}}, ""block_types"": {""cors_rule"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""allowed_headers"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""allowed_methods"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""required"": true}, ""allowed_origins"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""required"": true}, ""expose_headers"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""max_age_seconds"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain"", ""deprecated"": true}}, ""grant"": {""nesting_mode"": ""set"", ""block"": {""attributes"": {""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""permissions"": {""type"": [""set"", ""string""], ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""uri"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain"", ""deprecated"": true}}, ""lifecycle_rule"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""abort_incomplete_multipart_upload_days"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""enabled"": {""type"": ""bool"", ""description_kind"": ""plain"", ""required"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""prefix"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""tags"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}}, ""block_types"": {""expiration"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""date"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""days"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""expired_object_delete_marker"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}, ""max_items"": 1}, ""noncurrent_version_expiration"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""days"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}, ""max_items"": 1}, ""noncurrent_version_transition"": {""nesting_mode"": ""set"", ""block"": {""attributes"": {""days"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""storage_class"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}}, ""description_kind"": ""plain""}}, ""transition"": {""nesting_mode"": ""set"", ""block"": {""attributes"": {""date"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""days"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""storage_class"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}}, ""description_kind"": ""plain""}}}, ""description_kind"": ""plain"", ""deprecated"": true}}, ""logging"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""target_bucket"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""target_prefix"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain"", ""deprecated"": true}, ""max_items"": 1}, ""object_lock_configuration"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""object_lock_enabled"": {""type"": ""string"", ""description_kind"": ""plain"", ""deprecated"": true, ""optional"": true}}, ""block_types"": {""rule"": {""nesting_mode"": ""list"", ""block"": {""block_types"": {""default_retention"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""days"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""mode"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""years"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}, ""min_items"": 1, ""max_items"": 1}}, ""description_kind"": ""plain"", ""deprecated"": true}, ""max_items"": 1}}, ""description_kind"": ""plain"", ""deprecated"": true}, ""max_items"": 1}, ""replication_configuration"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""role"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}}, ""block_types"": {""rules"": {""nesting_mode"": ""set"", ""block"": {""attributes"": {""delete_marker_replication_status"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""prefix"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""priority"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""status"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}}, ""block_types"": {""destination"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""account_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""bucket"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""replica_kms_key_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""storage_class"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""block_types"": {""access_control_translation"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""owner"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}}, ""description_kind"": ""plain""}, ""max_items"": 1}, ""metrics"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""minutes"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""status"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}, ""max_items"": 1}, ""replication_time"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""minutes"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""status"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}, ""max_items"": 1}}, ""description_kind"": ""plain""}, ""min_items"": 1, ""max_items"": 1}, ""filter"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""prefix"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""tags"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}, ""max_items"": 1}, ""source_selection_criteria"": {""nesting_mode"": ""list"", ""block"": {""block_types"": {""sse_kms_encrypted_objects"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""enabled"": {""type"": ""bool"", ""description_kind"": ""plain"", ""required"": true}}, ""description_kind"": ""plain""}, ""max_items"": 1}}, ""description_kind"": ""plain""}, ""max_items"": 1}}, ""description_kind"": ""plain""}, ""min_items"": 1}}, ""description_kind"": ""plain"", ""deprecated"": true}, ""max_items"": 1}, ""server_side_encryption_configuration"": {""nesting_mode"": ""list"", ""block"": {""block_types"": {""rule"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""bucket_key_enabled"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}}, ""block_types"": {""apply_server_side_encryption_by_default"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""kms_master_key_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""sse_algorithm"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}}, ""description_kind"": ""plain""}, ""min_items"": 1, ""max_items"": 1}}, ""description_kind"": ""plain""}, ""min_items"": 1, ""max_items"": 1}}, ""description_kind"": ""plain"", ""deprecated"": true}, ""max_items"": 1}, ""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""create"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""read"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}, ""versioning"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""enabled"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""mfa_delete"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain"", ""deprecated"": true}, ""max_items"": 1}, ""website"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""error_document"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""index_document"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""redirect_all_requests_to"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""routing_rules"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain"", ""deprecated"": true}, ""max_items"": 1}}, ""matched_block_name"": ""aws_s3_bucket"", ""matched_block_type"": ""resource""}",aws_s3_bucket,resource,"resource ""aws_s3_bucket"" ""b"" {
  bucket = var.mybucket
  acl    = ""public-read""
  policy = file(""policy.json"")

  tags = local.common_tags

  website {
    index_document = ""index.html""
    error_document = ""error.html""

    routing_rules = <<EOF
    [{
        ""Condition"": {
	        ""KeyPrefixEquals"": ""docs/""
		    },
		        ""Redirect"": {
			        ""ReplaceKeyPrefixWith"": ""documents/""
				    }
				    }]
				    
    EOF
  }
}
"
convox__convox,395c06a0589aaa305433707996ee5744c7e9d345,clones/convox__convox/terraform/router/metal,7110ffb0e82c5997c5a6e2409d3e9edb1e00aee2,error,Invalid Configuration for Read-Only Attribute,"Cannot set value for this attribute as the provider has marked it as read-only. Remove the configuration line setting the value.

Refer to the provider documentation or contact the provider developers for additional information about configurable and read-only attributes that are supported.",clones/convox__convox/terraform/router/metal/ca.tf,6,21,6,57,resource,tls_self_signed_cert ca,"resource ""tls_self_signed_cert"" ""ca"" {
  key_algorithm   = tls_private_key.ca-private.algorithm
  private_key_pem = tls_private_key.ca-private.private_key_pem

  dns_names             = [""ca.${var.name}""]
  is_ca_certificate     = true
  set_subject_key_id    = true
  validity_period_hours = 24 * 365 * 10

  allowed_uses = [
    ""cert_signing"",
    ""digital_signature"",
    ""key_encipherment"",
    ""server_auth""
  ]

  subject {
    common_name  = ""ca.${var.name}""
    organization = ""Convox""
  }
}",5,25,resource tls_self_signed_cert ca,3,1,4.76,71,21,18,2,6,9,tls,4.1.0,"{""attributes"": {""allowed_uses"": {""type"": [""list"", ""string""], ""description"": ""List of key usages allowed for the issued certificate. Values are defined in [RFC 5280](https://datatracker.ietf.org/doc/html/rfc5280) and combine flags defined by both [Key Usages](https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.3) and [Extended Key Usages](https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.12). Accepted values: `any_extended`, `cert_signing`, `client_auth`, `code_signing`, `content_commitment`, `crl_signing`, `data_encipherment`, `decipher_only`, `digital_signature`, `email_protection`, `encipher_only`, `ipsec_end_system`, `ipsec_tunnel`, `ipsec_user`, `key_agreement`, `key_encipherment`, `microsoft_commercial_code_signing`, `microsoft_kernel_code_signing`, `microsoft_server_gated_crypto`, `netscape_server_gated_crypto`, `ocsp_signing`, `server_auth`, `timestamping`."", ""description_kind"": ""plain"", ""required"": true}, ""cert_pem"": {""type"": ""string"", ""description"": ""Certificate data in [PEM (RFC 1421)](https://datatracker.ietf.org/doc/html/rfc1421) format. **NOTE**: the [underlying](https://pkg.go.dev/encoding/pem#Encode) [libraries](https://pkg.go.dev/golang.org/x/crypto/ssh#MarshalAuthorizedKey) that generate this value append a `\\n` at the end of the PEM. In case this disrupts your use case, we recommend using [`trimspace()`](https://www.terraform.io/language/functions/trimspace)."", ""description_kind"": ""plain"", ""computed"": true}, ""dns_names"": {""type"": [""list"", ""string""], ""description"": ""List of DNS names for which a certificate is being requested (i.e. certificate subjects)."", ""description_kind"": ""plain"", ""optional"": true}, ""early_renewal_hours"": {""type"": ""number"", ""description"": ""The resource will consider the certificate to have expired the given number of hours before its actual expiry time. This can be useful to deploy an updated certificate in advance of the expiration of the current certificate. However, the old certificate remains valid until its true expiration time, since this resource does not (and cannot) support certificate revocation. Also, this advance update can only be performed should the Terraform configuration be applied during the early renewal period. (default: `0`)"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""id"": {""type"": ""string"", ""description"": ""Unique identifier for this resource: the certificate serial number."", ""description_kind"": ""plain"", ""computed"": true}, ""ip_addresses"": {""type"": [""list"", ""string""], ""description"": ""List of IP addresses for which a certificate is being requested (i.e. certificate subjects)."", ""description_kind"": ""plain"", ""optional"": true}, ""is_ca_certificate"": {""type"": ""bool"", ""description"": ""Is the generated certificate representing a Certificate Authority (CA) (default: `false`)."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""key_algorithm"": {""type"": ""string"", ""description"": ""Name of the algorithm used when generating the private key provided in `private_key_pem`. "", ""description_kind"": ""plain"", ""computed"": true}, ""private_key_pem"": {""type"": ""string"", ""description"": ""Private key in [PEM (RFC 1421)](https://datatracker.ietf.org/doc/html/rfc1421) format, that the certificate will belong to. This can be read from a separate file using the [`file`](https://www.terraform.io/language/functions/file) interpolation function. "", ""description_kind"": ""plain"", ""required"": true, ""sensitive"": true}, ""ready_for_renewal"": {""type"": ""bool"", ""description"": ""Is the certificate either expired (i.e. beyond the `validity_period_hours`) or ready for an early renewal (i.e. within the `early_renewal_hours`)?"", ""description_kind"": ""plain"", ""computed"": true}, ""set_authority_key_id"": {""type"": ""bool"", ""description"": ""Should the generated certificate include an [authority key identifier](https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.1): for self-signed certificates this is the same value as the [subject key identifier](https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.2) (default: `false`)."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""set_subject_key_id"": {""type"": ""bool"", ""description"": ""Should the generated certificate include a [subject key identifier](https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.2) (default: `false`)."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""uris"": {""type"": [""list"", ""string""], ""description"": ""List of URIs for which a certificate is being requested (i.e. certificate subjects)."", ""description_kind"": ""plain"", ""optional"": true}, ""validity_end_time"": {""type"": ""string"", ""description"": ""The time until which the certificate is invalid, expressed as an [RFC3339](https://tools.ietf.org/html/rfc3339) timestamp."", ""description_kind"": ""plain"", ""computed"": true}, ""validity_period_hours"": {""type"": ""number"", ""description"": ""Number of hours, after initial issuing, that the certificate will remain valid for."", ""description_kind"": ""plain"", ""required"": true}, ""validity_start_time"": {""type"": ""string"", ""description"": ""The time after which the certificate is valid, expressed as an [RFC3339](https://tools.ietf.org/html/rfc3339) timestamp."", ""description_kind"": ""plain"", ""computed"": true}}, ""block_types"": {""subject"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""common_name"": {""type"": ""string"", ""description"": ""Distinguished name: `CN`"", ""description_kind"": ""plain"", ""optional"": true}, ""country"": {""type"": ""string"", ""description"": ""Distinguished name: `C`"", ""description_kind"": ""plain"", ""optional"": true}, ""email_address"": {""type"": ""string"", ""description"": ""ASN.1 Object Identifier (OID): `1.2.840.113549.1.9.1`"", ""description_kind"": ""plain"", ""optional"": true}, ""locality"": {""type"": ""string"", ""description"": ""Distinguished name: `L`"", ""description_kind"": ""plain"", ""optional"": true}, ""organization"": {""type"": ""string"", ""description"": ""Distinguished name: `O`"", ""description_kind"": ""plain"", ""optional"": true}, ""organizational_unit"": {""type"": ""string"", ""description"": ""Distinguished name: `OU`"", ""description_kind"": ""plain"", ""optional"": true}, ""postal_code"": {""type"": ""string"", ""description"": ""Distinguished name: `PC`"", ""description_kind"": ""plain"", ""optional"": true}, ""province"": {""type"": ""string"", ""description"": ""Distinguished name: `ST`"", ""description_kind"": ""plain"", ""optional"": true}, ""serial_number"": {""type"": ""string"", ""description"": ""Distinguished name: `SERIALNUMBER`"", ""description_kind"": ""plain"", ""optional"": true}, ""street_address"": {""type"": [""list"", ""string""], ""description"": ""Distinguished name: `STREET`"", ""description_kind"": ""plain"", ""optional"": true}}, ""description"": ""The subject for which a certificate is being requested. The acceptable arguments are all optional and their naming is based upon [Issuer Distinguished Names (RFC5280)](https://tools.ietf.org/html/rfc5280#section-4.1.2.4) section."", ""description_kind"": ""markdown""}}}, ""matched_block_name"": ""tls_self_signed_cert"", ""matched_block_type"": ""resource""}",tls_self_signed_cert,resource,"resource ""tls_private_key"" ""ca-private"" {
  algorithm = ""RSA""
}

resource ""tls_self_signed_cert"" ""ca"" {
  key_algorithm   = tls_private_key.ca-private.algorithm
  private_key_pem = tls_private_key.ca-private.private_key_pem

  dns_names             = [""ca.${var.name}""]
  is_ca_certificate     = true
  set_subject_key_id    = true
  validity_period_hours = 24 * 365 * 10

  allowed_uses = [
    ""cert_signing"",
    ""digital_signature"",
    ""key_encipherment"",
    ""server_auth""
  ]

  subject {
    common_name  = ""ca.${var.name}""
    organization = ""Convox""
  }
}

resource ""kubernetes_secret"" ""ca"" {
  metadata {
    namespace = var.namespace
    name      = ""ca""
  }

  type = ""kubernetes.io/tls""

  data = {
    ""tls.crt"" = tls_self_signed_cert.ca.cert_pem,
    ""tls.key"" = tls_private_key.ca-private.private_key_pem,
  }
}
"
convox__convox,395c06a0589aaa305433707996ee5744c7e9d345,clones/convox__convox/terraform/cluster/gcp,d690c301051310ffa86c3eda027ce3d56867406d,warning,Deprecated Resource,Deprecated; use kubernetes_cluster_role_binding_v1.,clones/convox__convox/terraform/cluster/gcp/main.tf,112,53,112,54,resource,kubernetes_cluster_role_binding client,"resource ""kubernetes_cluster_role_binding"" ""client"" {
  provider = kubernetes.direct

  metadata {
    name = ""client-binding""
  }

  role_ref {
    api_group = ""rbac.authorization.k8s.io""
    kind      = ""ClusterRole""
    name      = ""cluster-admin""
  }

  subject {
    kind = ""User""
    name = ""client""
  }
}",112,129,resource kubernetes_cluster_role_binding client,3,1,4.51,37,18,15,0,1,7,kubernetes,3.0.1,"{""attributes"": {""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""metadata"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""annotations"": {""type"": [""map"", ""string""], ""description"": ""An unstructured key value map stored with the clusterRoleBinding that may be used to store arbitrary metadata. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/"", ""description_kind"": ""plain"", ""optional"": true}, ""generate_name"": {""type"": ""string"", ""description"": ""Prefix, used by the server, to generate a unique name ONLY IF the `name` field has not been provided. This value will also be combined with a unique suffix. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#idempotency"", ""description_kind"": ""plain"", ""optional"": true}, ""generation"": {""type"": ""number"", ""description"": ""A sequence number representing a specific generation of the desired state."", ""description_kind"": ""plain"", ""computed"": true}, ""labels"": {""type"": [""map"", ""string""], ""description"": ""Map of string keys and values that can be used to organize and categorize (scope and select) the clusterRoleBinding. May match selectors of replication controllers and services. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/"", ""description_kind"": ""plain"", ""optional"": true}, ""name"": {""type"": ""string"", ""description"": ""Name of the clusterRoleBinding, must be unique. Cannot be updated. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""resource_version"": {""type"": ""string"", ""description"": ""An opaque value that represents the internal version of this clusterRoleBinding that can be used by clients to determine when clusterRoleBinding has changed. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency"", ""description_kind"": ""plain"", ""computed"": true}, ""uid"": {""type"": ""string"", ""description"": ""The unique in time and space value for this clusterRoleBinding. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids"", ""description_kind"": ""plain"", ""computed"": true}}, ""description"": ""Standard clusterRoleBinding's metadata. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata"", ""description_kind"": ""plain""}, ""min_items"": 1, ""max_items"": 1}, ""role_ref"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""api_group"": {""type"": ""string"", ""description"": ""The API group of the user. The only value possible at the moment is `rbac.authorization.k8s.io`."", ""description_kind"": ""plain"", ""required"": true}, ""kind"": {""type"": ""string"", ""description"": ""The kind of resource."", ""description_kind"": ""plain"", ""required"": true}, ""name"": {""type"": ""string"", ""description"": ""The name of the User to bind to."", ""description_kind"": ""plain"", ""required"": true}}, ""description"": ""RoleRef references the Cluster Role for this binding"", ""description_kind"": ""plain""}, ""min_items"": 1, ""max_items"": 1}, ""subject"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""api_group"": {""type"": ""string"", ""description"": ""The API group of the subject resource."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""kind"": {""type"": ""string"", ""description"": ""The kind of resource."", ""description_kind"": ""plain"", ""required"": true}, ""name"": {""type"": ""string"", ""description"": ""The name of the resource to bind to."", ""description_kind"": ""plain"", ""required"": true}, ""namespace"": {""type"": ""string"", ""description"": ""The Namespace of the subject resource."", ""description_kind"": ""plain"", ""optional"": true}}, ""description"": ""Subjects defines the entities to bind a ClusterRole to."", ""description_kind"": ""plain""}, ""min_items"": 1}}, ""matched_block_name"": ""kubernetes_cluster_role_binding"", ""matched_block_type"": ""resource""}",kubernetes_cluster_role_binding,resource,"data ""google_client_config"" ""current"" {}

data ""google_project"" ""current"" {}

resource ""random_string"" ""password"" {
  length  = 64
  special = true
}

resource ""google_container_cluster"" ""rack"" {
  name                = var.name
  location            = data.google_client_config.current.region
  network             = google_compute_network.rack.name
  deletion_protection = false

  remove_default_node_pool = true
  initial_node_count       = 1

  release_channel {
    channel = ""EXTENDED""
  }

  min_master_version = var.k8s_version

  workload_identity_config {
    workload_pool = ""${data.google_project.current.project_id}.svc.id.goog""
  }

  ip_allocation_policy {}

  master_auth {
    client_certificate_config {
      issue_client_certificate = true
    }
  }
}

resource ""google_container_node_pool"" ""rack"" {
  name     = ""${google_container_cluster.rack.name}-nodes-${var.node_type}""
  location = google_container_cluster.rack.location
  cluster  = google_container_cluster.rack.name

  version = var.k8s_version

  initial_node_count = 1

  autoscaling {
    min_node_count = 1
    max_node_count = 1000
  }

  node_config {
    machine_type = var.node_type
    preemptible  = var.preemptible
    disk_size_gb = var.node_disk

    metadata = {
      disable-legacy-endpoints = ""true""
    }

    workload_metadata_config {
      mode = ""GKE_METADATA""
    }

    service_account = google_service_account.nodes.email

    oauth_scopes = [
      ""https://www.googleapis.com/auth/cloud-platform"",
      ""https://www.googleapis.com/auth/devstorage.read_write"",
      ""https://www.googleapis.com/auth/logging.write"",
      ""https://www.googleapis.com/auth/monitoring"",
    ]
  }

  upgrade_settings {
    max_surge       = 1
    max_unavailable = 1
  }

  lifecycle {
    create_before_destroy = true
  }
}

resource ""local_file"" ""kubeconfig"" {
  depends_on = [
    kubernetes_cluster_role_binding.client,
    google_container_node_pool.rack,
  ]

  filename = pathexpand(""~/.kube/config.gcp.${var.name}"")
  content = templatefile(""${path.module}/kubeconfig.tpl"", {
    ca                 = google_container_cluster.rack.master_auth[0].cluster_ca_certificate
    endpoint           = google_container_cluster.rack.endpoint
    client_certificate = google_container_cluster.rack.master_auth[0].client_certificate
    client_key         = google_container_cluster.rack.master_auth[0].client_key
  })

  lifecycle {
    ignore_changes = [content]
  }
}

provider ""kubernetes"" {
  alias = ""direct""

  host                   = ""https://${google_container_cluster.rack.endpoint}""
  token                  = data.google_client_config.current.access_token
  cluster_ca_certificate = base64decode(google_container_cluster.rack.master_auth[0].cluster_ca_certificate)
}

resource ""kubernetes_cluster_role_binding"" ""client"" {
  provider = kubernetes.direct

  metadata {
    name = ""client-binding""
  }

  role_ref {
    api_group = ""rbac.authorization.k8s.io""
    kind      = ""ClusterRole""
    name      = ""cluster-admin""
  }

  subject {
    kind = ""User""
    name = ""client""
  }
}
"
e2b-dev__infra,c7180fe2c977676e02cfcf2c17ba134feebae739,clones/e2b-dev__infra/iac/provider-gcp/redis,ad783d73879aeffbb0cb4681084359a6431f53e3,error,Unsupported block type,"Blocks of type ""desired_auto_created_endpoints"" are not expected here.",clones/e2b-dev__infra/iac/provider-gcp/redis/main.tf,76,3,76,33,resource,google_memorystore_instance valkey_cluster,"resource ""google_memorystore_instance"" ""valkey_cluster"" {
  project     = var.gcp_project_id
  location    = var.gcp_region
  instance_id = ""${var.prefix}redis-valkey-cluster""

  engine_version = ""VALKEY_8_0""
  mode           = ""CLUSTER""

  desired_auto_created_endpoints {
    network    = ""projects/${var.gcp_project_id}/global/networks/${var.network_name}""
    project_id = var.gcp_project_id
  }

  shard_count             = var.shard_count
  replica_count           = var.replica_count
  node_type               = ""STANDARD_SMALL""
  transit_encryption_mode = ""SERVER_AUTHENTICATION""
  authorization_mode      = ""AUTH_DISABLED""

  zone_distribution_config {
    mode = ""MULTI_ZONE""
  }

  deletion_protection_enabled = true

  maintenance_policy {
    weekly_maintenance_window {
      day = ""SUNDAY""
      start_time {
        hours = 1
      }
    }
  }

  persistence_config {
    mode = ""AOF""
    aof_config {
      append_fsync = ""EVERY_SEC""
    }
  }

  depends_on = [
    google_network_connectivity_service_connection_policy.valkey,
    google_service_networking_connection.private_service_connection,
    google_project_service.memory_store,
    time_sleep.memory_store_api_wait_60_seconds
  ]
}",68,115,resource google_memorystore_instance valkey_cluster,8,1,4.97,129,48,40,2,12,19,google,6.28.0,"{""attributes"": {""authorization_mode"": {""type"": ""string"", ""description"": ""Optional. Immutable. Authorization mode of the instance. Possible values:\n AUTH_DISABLED\nIAM_AUTH"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""create_time"": {""type"": ""string"", ""description"": ""Output only. Creation timestamp of the instance."", ""description_kind"": ""plain"", ""computed"": true}, ""deletion_protection_enabled"": {""type"": ""bool"", ""description"": ""Optional. If set to true deletion of the instance will fail."", ""description_kind"": ""plain"", ""optional"": true}, ""discovery_endpoints"": {""type"": [""list"", [""object"", {""address"": ""string"", ""network"": ""string"", ""port"": ""number""}]], ""description"": ""Output only. Endpoints clients can connect to the instance through. Currently only one\ndiscovery endpoint is supported."", ""description_kind"": ""plain"", ""computed"": true}, ""effective_labels"": {""type"": [""map"", ""string""], ""description"": ""All of labels (key/value pairs) present on the resource in GCP, including the labels configured through Terraform, other clients and services."", ""description_kind"": ""plain"", ""computed"": true}, ""endpoints"": {""type"": [""list"", [""object"", {""connections"": [""list"", [""object"", {""psc_auto_connection"": [""list"", [""object"", {""connection_type"": ""string"", ""forwarding_rule"": ""string"", ""ip_address"": ""string"", ""network"": ""string"", ""port"": ""number"", ""project_id"": ""string"", ""psc_connection_id"": ""string"", ""service_attachment"": ""string""}]]}]]}]], ""description"": ""Endpoints for the instance."", ""description_kind"": ""plain"", ""computed"": true}, ""engine_configs"": {""type"": [""map"", ""string""], ""description"": ""Optional. User-provided engine configurations for the instance."", ""description_kind"": ""plain"", ""optional"": true}, ""engine_version"": {""type"": ""string"", ""description"": ""Optional. Engine version of the instance."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""instance_id"": {""type"": ""string"", ""description"": ""Required. The ID to use for the instance, which will become the final component of\nthe instance's resource name.\n\nThis value is subject to the following restrictions:\n\n* Must be 4-63 characters in length\n* Must begin with a letter or digit\n* Must contain only lowercase letters, digits, and hyphens\n* Must not end with a hyphen\n* Must be unique within a location"", ""description_kind"": ""plain"", ""required"": true}, ""labels"": {""type"": [""map"", ""string""], ""description"": ""Optional. Labels to represent user-provided metadata. \n\n**Note**: This field is non-authoritative, and will only manage the labels present in your configuration.\nPlease refer to the field 'effective_labels' for all of the labels present on the resource."", ""description_kind"": ""plain"", ""optional"": true}, ""location"": {""type"": ""string"", ""description"": ""Resource ID segment making up resource 'name'. It identifies the resource within its parent collection as described in https://google.aip.dev/122. See documentation for resource type 'memorystore.googleapis.com/CertificateAuthority'."", ""description_kind"": ""plain"", ""required"": true}, ""maintenance_schedule"": {""type"": [""list"", [""object"", {""end_time"": ""string"", ""schedule_deadline_time"": ""string"", ""start_time"": ""string""}]], ""description"": ""Upcoming maintenance schedule."", ""description_kind"": ""plain"", ""computed"": true}, ""mode"": {""type"": ""string"", ""description"": ""Optional. cluster or cluster-disabled. \n Possible values:\n CLUSTER\n CLUSTER_DISABLED Possible values: [\""CLUSTER\"", \""CLUSTER_DISABLED\""]"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name"": {""type"": ""string"", ""description"": ""Identifier. Unique name of the instance.\nFormat: projects/{project}/locations/{location}/instances/{instance}"", ""description_kind"": ""plain"", ""computed"": true}, ""node_config"": {""type"": [""list"", [""object"", {""size_gb"": ""number""}]], ""description"": ""Represents configuration for nodes of the instance."", ""description_kind"": ""plain"", ""computed"": true}, ""node_type"": {""type"": ""string"", ""description"": ""Optional. Machine type for individual nodes of the instance. \n Possible values:\n SHARED_CORE_NANO\nHIGHMEM_MEDIUM\nHIGHMEM_XLARGE\nSTANDARD_SMALL"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""project"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""psc_attachment_details"": {""type"": [""list"", [""object"", {""connection_type"": ""string"", ""service_attachment"": ""string""}]], ""description"": ""Configuration of a service attachment of the cluster, for creating PSC connections."", ""description_kind"": ""plain"", ""computed"": true}, ""psc_auto_connections"": {""type"": [""list"", [""object"", {""connection_type"": ""string"", ""forwarding_rule"": ""string"", ""ip_address"": ""string"", ""network"": ""string"", ""port"": ""number"", ""project_id"": ""string"", ""psc_connection_id"": ""string"", ""psc_connection_status"": ""string"", ""service_attachment"": ""string""}]], ""description"": ""Output only. User inputs and resource details of the auto-created PSC connections."", ""description_kind"": ""plain"", ""computed"": true}, ""replica_count"": {""type"": ""number"", ""description"": ""Optional. Number of replica nodes per shard. If omitted the default is 0 replicas."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""shard_count"": {""type"": ""number"", ""description"": ""Required. Number of shards for the instance."", ""description_kind"": ""plain"", ""required"": true}, ""state"": {""type"": ""string"", ""description"": ""Output only. Current state of the instance. \n Possible values:\n CREATING\nACTIVE\nUPDATING\nDELETING"", ""description_kind"": ""plain"", ""computed"": true}, ""state_info"": {""type"": [""list"", [""object"", {""update_info"": [""list"", [""object"", {""target_engine_version"": ""string"", ""target_node_type"": ""string"", ""target_replica_count"": ""number"", ""target_shard_count"": ""number""}]]}]], ""description"": ""Additional information about the state of the instance."", ""description_kind"": ""plain"", ""computed"": true}, ""terraform_labels"": {""type"": [""map"", ""string""], ""description"": ""The combination of labels configured directly on the resource\n and default labels configured on the provider."", ""description_kind"": ""plain"", ""computed"": true}, ""transit_encryption_mode"": {""type"": ""string"", ""description"": ""Optional. Immutable. In-transit encryption mode of the instance. \n Possible values:\n TRANSIT_ENCRYPTION_DISABLED\nSERVER_AUTHENTICATION"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""uid"": {""type"": ""string"", ""description"": ""Output only. System assigned, unique identifier for the instance."", ""description_kind"": ""plain"", ""computed"": true}, ""update_time"": {""type"": ""string"", ""description"": ""Output only. Latest update timestamp of the instance."", ""description_kind"": ""plain"", ""computed"": true}}, ""block_types"": {""cross_instance_replication_config"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""instance_role"": {""type"": ""string"", ""description"": ""The instance role supports the following values:\n1. 'INSTANCE_ROLE_UNSPECIFIED': This is an independent instance that has never participated in cross instance replication. It allows both reads and writes.\n2. 'NONE': This is an independent instance that previously participated in cross instance replication(either as a 'PRIMARY' or 'SECONDARY' cluster). It allows both reads and writes.\n3. 'PRIMARY': This instance serves as the replication source for secondary instance that are replicating from it. Any data written to it is automatically replicated to its secondary clusters. It allows both reads and writes.\n4. 'SECONDARY': This instance replicates data from the primary instance. It allows only reads. Possible values: [\""INSTANCE_ROLE_UNSPECIFIED\"", \""NONE\"", \""PRIMARY\"", \""SECONDARY\""]"", ""description_kind"": ""plain"", ""optional"": true}, ""membership"": {""type"": [""list"", [""object"", {""primary_instance"": [""list"", [""object"", {""instance"": ""string"", ""uid"": ""string""}]], ""secondary_instance"": [""list"", [""object"", {""instance"": ""string"", ""uid"": ""string""}]]}]], ""description"": ""An output only view of all the member instance participating in cross instance replication. This field is populated for all the member clusters irrespective of their cluster role."", ""description_kind"": ""plain"", ""computed"": true}, ""update_time"": {""type"": ""string"", ""description"": ""The last time cross instance replication config was updated."", ""description_kind"": ""plain"", ""computed"": true}}, ""block_types"": {""primary_instance"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""instance"": {""type"": ""string"", ""description"": ""The full resource path of the primary instance in the format: projects/{project}/locations/{region}/instances/{instance-id}"", ""description_kind"": ""plain"", ""optional"": true}, ""uid"": {""type"": ""string"", ""description"": ""The unique id of the primary instance."", ""description_kind"": ""plain"", ""computed"": true}}, ""description"": ""This field is only set for a secondary instance. Details of the primary instance that is used as the replication source for this secondary instance. This is allowed to be set only for clusters whose cluster role is of type 'SECONDARY'."", ""description_kind"": ""plain""}, ""max_items"": 1}, ""secondary_instances"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""instance"": {""type"": ""string"", ""description"": ""The full resource path of the Nth instance in the format: projects/{project}/locations/{region}/instance/{instance-id}"", ""description_kind"": ""plain"", ""optional"": true}, ""uid"": {""type"": ""string"", ""description"": ""The unique id of the Nth instance."", ""description_kind"": ""plain"", ""computed"": true}}, ""description"": ""List of secondary instances that are replicating from this primary cluster. This is allowed to be set only for instances whose cluster role is of type 'PRIMARY'."", ""description_kind"": ""plain""}}}, ""description"": ""Cross instance replication config"", ""description_kind"": ""plain""}, ""max_items"": 1}, ""desired_psc_auto_connections"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""network"": {""type"": ""string"", ""description"": ""Required. The consumer network where the IP address resides, in the form of\nprojects/{project_id}/global/networks/{network_id}."", ""description_kind"": ""plain"", ""required"": true}, ""project_id"": {""type"": ""string"", ""description"": ""Required. The consumer project_id where the forwarding rule is created from."", ""description_kind"": ""plain"", ""required"": true}}, ""description"": ""Immutable. User inputs for the auto-created PSC connections."", ""description_kind"": ""plain""}}, ""maintenance_policy"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""create_time"": {""type"": ""string"", ""description"": ""The time when the policy was created.\nA timestamp in RFC3339 UTC \""Zulu\"" format, with nanosecond\nresolution and up to nine fractional digits."", ""description_kind"": ""plain"", ""computed"": true}, ""update_time"": {""type"": ""string"", ""description"": ""The time when the policy was last updated.\nA timestamp in RFC3339 UTC \""Zulu\"" format, with nanosecond\nresolution and up to nine fractional digits."", ""description_kind"": ""plain"", ""computed"": true}}, ""block_types"": {""weekly_maintenance_window"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""day"": {""type"": ""string"", ""description"": ""The day of week that maintenance updates occur.\n\n- DAY_OF_WEEK_UNSPECIFIED: The day of the week is unspecified.\n- MONDAY: Monday\n- TUESDAY: Tuesday\n- WEDNESDAY: Wednesday\n- THURSDAY: Thursday\n- FRIDAY: Friday\n- SATURDAY: Saturday\n- SUNDAY: Sunday Possible values: [\""DAY_OF_WEEK_UNSPECIFIED\"", \""MONDAY\"", \""TUESDAY\"", \""WEDNESDAY\"", \""THURSDAY\"", \""FRIDAY\"", \""SATURDAY\"", \""SUNDAY\""]"", ""description_kind"": ""plain"", ""required"": true}, ""duration"": {""type"": ""string"", ""description"": ""Duration of the maintenance window.\nThe current window is fixed at 1 hour.\nA duration in seconds with up to nine fractional digits,\nterminated by 's'. Example: \""3.5s\""."", ""description_kind"": ""plain"", ""computed"": true}}, ""block_types"": {""start_time"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""hours"": {""type"": ""number"", ""description"": ""Hours of day in 24 hour format. Should be from 0 to 23.\nAn API may choose to allow the value \""24:00:00\"" for scenarios like business closing time."", ""description_kind"": ""plain"", ""optional"": true}, ""minutes"": {""type"": ""number"", ""description"": ""Minutes of hour of day. Must be from 0 to 59."", ""description_kind"": ""plain"", ""optional"": true}, ""nanos"": {""type"": ""number"", ""description"": ""Fractions of seconds in nanoseconds. Must be from 0 to 999,999,999."", ""description_kind"": ""plain"", ""optional"": true}, ""seconds"": {""type"": ""number"", ""description"": ""Seconds of minutes of the time. Must normally be from 0 to 59.\nAn API may allow the value 60 if it allows leap-seconds."", ""description_kind"": ""plain"", ""optional"": true}}, ""description"": ""Start time of the window in UTC time."", ""description_kind"": ""plain""}, ""min_items"": 1, ""max_items"": 1}}, ""description"": ""Optional. Maintenance window that is applied to resources covered by this policy.\nMinimum 1. For the current version, the maximum number\nof weekly_window is expected to be one."", ""description_kind"": ""plain""}}}, ""description"": ""Maintenance policy for a cluster"", ""description_kind"": ""plain""}, ""max_items"": 1}, ""persistence_config"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""mode"": {""type"": ""string"", ""description"": ""Optional. Current persistence mode. \n Possible values:\nDISABLED\nRDB\nAOF Possible values: [\""DISABLED\"", \""RDB\"", \""AOF\""]"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""aof_config"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""append_fsync"": {""type"": ""string"", ""description"": ""Optional. The fsync mode. \n Possible values:\n NEVER\nEVERY_SEC\nALWAYS"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""description"": ""Configuration for AOF based persistence."", ""description_kind"": ""plain""}, ""max_items"": 1}, ""rdb_config"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""rdb_snapshot_period"": {""type"": ""string"", ""description"": ""Optional. Period between RDB snapshots. \n Possible values:\n ONE_HOUR\nSIX_HOURS\nTWELVE_HOURS\nTWENTY_FOUR_HOURS"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""rdb_snapshot_start_time"": {""type"": ""string"", ""description"": ""Optional. Time that the first snapshot was/will be attempted, and to which future\nsnapshots will be aligned. If not provided, the current time will be\nused."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""description"": ""Configuration for RDB based persistence."", ""description_kind"": ""plain""}, ""max_items"": 1}}, ""description"": ""Represents persistence configuration for a instance."", ""description_kind"": ""plain""}, ""max_items"": 1}, ""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""create"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}, ""zone_distribution_config"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""mode"": {""type"": ""string"", ""description"": ""Optional. Current zone distribution mode. Defaults to MULTI_ZONE. \n Possible values:\n MULTI_ZONE\nSINGLE_ZONE Possible values: [\""MULTI_ZONE\"", \""SINGLE_ZONE\""]"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""zone"": {""type"": ""string"", ""description"": ""Optional. Defines zone where all resources will be allocated with SINGLE_ZONE mode.\nIgnored for MULTI_ZONE mode."", ""description_kind"": ""plain"", ""optional"": true}}, ""description"": ""Zone distribution configuration for allocation of instance resources."", ""description_kind"": ""plain""}, ""max_items"": 1}}, ""matched_block_name"": ""google_memorystore_instance"", ""matched_block_type"": ""resource""}",google_memorystore_instance,resource,"# Enable the Service Networking API
resource ""google_project_service"" ""service_networking"" {
  service            = ""servicenetworking.googleapis.com""
  disable_on_destroy = false
}

resource ""time_sleep"" ""secrets_service_networking_api_wait_60_seconds"" {
  depends_on = [google_project_service.service_networking]

  create_duration = ""60s""
}


# Enable the Redis API
resource ""google_project_service"" ""memory_store"" {
  service            = ""memorystore.googleapis.com""
  disable_on_destroy = false
}

resource ""time_sleep"" ""memory_store_api_wait_60_seconds"" {
  depends_on = [google_project_service.memory_store]

  create_duration = ""60s""
}


# Get the default network resource
resource ""google_compute_subnetwork"" ""default"" {
  name                     = var.network_name
  region                   = var.gcp_region
  network                  = ""projects/${var.gcp_project_id}/global/networks/${var.network_name}""
  private_ip_google_access = true
}


# Allocate an IP address range for private services in the default network
resource ""google_compute_global_address"" ""private_ip_alloc"" {
  name          = ""google-services-private-ip-alloc""
  purpose       = ""VPC_PEERING""
  address_type  = ""INTERNAL""
  prefix_length = 16
  network       = ""projects/${var.gcp_project_id}/global/networks/${var.network_name}""
}

# Create the private connection for the default network
resource ""google_service_networking_connection"" ""private_service_connection"" {
  network                 = ""projects/${var.gcp_project_id}/global/networks/${var.network_name}""
  service                 = ""servicenetworking.googleapis.com""
  reserved_peering_ranges = [google_compute_global_address.private_ip_alloc.name]

  depends_on = [
    google_project_service.service_networking
  ]
}

# PSC policy for Valkey on default VPC in europe-west1
resource ""google_network_connectivity_service_connection_policy"" ""valkey"" {
  name          = ""${var.prefix}memorystore-valkey-connection-policy""
  location      = var.gcp_region
  service_class = ""gcp-memorystore""
  description   = ""my basic service connection policy""
  network       = ""projects/${var.gcp_project_id}/global/networks/${var.network_name}""
  psc_config {
    subnetworks = [google_compute_subnetwork.default.id]
  }
}

resource ""google_memorystore_instance"" ""valkey_cluster"" {
  project     = var.gcp_project_id
  location    = var.gcp_region
  instance_id = ""${var.prefix}redis-valkey-cluster""

  engine_version = ""VALKEY_8_0""
  mode           = ""CLUSTER""

  desired_auto_created_endpoints {
    network    = ""projects/${var.gcp_project_id}/global/networks/${var.network_name}""
    project_id = var.gcp_project_id
  }

  shard_count             = var.shard_count
  replica_count           = var.replica_count
  node_type               = ""STANDARD_SMALL""
  transit_encryption_mode = ""SERVER_AUTHENTICATION""
  authorization_mode      = ""AUTH_DISABLED""

  zone_distribution_config {
    mode = ""MULTI_ZONE""
  }

  deletion_protection_enabled = true

  maintenance_policy {
    weekly_maintenance_window {
      day = ""SUNDAY""
      start_time {
        hours = 1
      }
    }
  }

  persistence_config {
    mode = ""AOF""
    aof_config {
      append_fsync = ""EVERY_SEC""
    }
  }

  depends_on = [
    google_network_connectivity_service_connection_policy.valkey,
    google_service_networking_connection.private_service_connection,
    google_project_service.memory_store,
    time_sleep.memory_store_api_wait_60_seconds
  ]
}

locals {
  redis_connection = google_memorystore_instance.valkey_cluster.endpoints[0].connections[0].psc_auto_connection[0]
}

resource ""google_secret_manager_secret_version"" ""redis_cluster_url"" {
  secret      = var.redis_cluster_url_secret_version.secret
  secret_data = ""${local.redis_connection.ip_address}:${local.redis_connection.port}""
}

resource ""google_secret_manager_secret_version"" ""redis_tls_ca_base64"" {
  secret      = var.redis_tls_ca_base64_secret_version.secret
  secret_data = base64encode(join(""\n"", google_memorystore_instance.valkey_cluster.managed_server_ca[0].ca_certs[0].certificates))
}
"
eclipsesource__theia-cloud,c215724f17b9885e5cee7dc4baf2b94c03747169,clones/eclipsesource__theia-cloud/terraform/modules/helm,c5d75d047b3d6a53cf74331d81258df7114bb490,error,Unsupported block type,"Blocks of type ""set"" are not expected here. Did you mean to define argument ""set""? If so, use the equals sign to assign it a value.",clones/eclipsesource__theia-cloud/terraform/modules/helm/main.tf,116,3,116,6,resource,helm_release nginx-ingress-controller,"resource ""helm_release"" ""nginx-ingress-controller"" {
  count            = var.install_ingress_controller ? 1 : 0
  name             = ""nginx-ingress-controller""
  repository       = ""https://kubernetes.github.io/ingress-nginx""
  chart            = ""ingress-nginx""
  version          = ""4.11.5""
  namespace        = ""ingress-nginx""
  create_namespace = true

  set {
    name  = ""fullnameOverride""
    value = ""ingress-nginx""
  }

  set {
    name  = ""controller.service.loadBalancerIP""
    value = var.loadBalancerIP
  }

  set {
    name  = ""controller.allowSnippetAnnotations""
    value = true
  }
}",107,130,resource helm_release nginx-ingress-controller,3,2,4.58,61,24,21,0,2,13,helm,3.1.1,"{""attributes"": {""atomic"": {""type"": ""bool"", ""description"": ""If set, installation process purges chart on fail. The wait flag will be set automatically if atomic is used"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""chart"": {""type"": ""string"", ""description"": ""Chart name to be installed. A path may be used"", ""description_kind"": ""plain"", ""required"": true}, ""cleanup_on_fail"": {""type"": ""bool"", ""description"": ""Allow deletion of new resources created in this upgrade when upgrade fails"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""create_namespace"": {""type"": ""bool"", ""description"": ""Create the namespace if it does not exist"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""dependency_update"": {""type"": ""bool"", ""description"": ""Run helm dependency update before installing the chart"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""description"": {""type"": ""string"", ""description"": ""Add a custom description"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""devel"": {""type"": ""bool"", ""description"": ""Use chart development versions, too. Equivalent to version '>0.0.0-0'. If 'version' is set, this is ignored"", ""description_kind"": ""plain"", ""optional"": true}, ""disable_crd_hooks"": {""type"": ""bool"", ""description"": ""Prevent CRD hooks from running, but run other hooks. See helm install --no-crd-hook"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""disable_openapi_validation"": {""type"": ""bool"", ""description"": ""If set, the installation process will not validate rendered templates against the Kubernetes OpenAPI Schema"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""disable_webhooks"": {""type"": ""bool"", ""description"": ""Prevent hooks from running"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""force_update"": {""type"": ""bool"", ""description"": ""Force resource update through delete/recreate if needed."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""keyring"": {""type"": ""string"", ""description"": ""Location of public keys used for verification, Used only if 'verify is true'"", ""description_kind"": ""plain"", ""optional"": true}, ""lint"": {""type"": ""bool"", ""description"": ""Run helm lint when planning"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""manifest"": {""type"": ""string"", ""description"": ""The rendered manifest as JSON."", ""description_kind"": ""plain"", ""computed"": true}, ""max_history"": {""type"": ""number"", ""description"": ""Limit the maximum number of revisions saved per release. Use 0 for no limit"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""metadata"": {""nested_type"": {""attributes"": {""app_version"": {""type"": ""string"", ""description"": ""The version number of the application being deployed"", ""description_kind"": ""plain"", ""computed"": true}, ""chart"": {""type"": ""string"", ""description"": ""The name of the chart"", ""description_kind"": ""plain"", ""computed"": true}, ""first_deployed"": {""type"": ""number"", ""description"": ""FirstDeployed is an int64 which represents timestamp when the release was first deployed."", ""description_kind"": ""plain"", ""computed"": true}, ""last_deployed"": {""type"": ""number"", ""description"": ""LastDeployed is an int64 which represents timestamp when the release was last deployed."", ""description_kind"": ""plain"", ""computed"": true}, ""name"": {""type"": ""string"", ""description"": ""Name is the name of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""namespace"": {""type"": ""string"", ""description"": ""Namespace is the kubernetes namespace of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""notes"": {""type"": ""string"", ""description"": ""Notes is the description of the deployed release, rendered from templates."", ""description_kind"": ""plain"", ""computed"": true}, ""revision"": {""type"": ""number"", ""description"": ""Version is an int32 which represents the version of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""values"": {""type"": ""string"", ""description"": ""Set of extra values. added to the chart. The sensitive data is cloaked. JSON encoded."", ""description_kind"": ""plain"", ""computed"": true}, ""version"": {""type"": ""string"", ""description"": ""A SemVer 2 conformant version string of the chart"", ""description_kind"": ""plain"", ""computed"": true}}, ""nesting_mode"": ""single""}, ""description"": ""Status of the deployed release."", ""description_kind"": ""plain"", ""computed"": true}, ""name"": {""type"": ""string"", ""description"": ""Release name. The length must not be longer than 53 characters"", ""description_kind"": ""plain"", ""required"": true}, ""namespace"": {""type"": ""string"", ""description"": ""Namespace to install the release into"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""pass_credentials"": {""type"": ""bool"", ""description"": ""Pass credentials to all domains"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""postrender"": {""nested_type"": {""attributes"": {""args"": {""type"": [""list"", ""string""], ""description"": ""An argument to the post-renderer (can specify multiple)"", ""description_kind"": ""plain"", ""optional"": true}, ""binary_path"": {""type"": ""string"", ""description"": ""The common binary path"", ""description_kind"": ""plain"", ""required"": true}}, ""nesting_mode"": ""single""}, ""description"": ""Postrender command config"", ""description_kind"": ""plain"", ""optional"": true}, ""recreate_pods"": {""type"": ""bool"", ""description"": ""Perform pods restart during upgrade/rollback"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""render_subchart_notes"": {""type"": ""bool"", ""description"": ""If set, render subchart notes along with the parent"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""replace"": {""type"": ""bool"", ""description"": ""Re-use the given name, even if that name is already used. This is unsafe in production"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""repository"": {""type"": ""string"", ""description"": ""Repository where to locate the requested chart. If it is a URL, the chart is installed without installing the repository"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_ca_file"": {""type"": ""string"", ""description"": ""The Repositories CA file"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_cert_file"": {""type"": ""string"", ""description"": ""The repositories cert file"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_key_file"": {""type"": ""string"", ""description"": ""The repositories cert key file"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_password"": {""type"": ""string"", ""description"": ""Password for HTTP basic authentication"", ""description_kind"": ""plain"", ""optional"": true, ""sensitive"": true}, ""repository_username"": {""type"": ""string"", ""description"": ""Username for HTTP basic authentication"", ""description_kind"": ""plain"", ""optional"": true}, ""reset_values"": {""type"": ""bool"", ""description"": ""When upgrading, reset the values to the ones built into the chart"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""resources"": {""type"": [""map"", ""string""], ""description"": ""The kubernetes resources created by this release."", ""description_kind"": ""plain"", ""computed"": true}, ""reuse_values"": {""type"": ""bool"", ""description"": ""When upgrading, reuse the last release's values and merge in any overrides. If 'reset_values' is specified, this is ignored"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""set"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""value"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_list"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""value"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""required"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom sensitive values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_sensitive"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""value"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true, ""sensitive"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom sensitive values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_wo"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""value"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_wo_revision"": {""type"": ""number"", ""description"": ""The current revision of the write-only \""set_wo\"" attribute. Incrementing this integer value will cause Terraform to update the write-only value."", ""description_kind"": ""plain"", ""optional"": true}, ""skip_crds"": {""type"": ""bool"", ""description"": ""If set, no CRDs will be installed. By default, CRDs are installed if not already present"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""status"": {""type"": ""string"", ""description"": ""Status of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""take_ownership"": {""type"": ""bool"", ""description"": ""If set, Helm will take ownership of resources not already annotated by this release. Useful for migrations or recovery."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeout"": {""type"": ""number"", ""description"": ""Time in seconds to wait for any individual kubernetes operation"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeouts"": {""nested_type"": {""attributes"": {""create"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours)."", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours). Setting a timeout for a Delete operation is only applicable if changes are saved into state before the destroy operation occurs."", ""description_kind"": ""plain"", ""optional"": true}, ""read"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours). Read operations occur during any refresh or planning operation when refresh is enabled."", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours)."", ""description_kind"": ""plain"", ""optional"": true}}, ""nesting_mode"": ""single""}, ""description_kind"": ""plain"", ""optional"": true}, ""upgrade_install"": {""type"": ""bool"", ""description"": ""If true, the provider will install the release at the specified version even if a release not controlled by the provider is present. This is equivalent to running 'helm upgrade --install'. WARNING: this may not be suitable for production use -- see the 'Upgrade Mode' note in the provider documentation. Defaults to `false`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""values"": {""type"": [""list"", ""string""], ""description"": ""List of values in raw YAML format to pass to helm"", ""description_kind"": ""plain"", ""optional"": true}, ""verify"": {""type"": ""bool"", ""description"": ""Verify the package before installing it."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""version"": {""type"": ""string"", ""description"": ""Specify the exact chart version to install. If this is not specified, the latest version is installed"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""wait"": {""type"": ""bool"", ""description"": ""Will wait until all resources are in a ready state before marking the release as successful."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""wait_for_jobs"": {""type"": ""bool"", ""description"": ""If wait is enabled, will wait until all Jobs have been completed before marking the release as successful."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {}, ""matched_block_name"": ""helm_release"", ""matched_block_type"": ""resource""}",helm_release,resource,"variable ""install_ingress_controller"" {
  description = ""Whether to install the nginx ingress controller""
}

variable ""install_theia_cloud_base"" {
  description = ""Whether to install theia cloud base""
  default     = true
}

variable ""install_theia_cloud_crds"" {
  description = ""Whether to install theia cloud crds""
  default     = true
}

variable ""install_theia_cloud"" {
  description = ""Whether to install theia cloud""
  default     = true
}

variable ""install_selfsigned_issuer"" {
  description = ""Whether to install an additional self signed issuer""
  default     = false
}

variable ""cert_manager_issuer_email"" {
  description = ""EMail address used to create certificates.""
}

variable ""cert_manager_cluster_issuer"" {
  type = string

  validation {
    condition     = length(regexall(""^(letsencrypt-prod|theia-cloud-selfsigned-issuer|keycloak-selfsigned-issuer)$"", var.cert_manager_cluster_issuer)) > 0
    error_message = ""ERROR: Valid values are \""letsencrypt-prod\"", \""theia-cloud-selfsigned-issuer\"", and \""keycloak-selfsigned-issuer\""!""
  }
}

variable ""cert_manager_common_name"" {
  description = ""The common name for the certificate""
  default     = """"
}

variable ""hostname"" {
  description = ""The hostname for all installed services""
}

variable ""service_type"" {
  description = ""Kubernetes service type""
  default     = ""LoadBalancer""

}

variable ""postgresql_storageClass"" {
  description = ""StorageClass for Persistent Volume(s)""
  default     = """"
}

variable ""postgresql_volumePermissions"" {
  description = ""Enable init container that changes the owner and group of the persistent volume""
  default     = false
}

variable ""keycloak_admin_password"" {
  description = ""Keycloak Admin Password""
  sensitive   = true
}

variable ""postgresql_enabled"" {
  description = ""Whether to enable postgreswl""
  default     = true
}

variable ""postgres_postgres_password"" {
  description = ""Keycloak Postgres DB Postgres (Admin) Password""
  sensitive   = true
}

variable ""postgres_password"" {
  description = ""Keycloak Postgres DB Password""
  sensitive   = true
}

variable ""loadBalancerIP"" {
  description = ""External IP for the nginx ingress controller""
  default     = """"
}

variable ""cloudProvider"" {
  description = ""The cloud provider to use""
  default     = ""K8S""
}

resource ""helm_release"" ""cert-manager"" {
  name             = ""cert-manager""
  repository       = ""https://charts.jetstack.io""
  chart            = ""cert-manager""
  version          = ""v1.16.2""
  namespace        = ""cert-manager""
  create_namespace = true

  set {
    name  = ""installCRDs""
    value = ""true""
  }
}

resource ""helm_release"" ""nginx-ingress-controller"" {
  count            = var.install_ingress_controller ? 1 : 0
  name             = ""nginx-ingress-controller""
  repository       = ""https://kubernetes.github.io/ingress-nginx""
  chart            = ""ingress-nginx""
  version          = ""4.11.5""
  namespace        = ""ingress-nginx""
  create_namespace = true

  set {
    name  = ""fullnameOverride""
    value = ""ingress-nginx""
  }

  set {
    name  = ""controller.service.loadBalancerIP""
    value = var.loadBalancerIP
  }

  set {
    name  = ""controller.allowSnippetAnnotations""
    value = true
  }
}

resource ""helm_release"" ""theia-cloud-base"" {
  count            = var.install_theia_cloud_base ? 1 : 0
  depends_on       = [helm_release.cert-manager, helm_release.nginx-ingress-controller] # we need to install cert issuers
  name             = ""theia-cloud-base""
  repository       = ""https://eclipse-theia.github.io/theia-cloud-helm""
  chart            = ""theia-cloud-base""
  version          = ""1.1.1""
  namespace        = ""theia-cloud""
  create_namespace = true

  set {
    name  = ""issuer.email""
    value = var.cert_manager_issuer_email
  }
}

resource ""helm_release"" ""theia-cloud-crds"" {
  count            = var.install_theia_cloud_crds ? 1 : 0
  depends_on       = [helm_release.theia-cloud-base]
  name             = ""theia-cloud-crds""
  repository       = ""https://eclipse-theia.github.io/theia-cloud-helm""
  chart            = ""theia-cloud-crds""
  version          = ""1.1.1""
  namespace        = ""theia-cloud""
  create_namespace = true
}

resource ""kubectl_manifest"" ""selfsigned_issuer"" {
  count      = var.install_selfsigned_issuer ? 1 : 0
  depends_on = [helm_release.cert-manager, helm_release.nginx-ingress-controller] # we need to install cert issuers
  yaml_body  = file(""${path.module}/clusterissuer-selfsigned.yaml"")
}

locals {
  # local_exec_quotes is a helper function to deal with different handling of
  # quotes between linux and windows. On linux, it will output ""'"". On windows,
  # it will output """".
  local_exec_quotes = startswith(abspath(path.module), ""/"") ? ""'"" : """"
  jsonpatch = jsonencode([{
    ""op""    = ""add"",
    ""path""  = ""/spec/template/spec/containers/0/args/-"",
    ""value"" = ""--default-ssl-certificate=keycloak/${var.hostname}-tls""
  }])
}

resource ""helm_release"" ""keycloak"" {
  depends_on       = [helm_release.theia-cloud-base, kubectl_manifest.selfsigned_issuer] # we need an existing issuer
  name             = ""keycloak""
  repository       = ""https://charts.bitnami.com/bitnami""
  chart            = ""keycloak""
  version          = ""15.1.8""
  namespace        = ""keycloak""
  create_namespace = true

  values = [
    ""${templatefile(""${path.module}/keycloak.yaml"", { cluster-issuer = var.cert_manager_cluster_issuer, common-name = var.cert_manager_common_name })}""
  ]

  set {
    name  = ""postgresql.enabled""
    value = var.postgresql_enabled
  }
  set {
    name  = ""ingress.hostname""
    value = var.hostname
  }
  set {
    name  = ""global.storageClass""
    value = var.postgresql_storageClass
  }
  set {
    name  = ""service.type""
    value = var.service_type
  }
  set {
    name  = ""postgresql.volumePermissions.enabled""
    value = var.postgresql_volumePermissions
  }
  set_sensitive {
    name  = ""auth.adminPassword""
    value = var.keycloak_admin_password
  }
  set_sensitive {
    name  = ""postgresql.auth.postgresPassword""
    value = var.postgres_postgres_password
  }
  set_sensitive {
    name  = ""postgresql.auth.password""
    value = var.postgres_password
  }

  # We expect that kubectl context was configured by a previous module.
  # After keycloak was set up with tls enabled, we use the created tls secret as the default ssl-secret of the nginx-ingress-controller. 
  # Below command connects to the cluster in the local environment and patches the ingress-controller accordingly. 
  # Theia Cloud is then installed with path based hosts reusing the same certificate. 
  provisioner ""local-exec"" {
    command = ""kubectl patch deploy ingress-nginx-controller --type=${local.local_exec_quotes}json${local.local_exec_quotes} -n ingress-nginx -p ${local.local_exec_quotes}${local.jsonpatch}${local.local_exec_quotes} && kubectl wait pods -n ingress-nginx -l app.kubernetes.io/component=controller --for condition=Ready --timeout=90s && kubectl wait certificate -n keycloak ${var.hostname}-tls --for condition=Ready --timeout=90s""
  }
}

resource ""helm_release"" ""theia-cloud"" {
  count            = var.install_theia_cloud ? 1 : 0
  depends_on       = [helm_release.keycloak, helm_release.theia-cloud-crds] # wait for keycloak to make the default cert available
  name             = ""theia-cloud""
  repository       = ""https://eclipse-theia.github.io/theia-cloud-helm""
  chart            = ""theia-cloud""
  version          = ""1.1.1""
  namespace        = ""theia-cloud""
  create_namespace = true

  values = [
    ""${file(""${path.module}/theia-cloud.yaml"")}""
  ]

  set {
    name  = ""hosts.configuration.baseHost""
    value = var.hostname
  }

  set {
    name  = ""keycloak.authUrl""
    value = ""https://${var.hostname}/keycloak/""
  }

  set {
    name  = ""operator.cloudProvider""
    value = var.cloudProvider
  }
}
"
eclipsesource__theia-cloud,c215724f17b9885e5cee7dc4baf2b94c03747169,clones/eclipsesource__theia-cloud/terraform/modules/helm,cf2156ef1986dc1819cb4c98700a80e7aca60af8,error,Unsupported block type,"Blocks of type ""set"" are not expected here. Did you mean to define argument ""set""? If so, use the equals sign to assign it a value.",clones/eclipsesource__theia-cloud/terraform/modules/helm/main.tf,101,3,101,6,resource,helm_release cert-manager,"resource ""helm_release"" ""cert-manager"" {
  name             = ""cert-manager""
  repository       = ""https://charts.jetstack.io""
  chart            = ""cert-manager""
  version          = ""v1.16.2""
  namespace        = ""cert-manager""
  create_namespace = true

  set {
    name  = ""installCRDs""
    value = ""true""
  }
}",93,105,resource helm_release cert-manager,1,1,4.38,32,13,12,0,0,8,helm,3.1.1,"{""attributes"": {""atomic"": {""type"": ""bool"", ""description"": ""If set, installation process purges chart on fail. The wait flag will be set automatically if atomic is used"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""chart"": {""type"": ""string"", ""description"": ""Chart name to be installed. A path may be used"", ""description_kind"": ""plain"", ""required"": true}, ""cleanup_on_fail"": {""type"": ""bool"", ""description"": ""Allow deletion of new resources created in this upgrade when upgrade fails"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""create_namespace"": {""type"": ""bool"", ""description"": ""Create the namespace if it does not exist"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""dependency_update"": {""type"": ""bool"", ""description"": ""Run helm dependency update before installing the chart"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""description"": {""type"": ""string"", ""description"": ""Add a custom description"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""devel"": {""type"": ""bool"", ""description"": ""Use chart development versions, too. Equivalent to version '>0.0.0-0'. If 'version' is set, this is ignored"", ""description_kind"": ""plain"", ""optional"": true}, ""disable_crd_hooks"": {""type"": ""bool"", ""description"": ""Prevent CRD hooks from running, but run other hooks. See helm install --no-crd-hook"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""disable_openapi_validation"": {""type"": ""bool"", ""description"": ""If set, the installation process will not validate rendered templates against the Kubernetes OpenAPI Schema"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""disable_webhooks"": {""type"": ""bool"", ""description"": ""Prevent hooks from running"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""force_update"": {""type"": ""bool"", ""description"": ""Force resource update through delete/recreate if needed."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""keyring"": {""type"": ""string"", ""description"": ""Location of public keys used for verification, Used only if 'verify is true'"", ""description_kind"": ""plain"", ""optional"": true}, ""lint"": {""type"": ""bool"", ""description"": ""Run helm lint when planning"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""manifest"": {""type"": ""string"", ""description"": ""The rendered manifest as JSON."", ""description_kind"": ""plain"", ""computed"": true}, ""max_history"": {""type"": ""number"", ""description"": ""Limit the maximum number of revisions saved per release. Use 0 for no limit"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""metadata"": {""nested_type"": {""attributes"": {""app_version"": {""type"": ""string"", ""description"": ""The version number of the application being deployed"", ""description_kind"": ""plain"", ""computed"": true}, ""chart"": {""type"": ""string"", ""description"": ""The name of the chart"", ""description_kind"": ""plain"", ""computed"": true}, ""first_deployed"": {""type"": ""number"", ""description"": ""FirstDeployed is an int64 which represents timestamp when the release was first deployed."", ""description_kind"": ""plain"", ""computed"": true}, ""last_deployed"": {""type"": ""number"", ""description"": ""LastDeployed is an int64 which represents timestamp when the release was last deployed."", ""description_kind"": ""plain"", ""computed"": true}, ""name"": {""type"": ""string"", ""description"": ""Name is the name of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""namespace"": {""type"": ""string"", ""description"": ""Namespace is the kubernetes namespace of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""notes"": {""type"": ""string"", ""description"": ""Notes is the description of the deployed release, rendered from templates."", ""description_kind"": ""plain"", ""computed"": true}, ""revision"": {""type"": ""number"", ""description"": ""Version is an int32 which represents the version of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""values"": {""type"": ""string"", ""description"": ""Set of extra values. added to the chart. The sensitive data is cloaked. JSON encoded."", ""description_kind"": ""plain"", ""computed"": true}, ""version"": {""type"": ""string"", ""description"": ""A SemVer 2 conformant version string of the chart"", ""description_kind"": ""plain"", ""computed"": true}}, ""nesting_mode"": ""single""}, ""description"": ""Status of the deployed release."", ""description_kind"": ""plain"", ""computed"": true}, ""name"": {""type"": ""string"", ""description"": ""Release name. The length must not be longer than 53 characters"", ""description_kind"": ""plain"", ""required"": true}, ""namespace"": {""type"": ""string"", ""description"": ""Namespace to install the release into"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""pass_credentials"": {""type"": ""bool"", ""description"": ""Pass credentials to all domains"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""postrender"": {""nested_type"": {""attributes"": {""args"": {""type"": [""list"", ""string""], ""description"": ""An argument to the post-renderer (can specify multiple)"", ""description_kind"": ""plain"", ""optional"": true}, ""binary_path"": {""type"": ""string"", ""description"": ""The common binary path"", ""description_kind"": ""plain"", ""required"": true}}, ""nesting_mode"": ""single""}, ""description"": ""Postrender command config"", ""description_kind"": ""plain"", ""optional"": true}, ""recreate_pods"": {""type"": ""bool"", ""description"": ""Perform pods restart during upgrade/rollback"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""render_subchart_notes"": {""type"": ""bool"", ""description"": ""If set, render subchart notes along with the parent"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""replace"": {""type"": ""bool"", ""description"": ""Re-use the given name, even if that name is already used. This is unsafe in production"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""repository"": {""type"": ""string"", ""description"": ""Repository where to locate the requested chart. If it is a URL, the chart is installed without installing the repository"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_ca_file"": {""type"": ""string"", ""description"": ""The Repositories CA file"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_cert_file"": {""type"": ""string"", ""description"": ""The repositories cert file"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_key_file"": {""type"": ""string"", ""description"": ""The repositories cert key file"", ""description_kind"": ""plain"", ""optional"": true}, ""repository_password"": {""type"": ""string"", ""description"": ""Password for HTTP basic authentication"", ""description_kind"": ""plain"", ""optional"": true, ""sensitive"": true}, ""repository_username"": {""type"": ""string"", ""description"": ""Username for HTTP basic authentication"", ""description_kind"": ""plain"", ""optional"": true}, ""reset_values"": {""type"": ""bool"", ""description"": ""When upgrading, reset the values to the ones built into the chart"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""resources"": {""type"": [""map"", ""string""], ""description"": ""The kubernetes resources created by this release."", ""description_kind"": ""plain"", ""computed"": true}, ""reuse_values"": {""type"": ""bool"", ""description"": ""When upgrading, reuse the last release's values and merge in any overrides. If 'reset_values' is specified, this is ignored"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""set"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""value"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_list"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""value"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""required"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom sensitive values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_sensitive"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""value"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true, ""sensitive"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom sensitive values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_wo"": {""nested_type"": {""attributes"": {""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""value"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}}, ""nesting_mode"": ""list""}, ""description"": ""Custom values to be merged with the values"", ""description_kind"": ""plain"", ""optional"": true}, ""set_wo_revision"": {""type"": ""number"", ""description"": ""The current revision of the write-only \""set_wo\"" attribute. Incrementing this integer value will cause Terraform to update the write-only value."", ""description_kind"": ""plain"", ""optional"": true}, ""skip_crds"": {""type"": ""bool"", ""description"": ""If set, no CRDs will be installed. By default, CRDs are installed if not already present"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""status"": {""type"": ""string"", ""description"": ""Status of the release"", ""description_kind"": ""plain"", ""computed"": true}, ""take_ownership"": {""type"": ""bool"", ""description"": ""If set, Helm will take ownership of resources not already annotated by this release. Useful for migrations or recovery."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeout"": {""type"": ""number"", ""description"": ""Time in seconds to wait for any individual kubernetes operation"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeouts"": {""nested_type"": {""attributes"": {""create"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours)."", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours). Setting a timeout for a Delete operation is only applicable if changes are saved into state before the destroy operation occurs."", ""description_kind"": ""plain"", ""optional"": true}, ""read"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours). Read operations occur during any refresh or planning operation when refresh is enabled."", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description"": ""A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as \""30s\"" or \""2h45m\"". Valid time units are \""s\"" (seconds), \""m\"" (minutes), \""h\"" (hours)."", ""description_kind"": ""plain"", ""optional"": true}}, ""nesting_mode"": ""single""}, ""description_kind"": ""plain"", ""optional"": true}, ""upgrade_install"": {""type"": ""bool"", ""description"": ""If true, the provider will install the release at the specified version even if a release not controlled by the provider is present. This is equivalent to running 'helm upgrade --install'. WARNING: this may not be suitable for production use -- see the 'Upgrade Mode' note in the provider documentation. Defaults to `false`."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""values"": {""type"": [""list"", ""string""], ""description"": ""List of values in raw YAML format to pass to helm"", ""description_kind"": ""plain"", ""optional"": true}, ""verify"": {""type"": ""bool"", ""description"": ""Verify the package before installing it."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""version"": {""type"": ""string"", ""description"": ""Specify the exact chart version to install. If this is not specified, the latest version is installed"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""wait"": {""type"": ""bool"", ""description"": ""Will wait until all resources are in a ready state before marking the release as successful."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""wait_for_jobs"": {""type"": ""bool"", ""description"": ""If wait is enabled, will wait until all Jobs have been completed before marking the release as successful."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {}, ""matched_block_name"": ""helm_release"", ""matched_block_type"": ""resource""}",helm_release,resource,"variable ""install_ingress_controller"" {
  description = ""Whether to install the nginx ingress controller""
}

variable ""install_theia_cloud_base"" {
  description = ""Whether to install theia cloud base""
  default     = true
}

variable ""install_theia_cloud_crds"" {
  description = ""Whether to install theia cloud crds""
  default     = true
}

variable ""install_theia_cloud"" {
  description = ""Whether to install theia cloud""
  default     = true
}

variable ""install_selfsigned_issuer"" {
  description = ""Whether to install an additional self signed issuer""
  default     = false
}

variable ""cert_manager_issuer_email"" {
  description = ""EMail address used to create certificates.""
}

variable ""cert_manager_cluster_issuer"" {
  type = string

  validation {
    condition     = length(regexall(""^(letsencrypt-prod|theia-cloud-selfsigned-issuer|keycloak-selfsigned-issuer)$"", var.cert_manager_cluster_issuer)) > 0
    error_message = ""ERROR: Valid values are \""letsencrypt-prod\"", \""theia-cloud-selfsigned-issuer\"", and \""keycloak-selfsigned-issuer\""!""
  }
}

variable ""cert_manager_common_name"" {
  description = ""The common name for the certificate""
  default     = """"
}

variable ""hostname"" {
  description = ""The hostname for all installed services""
}

variable ""service_type"" {
  description = ""Kubernetes service type""
  default     = ""LoadBalancer""

}

variable ""postgresql_storageClass"" {
  description = ""StorageClass for Persistent Volume(s)""
  default     = """"
}

variable ""postgresql_volumePermissions"" {
  description = ""Enable init container that changes the owner and group of the persistent volume""
  default     = false
}

variable ""keycloak_admin_password"" {
  description = ""Keycloak Admin Password""
  sensitive   = true
}

variable ""postgresql_enabled"" {
  description = ""Whether to enable postgreswl""
  default     = true
}

variable ""postgres_postgres_password"" {
  description = ""Keycloak Postgres DB Postgres (Admin) Password""
  sensitive   = true
}

variable ""postgres_password"" {
  description = ""Keycloak Postgres DB Password""
  sensitive   = true
}

variable ""loadBalancerIP"" {
  description = ""External IP for the nginx ingress controller""
  default     = """"
}

variable ""cloudProvider"" {
  description = ""The cloud provider to use""
  default     = ""K8S""
}

resource ""helm_release"" ""cert-manager"" {
  name             = ""cert-manager""
  repository       = ""https://charts.jetstack.io""
  chart            = ""cert-manager""
  version          = ""v1.16.2""
  namespace        = ""cert-manager""
  create_namespace = true

  set {
    name  = ""installCRDs""
    value = ""true""
  }
}

resource ""helm_release"" ""nginx-ingress-controller"" {
  count            = var.install_ingress_controller ? 1 : 0
  name             = ""nginx-ingress-controller""
  repository       = ""https://kubernetes.github.io/ingress-nginx""
  chart            = ""ingress-nginx""
  version          = ""4.11.5""
  namespace        = ""ingress-nginx""
  create_namespace = true

  set {
    name  = ""fullnameOverride""
    value = ""ingress-nginx""
  }

  set {
    name  = ""controller.service.loadBalancerIP""
    value = var.loadBalancerIP
  }

  set {
    name  = ""controller.allowSnippetAnnotations""
    value = true
  }
}

resource ""helm_release"" ""theia-cloud-base"" {
  count            = var.install_theia_cloud_base ? 1 : 0
  depends_on       = [helm_release.cert-manager, helm_release.nginx-ingress-controller] # we need to install cert issuers
  name             = ""theia-cloud-base""
  repository       = ""https://eclipse-theia.github.io/theia-cloud-helm""
  chart            = ""theia-cloud-base""
  version          = ""1.1.1""
  namespace        = ""theia-cloud""
  create_namespace = true

  set {
    name  = ""issuer.email""
    value = var.cert_manager_issuer_email
  }
}

resource ""helm_release"" ""theia-cloud-crds"" {
  count            = var.install_theia_cloud_crds ? 1 : 0
  depends_on       = [helm_release.theia-cloud-base]
  name             = ""theia-cloud-crds""
  repository       = ""https://eclipse-theia.github.io/theia-cloud-helm""
  chart            = ""theia-cloud-crds""
  version          = ""1.1.1""
  namespace        = ""theia-cloud""
  create_namespace = true
}

resource ""kubectl_manifest"" ""selfsigned_issuer"" {
  count      = var.install_selfsigned_issuer ? 1 : 0
  depends_on = [helm_release.cert-manager, helm_release.nginx-ingress-controller] # we need to install cert issuers
  yaml_body  = file(""${path.module}/clusterissuer-selfsigned.yaml"")
}

locals {
  # local_exec_quotes is a helper function to deal with different handling of
  # quotes between linux and windows. On linux, it will output ""'"". On windows,
  # it will output """".
  local_exec_quotes = startswith(abspath(path.module), ""/"") ? ""'"" : """"
  jsonpatch = jsonencode([{
    ""op""    = ""add"",
    ""path""  = ""/spec/template/spec/containers/0/args/-"",
    ""value"" = ""--default-ssl-certificate=keycloak/${var.hostname}-tls""
  }])
}

resource ""helm_release"" ""keycloak"" {
  depends_on       = [helm_release.theia-cloud-base, kubectl_manifest.selfsigned_issuer] # we need an existing issuer
  name             = ""keycloak""
  repository       = ""https://charts.bitnami.com/bitnami""
  chart            = ""keycloak""
  version          = ""15.1.8""
  namespace        = ""keycloak""
  create_namespace = true

  values = [
    ""${templatefile(""${path.module}/keycloak.yaml"", { cluster-issuer = var.cert_manager_cluster_issuer, common-name = var.cert_manager_common_name })}""
  ]

  set {
    name  = ""postgresql.enabled""
    value = var.postgresql_enabled
  }
  set {
    name  = ""ingress.hostname""
    value = var.hostname
  }
  set {
    name  = ""global.storageClass""
    value = var.postgresql_storageClass
  }
  set {
    name  = ""service.type""
    value = var.service_type
  }
  set {
    name  = ""postgresql.volumePermissions.enabled""
    value = var.postgresql_volumePermissions
  }
  set_sensitive {
    name  = ""auth.adminPassword""
    value = var.keycloak_admin_password
  }
  set_sensitive {
    name  = ""postgresql.auth.postgresPassword""
    value = var.postgres_postgres_password
  }
  set_sensitive {
    name  = ""postgresql.auth.password""
    value = var.postgres_password
  }

  # We expect that kubectl context was configured by a previous module.
  # After keycloak was set up with tls enabled, we use the created tls secret as the default ssl-secret of the nginx-ingress-controller. 
  # Below command connects to the cluster in the local environment and patches the ingress-controller accordingly. 
  # Theia Cloud is then installed with path based hosts reusing the same certificate. 
  provisioner ""local-exec"" {
    command = ""kubectl patch deploy ingress-nginx-controller --type=${local.local_exec_quotes}json${local.local_exec_quotes} -n ingress-nginx -p ${local.local_exec_quotes}${local.jsonpatch}${local.local_exec_quotes} && kubectl wait pods -n ingress-nginx -l app.kubernetes.io/component=controller --for condition=Ready --timeout=90s && kubectl wait certificate -n keycloak ${var.hostname}-tls --for condition=Ready --timeout=90s""
  }
}

resource ""helm_release"" ""theia-cloud"" {
  count            = var.install_theia_cloud ? 1 : 0
  depends_on       = [helm_release.keycloak, helm_release.theia-cloud-crds] # wait for keycloak to make the default cert available
  name             = ""theia-cloud""
  repository       = ""https://eclipse-theia.github.io/theia-cloud-helm""
  chart            = ""theia-cloud""
  version          = ""1.1.1""
  namespace        = ""theia-cloud""
  create_namespace = true

  values = [
    ""${file(""${path.module}/theia-cloud.yaml"")}""
  ]

  set {
    name  = ""hosts.configuration.baseHost""
    value = var.hostname
  }

  set {
    name  = ""keycloak.authUrl""
    value = ""https://${var.hostname}/keycloak/""
  }

  set {
    name  = ""operator.cloudProvider""
    value = var.cloudProvider
  }
}
"
kubernetes-sigs__kubespray,b9e1e8577fade952f72281fc3b9fd16d7c0f994a,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack/modules/compute,da91cc6bff0c0a60f1423a3137b338c4456f41c3,error,Invalid resource type,"The provider terraform-provider-openstack/openstack does not support resource type ""openstack_blockstorage_volume_v2"". Did you mean ""openstack_blockstorage_volume_v3""?",clones/kubernetes-sigs__kubespray/contrib/terraform/openstack/modules/compute/main.tf,1081,10,1081,44,resource,openstack_blockstorage_volume_v2 glusterfs_volume,"resource ""openstack_blockstorage_volume_v2"" ""glusterfs_volume"" {
  name        = ""${var.cluster_name}-glusterfs_volume-${count.index + 1}""
  count       = var.gfs_root_volume_size_in_gb == 0 ? var.number_of_gfs_nodes_no_floating_ip : 0
  description = ""Non-ephemeral volume for GlusterFS""
  size        = var.gfs_volume_size_in_gb
}",1081,1086,resource openstack_blockstorage_volume_v2 glusterfs_volume,0,2,4.72,43,6,6,1,5,4,openstack,3.4.0,"{""attributes"": {""attachment"": {""type"": [""set"", [""object"", {""device"": ""string"", ""id"": ""string"", ""instance_id"": ""string""}]], ""description_kind"": ""plain"", ""computed"": true}, ""availability_zone"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""backup_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""consistency_group_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""description"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""enable_online_resize"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""image_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""metadata"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""region"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""size"": {""type"": ""number"", ""description_kind"": ""plain"", ""required"": true}, ""snapshot_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""source_replica"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""source_vol_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""volume_retype_policy"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""volume_type"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""scheduler_hints"": {""nesting_mode"": ""set"", ""block"": {""attributes"": {""additional_properties"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""different_host"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""local_to_instance"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""query"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""same_host"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}, ""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""create"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}}, ""matched_block_name"": ""openstack_blockstorage_volume_v3"", ""matched_block_type"": ""resource""}",openstack_blockstorage_volume_v3,resource,"data ""openstack_images_image_v2"" ""vm_image"" {
  count = var.image_uuid == """" ? 1 : 0
  most_recent = true
  name = var.image
}

data ""openstack_images_image_v2"" ""gfs_image"" {
  count = var.image_gfs_uuid == """" ? var.image_uuid == """" ? 1 : 0 : 0
  most_recent = true
  name = var.image_gfs == """" ? var.image : var.image_gfs
}

data ""openstack_images_image_v2"" ""image_master"" {
  count = var.image_master_uuid == """" ? var.image_uuid == """" ? 1 : 0 : 0
  name = var.image_master == """" ? var.image : var.image_master
}

data ""cloudinit_config"" ""cloudinit"" {
  part {
    content_type =  ""text/cloud-config""
    content = templatefile(""${path.module}/templates/cloudinit.yaml.tmpl"", {
      extra_partitions = [],
      netplan_critical_dhcp_interface = """"
    })
  }
}

data ""openstack_networking_network_v2"" ""k8s_network"" {
  count = var.use_existing_network ? 1 : 0
  name  = var.network_name
}

resource ""openstack_compute_keypair_v2"" ""k8s"" {
  name       = ""kubernetes-${var.cluster_name}""
  public_key = chomp(file(var.public_key_path))
}

resource ""openstack_networking_secgroup_v2"" ""k8s_master"" {
  name                 = ""${var.cluster_name}-k8s-master""
  description          = ""${var.cluster_name} - Kubernetes Master""
  delete_default_rules = true
}

resource ""openstack_networking_secgroup_v2"" ""k8s_master_extra"" {
  count                = ""%{if var.extra_sec_groups}1%{else}0%{endif}""
  name                 = ""${var.cluster_name}-k8s-master-${var.extra_sec_groups_name}""
  description          = ""${var.cluster_name} - Kubernetes Master nodes - rules not managed by terraform""
  delete_default_rules = true
}

resource ""openstack_networking_secgroup_rule_v2"" ""k8s_master"" {
  count             = length(var.master_allowed_remote_ips)
  direction         = ""ingress""
  ethertype         = ""IPv4""
  protocol          = ""tcp""
  port_range_min    = ""6443""
  port_range_max    = ""6443""
  remote_ip_prefix  = var.master_allowed_remote_ips[count.index]
  security_group_id = openstack_networking_secgroup_v2.k8s_master.id
}

resource ""openstack_networking_secgroup_rule_v2"" ""k8s_master_ports"" {
  count             = length(var.master_allowed_ports)
  direction         = ""ingress""
  ethertype         = ""IPv4""
  protocol          = lookup(var.master_allowed_ports[count.index], ""protocol"", ""tcp"")
  port_range_min    = lookup(var.master_allowed_ports[count.index], ""port_range_min"")
  port_range_max    = lookup(var.master_allowed_ports[count.index], ""port_range_max"")
  remote_ip_prefix  = lookup(var.master_allowed_ports[count.index], ""remote_ip_prefix"", ""0.0.0.0/0"")
  security_group_id = openstack_networking_secgroup_v2.k8s_master.id
}

resource ""openstack_networking_secgroup_rule_v2"" ""k8s_master_ipv6_ingress"" {
  count             = length(var.master_allowed_remote_ipv6_ips)
  direction         = ""ingress""
  ethertype         = ""IPv6""
  protocol          = ""tcp""
  port_range_min    = ""6443""
  port_range_max    = ""6443""
  remote_ip_prefix  = var.master_allowed_remote_ipv6_ips[count.index]
  security_group_id = openstack_networking_secgroup_v2.k8s_master.id
}

resource ""openstack_networking_secgroup_rule_v2"" ""k8s_master_ports_ipv6_ingress"" {
  count             = length(var.master_allowed_ports_ipv6)
  direction         = ""ingress""
  ethertype         = ""IPv6""
  protocol          = lookup(var.master_allowed_ports_ipv6[count.index], ""protocol"", ""tcp"")
  port_range_min    = lookup(var.master_allowed_ports_ipv6[count.index], ""port_range_min"")
  port_range_max    = lookup(var.master_allowed_ports_ipv6[count.index], ""port_range_max"")
  remote_ip_prefix  = lookup(var.master_allowed_ports_ipv6[count.index], ""remote_ip_prefix"", ""::/0"")
  security_group_id = openstack_networking_secgroup_v2.k8s_master.id
}

resource ""openstack_networking_secgroup_rule_v2"" ""master_egress_ipv6"" {
  count             = length(var.k8s_allowed_egress_ipv6_ips)
  direction         = ""egress""
  ethertype         = ""IPv6""
  remote_ip_prefix  = var.k8s_allowed_egress_ipv6_ips[count.index]
  security_group_id = openstack_networking_secgroup_v2.k8s_master.id
}

resource ""openstack_networking_secgroup_v2"" ""bastion"" {
  name                 = ""${var.cluster_name}-bastion""
  count                = var.number_of_bastions != """" ? 1 : 0
  description          = ""${var.cluster_name} - Bastion Server""
  delete_default_rules = true
}

resource ""openstack_networking_secgroup_rule_v2"" ""bastion"" {
  count             = var.number_of_bastions != """" ? length(var.bastion_allowed_remote_ips) : 0
  direction         = ""ingress""
  ethertype         = ""IPv4""
  protocol          = ""tcp""
  port_range_min    = ""22""
  port_range_max    = ""22""
  remote_ip_prefix  = var.bastion_allowed_remote_ips[count.index]
  security_group_id = openstack_networking_secgroup_v2.bastion[0].id
}

resource ""openstack_networking_secgroup_rule_v2"" ""k8s_bastion_ports"" {
  count             = length(var.bastion_allowed_ports)
  direction         = ""ingress""
  ethertype         = ""IPv4""
  protocol          = lookup(var.bastion_allowed_ports[count.index], ""protocol"", ""tcp"")
  port_range_min    = lookup(var.bastion_allowed_ports[count.index], ""port_range_min"")
  port_range_max    = lookup(var.bastion_allowed_ports[count.index], ""port_range_max"")
  remote_ip_prefix  = lookup(var.bastion_allowed_ports[count.index], ""remote_ip_prefix"", ""0.0.0.0/0"")
  security_group_id = openstack_networking_secgroup_v2.bastion[0].id
}

resource ""openstack_networking_secgroup_rule_v2"" ""bastion_ipv6_ingress"" {
  count             = var.number_of_bastions != """" ? length(var.bastion_allowed_remote_ipv6_ips) : 0
  direction         = ""ingress""
  ethertype         = ""IPv6""
  protocol          = ""tcp""
  port_range_min    = ""22""
  port_range_max    = ""22""
  remote_ip_prefix  = var.bastion_allowed_remote_ipv6_ips[count.index]
  security_group_id = openstack_networking_secgroup_v2.bastion[0].id
}

resource ""openstack_networking_secgroup_rule_v2"" ""k8s_bastion_ports_ipv6_ingress"" {
  count             = length(var.bastion_allowed_ports_ipv6)
  direction         = ""ingress""
  ethertype         = ""IPv6""
  protocol          = lookup(var.bastion_allowed_ports_ipv6[count.index], ""protocol"", ""tcp"")
  port_range_min    = lookup(var.bastion_allowed_ports_ipv6[count.index], ""port_range_min"")
  port_range_max    = lookup(var.bastion_allowed_ports_ipv6[count.index], ""port_range_max"")
  remote_ip_prefix  = lookup(var.bastion_allowed_ports_ipv6[count.index], ""remote_ip_prefix"", ""::/0"")
  security_group_id = openstack_networking_secgroup_v2.bastion[0].id
}

resource ""openstack_networking_secgroup_v2"" ""k8s"" {
  name                 = ""${var.cluster_name}-k8s""
  description          = ""${var.cluster_name} - Kubernetes""
  delete_default_rules = true
}

resource ""openstack_networking_secgroup_rule_v2"" ""k8s"" {
  direction         = ""ingress""
  ethertype         = ""IPv4""
  remote_group_id   = openstack_networking_secgroup_v2.k8s.id
  security_group_id = openstack_networking_secgroup_v2.k8s.id
}

resource ""openstack_networking_secgroup_rule_v2"" ""k8s_ipv6"" {
  direction         = ""ingress""
  ethertype         = ""IPv6""
  remote_group_id   = openstack_networking_secgroup_v2.k8s.id
  security_group_id = openstack_networking_secgroup_v2.k8s.id
}

resource ""openstack_networking_secgroup_rule_v2"" ""k8s_allowed_remote_ips"" {
  count             = length(var.k8s_allowed_remote_ips)
  direction         = ""ingress""
  ethertype         = ""IPv4""
  protocol          = ""tcp""
  port_range_min    = ""22""
  port_range_max    = ""22""
  remote_ip_prefix  = var.k8s_allowed_remote_ips[count.index]
  security_group_id = openstack_networking_secgroup_v2.k8s.id
}

resource ""openstack_networking_secgroup_rule_v2"" ""k8s_allowed_remote_ips_ipv6"" {
  count             = length(var.k8s_allowed_remote_ips_ipv6)
  direction         = ""ingress""
  ethertype         = ""IPv6""
  protocol          = ""tcp""
  port_range_min    = ""22""
  port_range_max    = ""22""
  remote_ip_prefix  = var.k8s_allowed_remote_ips_ipv6[count.index]
  security_group_id = openstack_networking_secgroup_v2.k8s.id
}

resource ""openstack_networking_secgroup_rule_v2"" ""egress"" {
  count             = length(var.k8s_allowed_egress_ips)
  direction         = ""egress""
  ethertype         = ""IPv4""
  remote_ip_prefix  = var.k8s_allowed_egress_ips[count.index]
  security_group_id = openstack_networking_secgroup_v2.k8s.id
}

resource ""openstack_networking_secgroup_rule_v2"" ""egress_ipv6"" {
  count             = length(var.k8s_allowed_egress_ipv6_ips)
  direction         = ""egress""
  ethertype         = ""IPv6""
  remote_ip_prefix  = var.k8s_allowed_egress_ipv6_ips[count.index]
  security_group_id = openstack_networking_secgroup_v2.k8s.id
}

resource ""openstack_networking_secgroup_v2"" ""worker"" {
  name                 = ""${var.cluster_name}-k8s-worker""
  description          = ""${var.cluster_name} - Kubernetes worker nodes""
  delete_default_rules = true
}

resource ""openstack_networking_secgroup_v2"" ""worker_extra"" {
  count                = ""%{if var.extra_sec_groups}1%{else}0%{endif}""
  name                 = ""${var.cluster_name}-k8s-worker-${var.extra_sec_groups_name}""
  description          = ""${var.cluster_name} - Kubernetes worker nodes - rules not managed by terraform""
  delete_default_rules = true
}

resource ""openstack_networking_secgroup_rule_v2"" ""worker"" {
  count             = length(var.worker_allowed_ports)
  direction         = ""ingress""
  ethertype         = ""IPv4""
  protocol          = lookup(var.worker_allowed_ports[count.index], ""protocol"", ""tcp"")
  port_range_min    = lookup(var.worker_allowed_ports[count.index], ""port_range_min"")
  port_range_max    = lookup(var.worker_allowed_ports[count.index], ""port_range_max"")
  remote_ip_prefix  = lookup(var.worker_allowed_ports[count.index], ""remote_ip_prefix"", ""0.0.0.0/0"")
  security_group_id = openstack_networking_secgroup_v2.worker.id
}

resource ""openstack_networking_secgroup_rule_v2"" ""worker_ipv6_ingress"" {
  count             = length(var.worker_allowed_ports_ipv6)
  direction         = ""ingress""
  ethertype         = ""IPv6""
  protocol          = lookup(var.worker_allowed_ports_ipv6[count.index], ""protocol"", ""tcp"")
  port_range_min    = lookup(var.worker_allowed_ports_ipv6[count.index], ""port_range_min"")
  port_range_max    = lookup(var.worker_allowed_ports_ipv6[count.index], ""port_range_max"")
  remote_ip_prefix  = lookup(var.worker_allowed_ports_ipv6[count.index], ""remote_ip_prefix"", ""::/0"")
  security_group_id = openstack_networking_secgroup_v2.worker.id
}

resource ""openstack_compute_servergroup_v2"" ""k8s_master"" {
  count    = var.master_server_group_policy != """" ? 1 : 0
  name     = ""k8s-master-srvgrp""
  policies = [var.master_server_group_policy]
}

resource ""openstack_compute_servergroup_v2"" ""k8s_node"" {
  count    = var.node_server_group_policy != """" ? 1 : 0
  name     = ""k8s-node-srvgrp""
  policies = [var.node_server_group_policy]
}

resource ""openstack_compute_servergroup_v2"" ""k8s_etcd"" {
  count    = var.etcd_server_group_policy != """" ? 1 : 0
  name     = ""k8s-etcd-srvgrp""
  policies = [var.etcd_server_group_policy]
}

resource ""openstack_compute_servergroup_v2"" ""k8s_node_additional"" {
  for_each = var.additional_server_groups
  name     = ""k8s-${each.key}-srvgrp""
  policies = [each.value.policy]
}

locals {
# master groups
  master_sec_groups = compact([
    openstack_networking_secgroup_v2.k8s_master.id,
    openstack_networking_secgroup_v2.k8s.id,
    var.extra_sec_groups ?openstack_networking_secgroup_v2.k8s_master_extra[0].id : """",
  ])
# worker groups
  worker_sec_groups = compact([
    openstack_networking_secgroup_v2.k8s.id,
    openstack_networking_secgroup_v2.worker.id,
    var.extra_sec_groups ? openstack_networking_secgroup_v2.worker_extra[0].id : """",
  ])
# bastion groups
  bastion_sec_groups = compact(concat([
    openstack_networking_secgroup_v2.k8s.id,
    openstack_networking_secgroup_v2.bastion[0].id,
  ]))
# etcd groups
  etcd_sec_groups = compact([openstack_networking_secgroup_v2.k8s.id])
# glusterfs groups
  gfs_sec_groups = compact([openstack_networking_secgroup_v2.k8s.id])

# Image uuid
  image_to_use_node = var.image_uuid != """" ? var.image_uuid : data.openstack_images_image_v2.vm_image[0].id
# Image_gfs uuid
  image_to_use_gfs = var.image_gfs_uuid != """" ? var.image_gfs_uuid : var.image_uuid != """" ? var.image_uuid : data.openstack_images_image_v2.gfs_image[0].id
# image_master uuidimage_gfs_uuid
  image_to_use_master = var.image_master_uuid != """" ? var.image_master_uuid : var.image_uuid != """" ? var.image_uuid : data.openstack_images_image_v2.image_master[0].id

  k8s_nodes_settings = {
    for name, node in var.k8s_nodes :
      name => {
        ""use_local_disk"" = (node.root_volume_size_in_gb != null ? node.root_volume_size_in_gb : var.node_root_volume_size_in_gb) == 0,
        ""image_id""       = node.image_id != null ? node.image_id : local.image_to_use_node,
        ""volume_size""    = node.root_volume_size_in_gb != null ? node.root_volume_size_in_gb : var.node_root_volume_size_in_gb,
        ""volume_type""    = node.volume_type != null ? node.volume_type : var.node_volume_type,
        ""network_id""     = node.network_id != null ? node.network_id : (var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id)
        ""server_group""   = node.server_group != null ? [openstack_compute_servergroup_v2.k8s_node_additional[node.server_group].id] : (var.node_server_group_policy != """"  ? [openstack_compute_servergroup_v2.k8s_node[0].id] : [])
      }
  }

  k8s_masters_settings = {
    for name, node in var.k8s_masters :
      name => {
        ""use_local_disk"" = (node.root_volume_size_in_gb != null ? node.root_volume_size_in_gb : var.master_root_volume_size_in_gb) == 0,
        ""image_id""       = node.image_id != null ? node.image_id : local.image_to_use_master,
        ""volume_size""    = node.root_volume_size_in_gb != null ? node.root_volume_size_in_gb : var.master_root_volume_size_in_gb,
        ""volume_type""    = node.volume_type != null ? node.volume_type : var.master_volume_type,
        ""network_id""     = node.network_id != null ? node.network_id : (var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id)
      }
  }
}

resource ""openstack_networking_port_v2"" ""bastion_port"" {
  count                 = var.number_of_bastions
  name                  = ""${var.cluster_name}-bastion-${count.index + 1}""
  network_id            = var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.bastion_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""bastion"" {
  name       = ""${var.cluster_name}-bastion-${count.index + 1}""
  count      = var.number_of_bastions
  image_id   = var.bastion_root_volume_size_in_gb == 0 ? local.image_to_use_node : null
  flavor_id  = var.flavor_bastion
  key_pair   = openstack_compute_keypair_v2.k8s.name
  user_data  = data.cloudinit_config.cloudinit.rendered

  dynamic ""block_device"" {
    for_each = var.bastion_root_volume_size_in_gb > 0 ? [local.image_to_use_node] : []
    content {
      uuid                  = local.image_to_use_node
      source_type           = ""image""
      volume_size           = var.bastion_root_volume_size_in_gb
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = element(openstack_networking_port_v2.bastion_port.*.id, count.index)
  }

  metadata = {
    ssh_user         = var.ssh_user
    kubespray_groups = ""bastion""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }

  provisioner ""local-exec"" {
    command = ""sed -e s/USER/${var.ssh_user}/ -e s/BASTION_ADDRESS/${var.bastion_fips[0]}/ ${path.module}/ansible_bastion_template.txt > ${var.group_vars_path}/no_floating.yml""
  }
}

resource ""openstack_networking_port_v2"" ""k8s_master_port"" {
  count                 = var.number_of_k8s_masters
  name                  = ""${var.cluster_name}-k8s-master-${count.index + 1}""
  network_id            = var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.master_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  lifecycle {
    ignore_changes = [ allowed_address_pairs ]
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""k8s_master"" {
  name              = ""${var.cluster_name}-k8s-master-${count.index + 1}""
  count             = var.number_of_k8s_masters
  availability_zone = element(var.az_list, count.index)
  image_id          = var.master_root_volume_size_in_gb == 0 ? local.image_to_use_master : null
  flavor_id         = var.flavor_k8s_master
  key_pair          = openstack_compute_keypair_v2.k8s.name
  user_data         = data.cloudinit_config.cloudinit.rendered


  dynamic ""block_device"" {
    for_each = var.master_root_volume_size_in_gb > 0 ? [local.image_to_use_master] : []
    content {
      uuid                  = local.image_to_use_master
      source_type           = ""image""
      volume_size           = var.master_root_volume_size_in_gb
      volume_type           = var.master_volume_type
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = element(openstack_networking_port_v2.k8s_master_port.*.id, count.index)
  }

  dynamic ""scheduler_hints"" {
    for_each = var.master_server_group_policy != """" ? [openstack_compute_servergroup_v2.k8s_master[0]] : []
    content {
      group = openstack_compute_servergroup_v2.k8s_master[0].id
    }
  }

  metadata = {
    ssh_user         = var.ssh_user
    kubespray_groups = ""etcd,kube_control_plane,${var.supplementary_master_groups},k8s_cluster""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }

  provisioner ""local-exec"" {
    command = ""sed -e s/USER/${var.ssh_user}/ -e s/BASTION_ADDRESS/${element(concat(var.bastion_fips, var.k8s_master_fips), 0)}/ ${path.module}/ansible_bastion_template.txt > ${var.group_vars_path}/no_floating.yml""
  }
}

resource ""openstack_networking_port_v2"" ""k8s_masters_port"" {
  for_each              = var.number_of_k8s_masters == 0 && var.number_of_k8s_masters_no_etcd == 0 && var.number_of_k8s_masters_no_floating_ip == 0 && var.number_of_k8s_masters_no_floating_ip_no_etcd == 0 ? var.k8s_masters : {}
  name                  = ""${var.cluster_name}-k8s-${each.key}""
  network_id            = local.k8s_masters_settings[each.key].network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.master_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  lifecycle {
    ignore_changes = [ allowed_address_pairs ]
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""k8s_masters"" {
  for_each          = var.number_of_k8s_masters == 0 && var.number_of_k8s_masters_no_etcd == 0 && var.number_of_k8s_masters_no_floating_ip == 0 && var.number_of_k8s_masters_no_floating_ip_no_etcd == 0 ? var.k8s_masters : {}
  name              = ""${var.cluster_name}-k8s-${each.key}""
  availability_zone = each.value.az
  image_id          = local.k8s_masters_settings[each.key].use_local_disk ? local.k8s_masters_settings[each.key].image_id : null
  flavor_id         = each.value.flavor
  key_pair          = openstack_compute_keypair_v2.k8s.name

  dynamic ""block_device"" {
    for_each = !local.k8s_masters_settings[each.key].use_local_disk ? [local.k8s_masters_settings[each.key].image_id] : []
    content {
      uuid                  = block_device.value
      source_type           = ""image""
      volume_size           = local.k8s_masters_settings[each.key].volume_size
      volume_type           = local.k8s_masters_settings[each.key].volume_type
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = openstack_networking_port_v2.k8s_masters_port[each.key].id
  }

  dynamic ""scheduler_hints"" {
    for_each = var.master_server_group_policy != """" ? [openstack_compute_servergroup_v2.k8s_master[0]] : []
    content {
      group = openstack_compute_servergroup_v2.k8s_master[0].id
    }
  }

  metadata = {
    ssh_user         = var.ssh_user
    kubespray_groups = ""%{if each.value.etcd == true}etcd,%{endif}kube_control_plane,${var.supplementary_master_groups},k8s_cluster%{if each.value.floating_ip == false},no_floating%{endif}""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }

  provisioner ""local-exec"" {
    command = ""%{if each.value.floating_ip}sed s/USER/${var.ssh_user}/ ${path.module}/ansible_bastion_template.txt | sed s/BASTION_ADDRESS/${element(concat(var.bastion_fips, [for key, value in var.k8s_masters_fips : value.address]), 0)}/ > ${var.group_vars_path}/no_floating.yml%{else}true%{endif}""
  }
}

resource ""openstack_networking_port_v2"" ""k8s_master_no_etcd_port"" {
  count                 = var.number_of_k8s_masters_no_etcd
  name                  = ""${var.cluster_name}-k8s-master-ne-${count.index + 1}""
  network_id            = var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.master_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  lifecycle {
    ignore_changes = [ allowed_address_pairs ]
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""k8s_master_no_etcd"" {
  name              = ""${var.cluster_name}-k8s-master-ne-${count.index + 1}""
  count             = var.number_of_k8s_masters_no_etcd
  availability_zone = element(var.az_list, count.index)
  image_id          = var.master_root_volume_size_in_gb == 0 ? local.image_to_use_master : null
  flavor_id         = var.flavor_k8s_master
  key_pair          = openstack_compute_keypair_v2.k8s.name
  user_data         = data.cloudinit_config.cloudinit.rendered


  dynamic ""block_device"" {
    for_each = var.master_root_volume_size_in_gb > 0 ? [local.image_to_use_master] : []
    content {
      uuid                  = local.image_to_use_master
      source_type           = ""image""
      volume_size           = var.master_root_volume_size_in_gb
      volume_type           = var.master_volume_type
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = element(openstack_networking_port_v2.k8s_master_no_etcd_port.*.id, count.index)
  }

  dynamic ""scheduler_hints"" {
    for_each = var.master_server_group_policy != """" ? [openstack_compute_servergroup_v2.k8s_master[0]] : []
    content {
      group = openstack_compute_servergroup_v2.k8s_master[0].id
    }
  }

  metadata = {
    ssh_user         = var.ssh_user
    kubespray_groups = ""kube_control_plane,${var.supplementary_master_groups},k8s_cluster""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }

  provisioner ""local-exec"" {
    command = ""sed -e s/USER/${var.ssh_user}/ -e s/BASTION_ADDRESS/${element(concat(var.bastion_fips, var.k8s_master_fips), 0)}/ ${path.module}/ansible_bastion_template.txt > ${var.group_vars_path}/no_floating.yml""
  }
}

resource ""openstack_networking_port_v2"" ""etcd_port"" {
  count                 = var.number_of_etcd
  name                  = ""${var.cluster_name}-etcd-${count.index + 1}""
  network_id            = var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.etcd_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""etcd"" {
  name              = ""${var.cluster_name}-etcd-${count.index + 1}""
  count             = var.number_of_etcd
  availability_zone = element(var.az_list, count.index)
  image_id          = var.etcd_root_volume_size_in_gb == 0 ? local.image_to_use_master : null
  flavor_id         = var.flavor_etcd
  key_pair          = openstack_compute_keypair_v2.k8s.name
  user_data         = data.cloudinit_config.cloudinit.rendered

  dynamic ""block_device"" {
    for_each = var.etcd_root_volume_size_in_gb > 0 ? [local.image_to_use_master] : []
    content {
      uuid                  = local.image_to_use_master
      source_type           = ""image""
      volume_size           = var.etcd_root_volume_size_in_gb
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = element(openstack_networking_port_v2.etcd_port.*.id, count.index)
  }

  dynamic ""scheduler_hints"" {
    for_each = var.etcd_server_group_policy != """" ? [openstack_compute_servergroup_v2.k8s_etcd[0]] : []
    content {
      group = openstack_compute_servergroup_v2.k8s_etcd[0].id
    }
  }

  metadata = {
    ssh_user         = var.ssh_user
    kubespray_groups = ""etcd,no_floating""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }
}

resource ""openstack_networking_port_v2"" ""k8s_master_no_floating_ip_port"" {
  count                 = var.number_of_k8s_masters_no_floating_ip
  name                  = ""${var.cluster_name}-k8s-master-nf-${count.index + 1}""
  network_id            = var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.master_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  lifecycle {
    ignore_changes = [ allowed_address_pairs ]
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""k8s_master_no_floating_ip"" {
  name              = ""${var.cluster_name}-k8s-master-nf-${count.index + 1}""
  count             = var.number_of_k8s_masters_no_floating_ip
  availability_zone = element(var.az_list, count.index)
  image_id          = var.master_root_volume_size_in_gb == 0 ? local.image_to_use_master : null
  flavor_id         = var.flavor_k8s_master
  key_pair          = openstack_compute_keypair_v2.k8s.name

  dynamic ""block_device"" {
    for_each = var.master_root_volume_size_in_gb > 0 ? [local.image_to_use_master] : []
    content {
      uuid                  = local.image_to_use_master
      source_type           = ""image""
      volume_size           = var.master_root_volume_size_in_gb
      volume_type           = var.master_volume_type
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = element(openstack_networking_port_v2.k8s_master_no_floating_ip_port.*.id, count.index)
  }

  dynamic ""scheduler_hints"" {
    for_each = var.master_server_group_policy != """" ? [openstack_compute_servergroup_v2.k8s_master[0]] : []
    content {
      group = openstack_compute_servergroup_v2.k8s_master[0].id
    }
  }

  metadata = {
    ssh_user         = var.ssh_user
    kubespray_groups = ""etcd,kube_control_plane,${var.supplementary_master_groups},k8s_cluster,no_floating""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }
}

resource ""openstack_networking_port_v2"" ""k8s_master_no_floating_ip_no_etcd_port"" {
  count                 = var.number_of_k8s_masters_no_floating_ip_no_etcd
  name                  = ""${var.cluster_name}-k8s-master-ne-nf-${count.index + 1}""
  network_id            = var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.master_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  lifecycle {
    ignore_changes = [ allowed_address_pairs ]
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""k8s_master_no_floating_ip_no_etcd"" {
  name              = ""${var.cluster_name}-k8s-master-ne-nf-${count.index + 1}""
  count             = var.number_of_k8s_masters_no_floating_ip_no_etcd
  availability_zone = element(var.az_list, count.index)
  image_id          = var.master_root_volume_size_in_gb == 0 ? local.image_to_use_master : null
  flavor_id         = var.flavor_k8s_master
  key_pair          = openstack_compute_keypair_v2.k8s.name
  user_data         = data.cloudinit_config.cloudinit.rendered

  dynamic ""block_device"" {
    for_each = var.master_root_volume_size_in_gb > 0 ? [local.image_to_use_master] : []
    content {
      uuid                  = local.image_to_use_master
      source_type           = ""image""
      volume_size           = var.master_root_volume_size_in_gb
      volume_type           = var.master_volume_type
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = element(openstack_networking_port_v2.k8s_master_no_floating_ip_no_etcd_port.*.id, count.index)
  }

  dynamic ""scheduler_hints"" {
    for_each = var.master_server_group_policy != """" ? [openstack_compute_servergroup_v2.k8s_master[0]] : []
    content {
      group = openstack_compute_servergroup_v2.k8s_master[0].id
    }
  }

  metadata = {
    ssh_user         = var.ssh_user
    kubespray_groups = ""kube_control_plane,${var.supplementary_master_groups},k8s_cluster,no_floating""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }
}

resource ""openstack_networking_port_v2"" ""k8s_node_port"" {
  count                 = var.number_of_k8s_nodes
  name                  = ""${var.cluster_name}-k8s-node-${count.index + 1}""
  network_id            = var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.worker_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  lifecycle {
    ignore_changes = [ allowed_address_pairs ]
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""k8s_node"" {
  name              = ""${var.cluster_name}-k8s-node-${count.index + 1}""
  count             = var.number_of_k8s_nodes
  availability_zone = element(var.az_list_node, count.index)
  image_id          = var.node_root_volume_size_in_gb == 0 ? local.image_to_use_node : null
  flavor_id         = var.flavor_k8s_node
  key_pair          = openstack_compute_keypair_v2.k8s.name
  user_data         = data.cloudinit_config.cloudinit.rendered

  dynamic ""block_device"" {
    for_each = var.node_root_volume_size_in_gb > 0 ? [local.image_to_use_node] : []
    content {
      uuid                  = local.image_to_use_node
      source_type           = ""image""
      volume_size           = var.node_root_volume_size_in_gb
      volume_type           = var.node_volume_type
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = element(openstack_networking_port_v2.k8s_node_port.*.id, count.index)
  }


  dynamic ""scheduler_hints"" {
    for_each = var.node_server_group_policy != """" ? [openstack_compute_servergroup_v2.k8s_node[0]] : []
    content {
      group = openstack_compute_servergroup_v2.k8s_node[0].id
    }
  }

  metadata = {
    ssh_user         = var.ssh_user
    kubespray_groups = ""kube_node,k8s_cluster,${var.supplementary_node_groups}""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }

  provisioner ""local-exec"" {
    command = ""sed -e s/USER/${var.ssh_user}/ -e s/BASTION_ADDRESS/${element(concat(var.bastion_fips, var.k8s_node_fips), 0)}/ ${path.module}/ansible_bastion_template.txt > ${var.group_vars_path}/no_floating.yml""
  }
}

resource ""openstack_networking_port_v2"" ""k8s_node_no_floating_ip_port"" {
  count                 = var.number_of_k8s_nodes_no_floating_ip
  name                  = ""${var.cluster_name}-k8s-node-nf-${count.index + 1}""
  network_id            = var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.worker_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  lifecycle {
    ignore_changes = [ allowed_address_pairs ]
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""k8s_node_no_floating_ip"" {
  name              = ""${var.cluster_name}-k8s-node-nf-${count.index + 1}""
  count             = var.number_of_k8s_nodes_no_floating_ip
  availability_zone = element(var.az_list_node, count.index)
  image_id          = var.node_root_volume_size_in_gb == 0 ? local.image_to_use_node : null
  flavor_id         = var.flavor_k8s_node
  key_pair          = openstack_compute_keypair_v2.k8s.name
  user_data         = data.cloudinit_config.cloudinit.rendered

  dynamic ""block_device"" {
    for_each = var.node_root_volume_size_in_gb > 0 ? [local.image_to_use_node] : []
    content {
      uuid                  = local.image_to_use_node
      source_type           = ""image""
      volume_size           = var.node_root_volume_size_in_gb
      volume_type           = var.node_volume_type
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = element(openstack_networking_port_v2.k8s_node_no_floating_ip_port.*.id, count.index)
  }

  dynamic ""scheduler_hints"" {
    for_each = var.node_server_group_policy != """" ? [openstack_compute_servergroup_v2.k8s_node[0].id] : []
    content {
      group = scheduler_hints.value
    }
  }

  metadata = {
    ssh_user         = var.ssh_user
    kubespray_groups = ""kube_node,k8s_cluster,no_floating,${var.supplementary_node_groups}""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }
}

resource ""openstack_networking_port_v2"" ""k8s_nodes_port"" {
  for_each              = var.number_of_k8s_nodes == 0 && var.number_of_k8s_nodes_no_floating_ip == 0 ? var.k8s_nodes : {}
  name                  = ""${var.cluster_name}-k8s-node-${each.key}""
  network_id            = local.k8s_nodes_settings[each.key].network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.worker_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  lifecycle {
    ignore_changes = [ allowed_address_pairs ]
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""k8s_nodes"" {
  for_each          = var.number_of_k8s_nodes == 0 && var.number_of_k8s_nodes_no_floating_ip == 0 ? var.k8s_nodes : {}
  name              = ""${var.cluster_name}-k8s-node-${each.key}""
  availability_zone = each.value.az
  image_id          = local.k8s_nodes_settings[each.key].use_local_disk ? local.k8s_nodes_settings[each.key].image_id : null
  flavor_id         = each.value.flavor
  key_pair          = openstack_compute_keypair_v2.k8s.name
  user_data         = each.value.cloudinit != null ? templatefile(""${path.module}/templates/cloudinit.yaml.tmpl"", {
    extra_partitions = each.value.cloudinit.extra_partitions,
    netplan_critical_dhcp_interface = each.value.cloudinit.netplan_critical_dhcp_interface,
  }) : data.cloudinit_config.cloudinit.rendered

  dynamic ""block_device"" {
    for_each = !local.k8s_nodes_settings[each.key].use_local_disk ? [local.k8s_nodes_settings[each.key].image_id] : []
    content {
      uuid                  = block_device.value
      source_type           = ""image""
      volume_size           = local.k8s_nodes_settings[each.key].volume_size
      volume_type           = local.k8s_nodes_settings[each.key].volume_type
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = openstack_networking_port_v2.k8s_nodes_port[each.key].id
  }

  dynamic ""scheduler_hints"" {
    for_each = local.k8s_nodes_settings[each.key].server_group
    content {
      group = scheduler_hints.value
    }
  }

  metadata = {
    ssh_user         = var.ssh_user
    kubespray_groups = ""kube_node,k8s_cluster,%{if !each.value.floating_ip}no_floating,%{endif}${var.supplementary_node_groups}${each.value.extra_groups != null ? "",${each.value.extra_groups}"" : """"}""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }

  provisioner ""local-exec"" {
    command = ""%{if each.value.floating_ip}sed -e s/USER/${var.ssh_user}/ -e s/BASTION_ADDRESS/${element(concat(var.bastion_fips, [for key, value in var.k8s_nodes_fips : value.address]), 0)}/ ${path.module}/ansible_bastion_template.txt > ${var.group_vars_path}/no_floating.yml%{else}true%{endif}""
  }
}

resource ""openstack_networking_port_v2"" ""glusterfs_node_no_floating_ip_port"" {
  count                 = var.number_of_gfs_nodes_no_floating_ip
  name                  = ""${var.cluster_name}-gfs-node-nf-${count.index + 1}""
  network_id            = var.use_existing_network ? data.openstack_networking_network_v2.k8s_network[0].id : var.network_id
  admin_state_up        = ""true""
  port_security_enabled = var.force_null_port_security ? null : var.port_security_enabled
  security_group_ids    = var.port_security_enabled ? local.gfs_sec_groups : null
  no_security_groups    = var.port_security_enabled ? null : false
  dynamic ""fixed_ip"" {
    for_each = var.private_subnet_id == """" ? [] : [true]
    content {
      subnet_id = var.private_subnet_id
    }
  }

  depends_on = [
    var.network_router_id
  ]
}

resource ""openstack_compute_instance_v2"" ""glusterfs_node_no_floating_ip"" {
  name              = ""${var.cluster_name}-gfs-node-nf-${count.index + 1}""
  count             = var.number_of_gfs_nodes_no_floating_ip
  availability_zone = element(var.az_list, count.index)
  image_name        = var.gfs_root_volume_size_in_gb == 0 ? local.image_to_use_gfs : null
  flavor_id         = var.flavor_gfs_node
  key_pair          = openstack_compute_keypair_v2.k8s.name

  dynamic ""block_device"" {
    for_each = var.gfs_root_volume_size_in_gb > 0 ? [local.image_to_use_gfs] : []
    content {
      uuid                  = local.image_to_use_gfs
      source_type           = ""image""
      volume_size           = var.gfs_root_volume_size_in_gb
      boot_index            = 0
      destination_type      = ""volume""
      delete_on_termination = true
    }
  }

  network {
    port = element(openstack_networking_port_v2.glusterfs_node_no_floating_ip_port.*.id, count.index)
  }

  dynamic ""scheduler_hints"" {
    for_each = var.node_server_group_policy != """" ? [openstack_compute_servergroup_v2.k8s_node[0]] : []
    content {
      group = openstack_compute_servergroup_v2.k8s_node[0].id
    }
  }

  metadata = {
    ssh_user         = var.ssh_user_gfs
    kubespray_groups = ""gfs-cluster,network-storage,no_floating""
    depends_on       = var.network_router_id
    use_access_ip    = var.use_access_ip
  }
}

resource ""openstack_networking_floatingip_associate_v2"" ""bastion"" {
  count                 = var.number_of_bastions
  floating_ip           = var.bastion_fips[count.index]
  port_id               = element(openstack_networking_port_v2.bastion_port.*.id, count.index)
}


resource ""openstack_networking_floatingip_associate_v2"" ""k8s_master"" {
  count                 = var.number_of_k8s_masters
  floating_ip           = var.k8s_master_fips[count.index]
  port_id               = element(openstack_networking_port_v2.k8s_master_port.*.id, count.index)
}

resource ""openstack_networking_floatingip_associate_v2"" ""k8s_masters"" {
  for_each              = var.number_of_k8s_masters == 0 && var.number_of_k8s_masters_no_etcd == 0 && var.number_of_k8s_masters_no_floating_ip == 0 && var.number_of_k8s_masters_no_floating_ip_no_etcd == 0 ? { for key, value in var.k8s_masters : key => value if value.floating_ip } : {}
  floating_ip           = var.k8s_masters_fips[each.key].address
  port_id               = openstack_networking_port_v2.k8s_masters_port[each.key].id
}

resource ""openstack_networking_floatingip_associate_v2"" ""k8s_master_no_etcd"" {
  count                 = var.master_root_volume_size_in_gb == 0 ? var.number_of_k8s_masters_no_etcd : 0
  floating_ip           = var.k8s_master_no_etcd_fips[count.index]
  port_id               = element(openstack_networking_port_v2.k8s_master_no_etcd_port.*.id, count.index)
}

resource ""openstack_networking_floatingip_associate_v2"" ""k8s_node"" {
  count                 = var.node_root_volume_size_in_gb == 0 ? var.number_of_k8s_nodes : 0
  floating_ip           = var.k8s_node_fips[count.index]
  port_id               = element(openstack_networking_port_v2.k8s_node_port.*.id, count.index)
}

resource ""openstack_networking_floatingip_associate_v2"" ""k8s_nodes"" {
  for_each              = var.number_of_k8s_nodes == 0 && var.number_of_k8s_nodes_no_floating_ip == 0 ? { for key, value in var.k8s_nodes : key => value if value.floating_ip } : {}
  floating_ip           = var.k8s_nodes_fips[each.key].address
  port_id               = openstack_networking_port_v2.k8s_nodes_port[each.key].id
}

resource ""openstack_blockstorage_volume_v2"" ""glusterfs_volume"" {
  name        = ""${var.cluster_name}-glusterfs_volume-${count.index + 1}""
  count       = var.gfs_root_volume_size_in_gb == 0 ? var.number_of_gfs_nodes_no_floating_ip : 0
  description = ""Non-ephemeral volume for GlusterFS""
  size        = var.gfs_volume_size_in_gb
}

resource ""openstack_compute_volume_attach_v2"" ""glusterfs_volume"" {
  count       = var.gfs_root_volume_size_in_gb == 0 ? var.number_of_gfs_nodes_no_floating_ip : 0
  instance_id = element(openstack_compute_instance_v2.glusterfs_node_no_floating_ip.*.id, count.index)
  volume_id   = element(openstack_blockstorage_volume_v2.glusterfs_volume.*.id, count.index)
}
"
kubernetes-sigs__kubespray,b9e1e8577fade952f72281fc3b9fd16d7c0f994a,clones/kubernetes-sigs__kubespray/contrib/terraform/aws/modules/vpc,d872ba25bd473a5475b3fc7e19f36ac94ffb325a,error,Unsupported argument,"An argument named ""vpc"" is not expected here.",clones/kubernetes-sigs__kubespray/contrib/terraform/aws/modules/vpc/main.tf,15,3,15,6,resource,aws_eip cluster-nat-eip,"resource ""aws_eip"" ""cluster-nat-eip"" {
  count = length(var.aws_cidr_subnets_public)
  vpc   = true
}",13,16,resource aws_eip cluster-nat-eip,0,1,4.45,16,4,4,0,1,2,aws,6.26.0,"{""attributes"": {""address"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""allocation_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""arn"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""associate_with_private_ip"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""association_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""carrier_ip"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""customer_owned_ip"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""customer_owned_ipv4_pool"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""domain"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""instance"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""ipam_pool_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""network_border_group"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""network_interface"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""private_dns"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""private_ip"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""ptr_record"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""public_dns"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""public_ip"": {""type"": ""string"", ""description_kind"": ""plain"", ""computed"": true}, ""public_ipv4_pool"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""region"": {""type"": ""string"", ""description"": ""Region where this resource will be [managed](https://docs.aws.amazon.com/general/latest/gr/rande.html#regional-endpoints). Defaults to the Region set in the [provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#aws-configuration-reference)."", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""tags"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""tags_all"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""read"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}}, ""matched_block_name"": ""aws_eip"", ""matched_block_type"": ""resource""}",aws_eip,resource,"resource ""aws_vpc"" ""cluster-vpc"" {
  cidr_block = var.aws_vpc_cidr_block

  #DNS Related Entries
  enable_dns_support   = true
  enable_dns_hostnames = true

  tags = merge(var.default_tags, tomap({
    Name = ""kubernetes-${var.aws_cluster_name}-vpc""
  }))
}

resource ""aws_eip"" ""cluster-nat-eip"" {
  count = length(var.aws_cidr_subnets_public)
  vpc   = true
}

resource ""aws_internet_gateway"" ""cluster-vpc-internetgw"" {
  vpc_id = aws_vpc.cluster-vpc.id

  tags = merge(var.default_tags, tomap({
    Name = ""kubernetes-${var.aws_cluster_name}-internetgw""
  }))
}

resource ""aws_subnet"" ""cluster-vpc-subnets-public"" {
  vpc_id            = aws_vpc.cluster-vpc.id
  count             = length(var.aws_cidr_subnets_public)
  availability_zone = element(var.aws_avail_zones, count.index % length(var.aws_avail_zones))
  cidr_block        = element(var.aws_cidr_subnets_public, count.index)

  tags = merge(var.default_tags, tomap({
    Name = ""kubernetes-${var.aws_cluster_name}-${element(var.aws_avail_zones, count.index)}-public""
    ""kubernetes.io/cluster/${var.aws_cluster_name}"" = ""shared""
    ""kubernetes.io/role/elb"" = ""1""
  }))
}

resource ""aws_nat_gateway"" ""cluster-nat-gateway"" {
  count         = length(var.aws_cidr_subnets_public)
  allocation_id = element(aws_eip.cluster-nat-eip.*.id, count.index)
  subnet_id     = element(aws_subnet.cluster-vpc-subnets-public.*.id, count.index)
}

resource ""aws_subnet"" ""cluster-vpc-subnets-private"" {
  vpc_id            = aws_vpc.cluster-vpc.id
  count             = length(var.aws_cidr_subnets_private)
  availability_zone = element(var.aws_avail_zones, count.index % length(var.aws_avail_zones))
  cidr_block        = element(var.aws_cidr_subnets_private, count.index)

  tags = merge(var.default_tags, tomap({
    Name = ""kubernetes-${var.aws_cluster_name}-${element(var.aws_avail_zones, count.index)}-private""
    ""kubernetes.io/cluster/${var.aws_cluster_name}"" = ""shared""
    ""kubernetes.io/role/internal-elb"" = ""1""
  }))
}

#Routing in VPC

#TODO: Do we need two routing tables for each subnet for redundancy or is one enough?

resource ""aws_route_table"" ""kubernetes-public"" {
  vpc_id = aws_vpc.cluster-vpc.id

  route {
    cidr_block = ""0.0.0.0/0""
    gateway_id = aws_internet_gateway.cluster-vpc-internetgw.id
  }

  tags = merge(var.default_tags, tomap({
    Name = ""kubernetes-${var.aws_cluster_name}-routetable-public""
  }))
}

resource ""aws_route_table"" ""kubernetes-private"" {
  count  = length(var.aws_cidr_subnets_private)
  vpc_id = aws_vpc.cluster-vpc.id

  route {
    cidr_block     = ""0.0.0.0/0""
    nat_gateway_id = element(aws_nat_gateway.cluster-nat-gateway.*.id, count.index)
  }

  tags = merge(var.default_tags, tomap({
    Name = ""kubernetes-${var.aws_cluster_name}-routetable-private-${count.index}""
  }))
}

resource ""aws_route_table_association"" ""kubernetes-public"" {
  count          = length(var.aws_cidr_subnets_public)
  subnet_id      = element(aws_subnet.cluster-vpc-subnets-public.*.id, count.index)
  route_table_id = aws_route_table.kubernetes-public.id
}

resource ""aws_route_table_association"" ""kubernetes-private"" {
  count          = length(var.aws_cidr_subnets_private)
  subnet_id      = element(aws_subnet.cluster-vpc-subnets-private.*.id, count.index)
  route_table_id = element(aws_route_table.kubernetes-private.*.id, count.index)
}

#Kubernetes Security Groups

resource ""aws_security_group"" ""kubernetes"" {
  name   = ""kubernetes-${var.aws_cluster_name}-securitygroup""
  vpc_id = aws_vpc.cluster-vpc.id

  tags = merge(var.default_tags, tomap({
    Name = ""kubernetes-${var.aws_cluster_name}-securitygroup""
  }))
}

resource ""aws_security_group_rule"" ""allow-all-ingress"" {
  type              = ""ingress""
  from_port         = 0
  to_port           = 65535
  protocol          = ""-1""
  cidr_blocks       = [var.aws_vpc_cidr_block]
  security_group_id = aws_security_group.kubernetes.id
}

resource ""aws_security_group_rule"" ""allow-all-egress"" {
  type              = ""egress""
  from_port         = 0
  to_port           = 65535
  protocol          = ""-1""
  cidr_blocks       = [""0.0.0.0/0""]
  security_group_id = aws_security_group.kubernetes.id
}

resource ""aws_security_group_rule"" ""allow-ssh-connections"" {
  type              = ""ingress""
  from_port         = 22
  to_port           = 22
  protocol          = ""TCP""
  cidr_blocks       = [""0.0.0.0/0""]
  security_group_id = aws_security_group.kubernetes.id
}
"
kubernetes-sigs__kubespray,b9e1e8577fade952f72281fc3b9fd16d7c0f994a,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack,31d36dc40b670d31af58316aa5f06980ac38d2db,warning,Deprecated Resource,Support for neutron-lbaas will be removed. Make sure to use Octavia,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack/modules/loadbalancer/main.tf,25,47,25,48,resource,openstack_lb_member_v2 lb_member,"resource ""openstack_lb_member_v2"" ""lb_member"" {
  count             = var.k8s_master_loadbalancer_enabled ? length(var.k8s_master_ips) : 0
  name              = var.k8s_master_ips[count.index].name
  pool_id           = openstack_lb_pool_v2.api_pool[0].id
  address           = var.k8s_master_ips[count.index].access_ip_v4
  protocol_port     = var.k8s_master_loadbalancer_server_port
  depends_on        = [ openstack_lb_pool_v2.api_pool ]
}",25,32,resource openstack_lb_member_v2 lb_member,0,2,4.56,65,8,8,0,12,6,openstack,1.54.1,"{""attributes"": {""address"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""admin_state_up"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""backup"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""monitor_address"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""monitor_port"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true}, ""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""pool_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""protocol_port"": {""type"": ""number"", ""description_kind"": ""plain"", ""required"": true}, ""region"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""subnet_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""tenant_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""weight"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""create"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}}, ""matched_block_name"": ""openstack_lb_member_v2"", ""matched_block_type"": ""resource""}",openstack_lb_member_v2,resource,"resource ""openstack_lb_loadbalancer_v2"" ""k8s_lb"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""${var.cluster_name}-api-loadbalancer""
  vip_subnet_id     = var.subnet_id
}

resource ""openstack_lb_listener_v2"" ""api_listener""{
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-listener""
  protocol          = ""TCP""
  protocol_port     = var.k8s_master_loadbalancer_listener_port
  loadbalancer_id   = openstack_lb_loadbalancer_v2.k8s_lb[0].id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}

resource ""openstack_lb_pool_v2"" ""api_pool"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-pool""
  protocol          = ""TCP""
  lb_method         = ""ROUND_ROBIN""
  listener_id       = openstack_lb_listener_v2.api_listener[0].id
  depends_on        = [ openstack_lb_listener_v2.api_listener ]
}

resource ""openstack_lb_member_v2"" ""lb_member"" {
  count             = var.k8s_master_loadbalancer_enabled ? length(var.k8s_master_ips) : 0
  name              = var.k8s_master_ips[count.index].name
  pool_id           = openstack_lb_pool_v2.api_pool[0].id
  address           = var.k8s_master_ips[count.index].access_ip_v4
  protocol_port     = var.k8s_master_loadbalancer_server_port
  depends_on        = [ openstack_lb_pool_v2.api_pool ]
}

resource ""openstack_lb_monitor_v2"" ""monitor"" {
  count       = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name        = ""Api Monitor""
  pool_id     = openstack_lb_pool_v2.api_pool[0].id
  type        = ""TCP""
  delay       = 10
  timeout     = 5
  max_retries = 5
}

resource ""openstack_networking_floatingip_v2"" ""floatip_1"" {
  count = var.k8s_master_loadbalancer_enabled && var.k8s_master_loadbalancer_public_ip == """" ? 1 : 0
  pool = var.floatingip_pool
}

resource ""openstack_networking_floatingip_associate_v2"" ""public_ip"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  floating_ip       = var.k8s_master_loadbalancer_public_ip != """" ? var.k8s_master_loadbalancer_public_ip : openstack_networking_floatingip_v2.floatip_1[0].address
  port_id           = openstack_lb_loadbalancer_v2.k8s_lb[0].vip_port_id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}
"
kubernetes-sigs__kubespray,b9e1e8577fade952f72281fc3b9fd16d7c0f994a,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack,5891daa5ade32d72fd65e30ecabed6b7dd80bdde,warning,Deprecated Resource,Support for neutron-lbaas will be removed. Make sure to use Octavia,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack/modules/loadbalancer/main.tf,7,51,7,52,resource,openstack_lb_listener_v2 api_listener,"resource ""openstack_lb_listener_v2"" ""api_listener""{
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-listener""
  protocol          = ""TCP""
  protocol_port     = var.k8s_master_loadbalancer_listener_port
  loadbalancer_id   = openstack_lb_loadbalancer_v2.k8s_lb[0].id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}",7,14,resource openstack_lb_listener_v2 api_listener,0,2,4.5,42,8,8,0,5,6,openstack,1.54.1,"{""attributes"": {""admin_state_up"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""allowed_cidrs"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""connection_limit"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""default_pool_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""default_tls_container_ref"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""description"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""insert_headers"": {""type"": [""map"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""loadbalancer_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""protocol"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""protocol_port"": {""type"": ""number"", ""description_kind"": ""plain"", ""required"": true}, ""region"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""sni_container_refs"": {""type"": [""list"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""tags"": {""type"": [""set"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""tenant_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeout_client_data"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeout_member_connect"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeout_member_data"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeout_tcp_inspect"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""create"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}}, ""matched_block_name"": ""openstack_lb_listener_v2"", ""matched_block_type"": ""resource""}",openstack_lb_listener_v2,resource,"resource ""openstack_lb_loadbalancer_v2"" ""k8s_lb"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""${var.cluster_name}-api-loadbalancer""
  vip_subnet_id     = var.subnet_id
}

resource ""openstack_lb_listener_v2"" ""api_listener""{
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-listener""
  protocol          = ""TCP""
  protocol_port     = var.k8s_master_loadbalancer_listener_port
  loadbalancer_id   = openstack_lb_loadbalancer_v2.k8s_lb[0].id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}

resource ""openstack_lb_pool_v2"" ""api_pool"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-pool""
  protocol          = ""TCP""
  lb_method         = ""ROUND_ROBIN""
  listener_id       = openstack_lb_listener_v2.api_listener[0].id
  depends_on        = [ openstack_lb_listener_v2.api_listener ]
}

resource ""openstack_lb_member_v2"" ""lb_member"" {
  count             = var.k8s_master_loadbalancer_enabled ? length(var.k8s_master_ips) : 0
  name              = var.k8s_master_ips[count.index].name
  pool_id           = openstack_lb_pool_v2.api_pool[0].id
  address           = var.k8s_master_ips[count.index].access_ip_v4
  protocol_port     = var.k8s_master_loadbalancer_server_port
  depends_on        = [ openstack_lb_pool_v2.api_pool ]
}

resource ""openstack_lb_monitor_v2"" ""monitor"" {
  count       = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name        = ""Api Monitor""
  pool_id     = openstack_lb_pool_v2.api_pool[0].id
  type        = ""TCP""
  delay       = 10
  timeout     = 5
  max_retries = 5
}

resource ""openstack_networking_floatingip_v2"" ""floatip_1"" {
  count = var.k8s_master_loadbalancer_enabled && var.k8s_master_loadbalancer_public_ip == """" ? 1 : 0
  pool = var.floatingip_pool
}

resource ""openstack_networking_floatingip_associate_v2"" ""public_ip"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  floating_ip       = var.k8s_master_loadbalancer_public_ip != """" ? var.k8s_master_loadbalancer_public_ip : openstack_networking_floatingip_v2.floatip_1[0].address
  port_id           = openstack_lb_loadbalancer_v2.k8s_lb[0].vip_port_id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}
"
kubernetes-sigs__kubespray,b9e1e8577fade952f72281fc3b9fd16d7c0f994a,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack,99efbfe17f44507a45cc7238b25b3b11ccf56550,warning,Deprecated Resource,Support for neutron-lbaas will be removed. Make sure to use Octavia,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack/modules/loadbalancer/main.tf,34,46,34,47,resource,openstack_lb_monitor_v2 monitor,"resource ""openstack_lb_monitor_v2"" ""monitor"" {
  count       = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name        = ""Api Monitor""
  pool_id     = openstack_lb_pool_v2.api_pool[0].id
  type        = ""TCP""
  delay       = 10
  timeout     = 5
  max_retries = 5
}",34,42,resource openstack_lb_monitor_v2 monitor,0,2,4.74,39,9,9,0,3,7,openstack,1.54.1,"{""attributes"": {""admin_state_up"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""delay"": {""type"": ""number"", ""description_kind"": ""plain"", ""required"": true}, ""expected_codes"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""http_method"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""max_retries"": {""type"": ""number"", ""description_kind"": ""plain"", ""required"": true}, ""max_retries_down"": {""type"": ""number"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""pool_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""region"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""tenant_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""timeout"": {""type"": ""number"", ""description_kind"": ""plain"", ""required"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""url_path"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""create"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}}, ""matched_block_name"": ""openstack_lb_monitor_v2"", ""matched_block_type"": ""resource""}",openstack_lb_monitor_v2,resource,"resource ""openstack_lb_loadbalancer_v2"" ""k8s_lb"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""${var.cluster_name}-api-loadbalancer""
  vip_subnet_id     = var.subnet_id
}

resource ""openstack_lb_listener_v2"" ""api_listener""{
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-listener""
  protocol          = ""TCP""
  protocol_port     = var.k8s_master_loadbalancer_listener_port
  loadbalancer_id   = openstack_lb_loadbalancer_v2.k8s_lb[0].id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}

resource ""openstack_lb_pool_v2"" ""api_pool"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-pool""
  protocol          = ""TCP""
  lb_method         = ""ROUND_ROBIN""
  listener_id       = openstack_lb_listener_v2.api_listener[0].id
  depends_on        = [ openstack_lb_listener_v2.api_listener ]
}

resource ""openstack_lb_member_v2"" ""lb_member"" {
  count             = var.k8s_master_loadbalancer_enabled ? length(var.k8s_master_ips) : 0
  name              = var.k8s_master_ips[count.index].name
  pool_id           = openstack_lb_pool_v2.api_pool[0].id
  address           = var.k8s_master_ips[count.index].access_ip_v4
  protocol_port     = var.k8s_master_loadbalancer_server_port
  depends_on        = [ openstack_lb_pool_v2.api_pool ]
}

resource ""openstack_lb_monitor_v2"" ""monitor"" {
  count       = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name        = ""Api Monitor""
  pool_id     = openstack_lb_pool_v2.api_pool[0].id
  type        = ""TCP""
  delay       = 10
  timeout     = 5
  max_retries = 5
}

resource ""openstack_networking_floatingip_v2"" ""floatip_1"" {
  count = var.k8s_master_loadbalancer_enabled && var.k8s_master_loadbalancer_public_ip == """" ? 1 : 0
  pool = var.floatingip_pool
}

resource ""openstack_networking_floatingip_associate_v2"" ""public_ip"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  floating_ip       = var.k8s_master_loadbalancer_public_ip != """" ? var.k8s_master_loadbalancer_public_ip : openstack_networking_floatingip_v2.floatip_1[0].address
  port_id           = openstack_lb_loadbalancer_v2.k8s_lb[0].vip_port_id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}
"
kubernetes-sigs__kubespray,b9e1e8577fade952f72281fc3b9fd16d7c0f994a,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack,059f93fd850b7810aa9a34fe2326e741129e587c,warning,Deprecated Resource,Support for neutron-lbaas will be removed. Make sure to use Octavia,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack/modules/loadbalancer/main.tf,16,44,16,45,resource,openstack_lb_pool_v2 api_pool,"resource ""openstack_lb_pool_v2"" ""api_pool"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-pool""
  protocol          = ""TCP""
  lb_method         = ""ROUND_ROBIN""
  listener_id       = openstack_lb_listener_v2.api_listener[0].id
  depends_on        = [ openstack_lb_listener_v2.api_listener ]
}",16,23,resource openstack_lb_pool_v2 api_pool,0,2,4.73,40,8,8,0,4,6,openstack,1.54.1,"{""attributes"": {""admin_state_up"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""description"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""lb_method"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""listener_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""loadbalancer_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""protocol"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}, ""region"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""tenant_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""persistence"": {""nesting_mode"": ""list"", ""block"": {""attributes"": {""cookie_name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""type"": {""type"": ""string"", ""description_kind"": ""plain"", ""required"": true}}, ""description_kind"": ""plain""}, ""max_items"": 1}, ""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""create"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}}, ""matched_block_name"": ""openstack_lb_pool_v2"", ""matched_block_type"": ""resource""}",openstack_lb_pool_v2,resource,"resource ""openstack_lb_loadbalancer_v2"" ""k8s_lb"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""${var.cluster_name}-api-loadbalancer""
  vip_subnet_id     = var.subnet_id
}

resource ""openstack_lb_listener_v2"" ""api_listener""{
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-listener""
  protocol          = ""TCP""
  protocol_port     = var.k8s_master_loadbalancer_listener_port
  loadbalancer_id   = openstack_lb_loadbalancer_v2.k8s_lb[0].id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}

resource ""openstack_lb_pool_v2"" ""api_pool"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-pool""
  protocol          = ""TCP""
  lb_method         = ""ROUND_ROBIN""
  listener_id       = openstack_lb_listener_v2.api_listener[0].id
  depends_on        = [ openstack_lb_listener_v2.api_listener ]
}

resource ""openstack_lb_member_v2"" ""lb_member"" {
  count             = var.k8s_master_loadbalancer_enabled ? length(var.k8s_master_ips) : 0
  name              = var.k8s_master_ips[count.index].name
  pool_id           = openstack_lb_pool_v2.api_pool[0].id
  address           = var.k8s_master_ips[count.index].access_ip_v4
  protocol_port     = var.k8s_master_loadbalancer_server_port
  depends_on        = [ openstack_lb_pool_v2.api_pool ]
}

resource ""openstack_lb_monitor_v2"" ""monitor"" {
  count       = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name        = ""Api Monitor""
  pool_id     = openstack_lb_pool_v2.api_pool[0].id
  type        = ""TCP""
  delay       = 10
  timeout     = 5
  max_retries = 5
}

resource ""openstack_networking_floatingip_v2"" ""floatip_1"" {
  count = var.k8s_master_loadbalancer_enabled && var.k8s_master_loadbalancer_public_ip == """" ? 1 : 0
  pool = var.floatingip_pool
}

resource ""openstack_networking_floatingip_associate_v2"" ""public_ip"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  floating_ip       = var.k8s_master_loadbalancer_public_ip != """" ? var.k8s_master_loadbalancer_public_ip : openstack_networking_floatingip_v2.floatip_1[0].address
  port_id           = openstack_lb_loadbalancer_v2.k8s_lb[0].vip_port_id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}
"
kubernetes-sigs__kubespray,b9e1e8577fade952f72281fc3b9fd16d7c0f994a,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack,eca38bac2787aa24e661c188bcd5a405ab6938f0,warning,Deprecated Resource,Support for neutron-lbaas will be removed. Make sure to use Octavia,clones/kubernetes-sigs__kubespray/contrib/terraform/openstack/modules/loadbalancer/main.tf,1,50,1,51,resource,openstack_lb_loadbalancer_v2 k8s_lb,"resource ""openstack_lb_loadbalancer_v2"" ""k8s_lb"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""${var.cluster_name}-api-loadbalancer""
  vip_subnet_id     = var.subnet_id
}",1,5,resource openstack_lb_loadbalancer_v2 k8s_lb,0,2,4.53,29,5,5,1,3,3,openstack,1.54.1,"{""attributes"": {""admin_state_up"": {""type"": ""bool"", ""description_kind"": ""plain"", ""optional"": true}, ""availability_zone"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""description"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""flavor_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""loadbalancer_provider"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""name"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""region"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""security_group_ids"": {""type"": [""set"", ""string""], ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""tags"": {""type"": [""set"", ""string""], ""description_kind"": ""plain"", ""optional"": true}, ""tenant_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""vip_address"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""vip_network_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""vip_port_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}, ""vip_subnet_id"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true, ""computed"": true}}, ""block_types"": {""timeouts"": {""nesting_mode"": ""single"", ""block"": {""attributes"": {""create"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""delete"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}, ""update"": {""type"": ""string"", ""description_kind"": ""plain"", ""optional"": true}}, ""description_kind"": ""plain""}}}, ""matched_block_name"": ""openstack_lb_loadbalancer_v2"", ""matched_block_type"": ""resource""}",openstack_lb_loadbalancer_v2,resource,"resource ""openstack_lb_loadbalancer_v2"" ""k8s_lb"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""${var.cluster_name}-api-loadbalancer""
  vip_subnet_id     = var.subnet_id
}

resource ""openstack_lb_listener_v2"" ""api_listener""{
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-listener""
  protocol          = ""TCP""
  protocol_port     = var.k8s_master_loadbalancer_listener_port
  loadbalancer_id   = openstack_lb_loadbalancer_v2.k8s_lb[0].id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}

resource ""openstack_lb_pool_v2"" ""api_pool"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name              = ""api-pool""
  protocol          = ""TCP""
  lb_method         = ""ROUND_ROBIN""
  listener_id       = openstack_lb_listener_v2.api_listener[0].id
  depends_on        = [ openstack_lb_listener_v2.api_listener ]
}

resource ""openstack_lb_member_v2"" ""lb_member"" {
  count             = var.k8s_master_loadbalancer_enabled ? length(var.k8s_master_ips) : 0
  name              = var.k8s_master_ips[count.index].name
  pool_id           = openstack_lb_pool_v2.api_pool[0].id
  address           = var.k8s_master_ips[count.index].access_ip_v4
  protocol_port     = var.k8s_master_loadbalancer_server_port
  depends_on        = [ openstack_lb_pool_v2.api_pool ]
}

resource ""openstack_lb_monitor_v2"" ""monitor"" {
  count       = var.k8s_master_loadbalancer_enabled ? 1 : 0
  name        = ""Api Monitor""
  pool_id     = openstack_lb_pool_v2.api_pool[0].id
  type        = ""TCP""
  delay       = 10
  timeout     = 5
  max_retries = 5
}

resource ""openstack_networking_floatingip_v2"" ""floatip_1"" {
  count = var.k8s_master_loadbalancer_enabled && var.k8s_master_loadbalancer_public_ip == """" ? 1 : 0
  pool = var.floatingip_pool
}

resource ""openstack_networking_floatingip_associate_v2"" ""public_ip"" {
  count             = var.k8s_master_loadbalancer_enabled ? 1 : 0
  floating_ip       = var.k8s_master_loadbalancer_public_ip != """" ? var.k8s_master_loadbalancer_public_ip : openstack_networking_floatingip_v2.floatip_1[0].address
  port_id           = openstack_lb_loadbalancer_v2.k8s_lb[0].vip_port_id
  depends_on        = [ openstack_lb_loadbalancer_v2.k8s_lb ]
}
"
